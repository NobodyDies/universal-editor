function UniversalEditor(e,t){"use strict";var n=angular.module("universal.editor"),i=$("#"+e);i.append("<div data-ui-view=''></div>"),n.constant("configData",t),angular.bootstrap(i[0],["unEditor"])}!function(){"use strict";function e(e,t,n,i){return{request:function(e){return e.beforeSend&&e.beforeSend(e),t.$broadcast("editor:request_start",""),e.data&&"object"==typeof e.data&&angular.forEach(e.data,function(t,n){angular.isArray(t)&&0===t.length&&(e.data[n]=null)}),e},responseError:function(t){try{JSON.parse(JSON.stringify(t));null!==t.data&&t.data.hasOwnProperty("message")&&t.data.message.length>0?n.error(t.data.message):422===t.status||400===t.status?i("RESPONSE_ERROR.INVALID_DATA").then(function(e){n.warning(e)}):401===t.status?i("RESPONSE_ERROR.UNAUTHORIZED").then(function(e){n.warning(e)}):403===t.status?i("RESPONSE_ERROR.FORBIDDEN").then(function(e){n.error(e)}):i("RESPONSE_ERROR.SERVICE_UNAVAILABLE").then(function(e){n.error(e)})}catch(a){console.error(a),i("RESPONSE_ERROR.UNEXPECTED_RESPONSE").then(function(e){n.error(e)})}return e.reject(t)}}}function t(e,t,n,i,a,l,r,o){angular.extend(e.defaults,{control:"hue",position:"top left",letterCase:"uppercase"}),t.defaults.paramSerializer="$httpParamSerializerJQLike",t.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8",t.defaults.headers.put["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8",t.defaults.transformRequest=function(e){return void 0===e?e:$.param(e)},t.interceptors.push("EditorHttpInterceptor");var d={index:{url:"/type?parent&back"},edit:{url:"/type/:pk?parent&back"}},s=[];angular.forEach(o.entities,function(e){var t={};t.name=e.name,t.label=e.label;var n=!1;angular.forEach(e.states,function(e){"index"===e.name&&(n=!0)}),n?t.sref=t.name+"_index":t.sref=t.name+"_"+e.states[0].name,s.push(t)}),i.otherwise(o.entities[0].states[0].url?o.entities[0].states[0].url:"/"+o.entities[0].name),i.rule(function(e,t){var n=t.path(),i="/"===n[n.length-1];if(i)return n.substr(0,n.length-1)}),angular.forEach(o.entities,function(e){var t=e.name;angular.forEach(e.states,function(e){var i=t+"_"+e.name;e.name=t+"_"+e.name;var a=e.url;d[e.name]&&(a=e.url?e.url:d[e.name].url.replace("type",t)),n.state(i,{url:a,templateUrl:"module/components/universalEditor/universalEditor.html",controller:"UniversalEditorController",controllerAs:"vm",resolve:{component:function(){return e.component},menu:function(){return s},type:function(){return t}}})})}),a.decorator("mFormatFilter",function(){return function(e,t,n){return moment.isMoment(e)?n?moment.tz(e,n).format(t):e.format(t):""}})}function n(e,t,n,i,a){var l=document.querySelectorAll(".nav.nav-tabs .item");e.$on("$stateChangeSuccess",function(e,t,r,o,d){var s=r.type;angular.forEach(l,function(e){$(e).removeClass("active"),$(e).find("a")[0].hash.split("/")[2]==s&&$(e).addClass("active")});var u=i.getStateConfig(t.name);u&&"ue-modal"===u.component.name&&(d.pk&&(n.params.pk=d.pk),angular.extend(u.component.settings,{fromState:o,fromParams:d}),a.open(u.component))}),1==l.length&&angular.element(l).css("display","none")}function i(e){return e}angular.module("universal.editor",["universal.editor.templates","minicolors","datePicker","checklist-model","angularMoment","ngCookies","ngFileUpload","ui.router","ngRaven","ui.mask","toastr","pascalprecht.translate"]),angular.module("universal.editor").factory("EditorHttpInterceptor",e),e.$inject=["$q","$rootScope","toastr","$translate"],angular.module("universal.editor").config(t),t.$inject=["minicolorsProvider","$httpProvider","$stateProvider","$urlRouterProvider","$provide","ConfigDataProviderProvider","$injector","configData"],angular.module("universal.editor").run(n),n.$inject=["$rootScope","$location","$state","EditEntityStorage","ModalService"],i.$inject=["ConfigDataProvider"]}(),function(){"use strict";function e(e){var t={RESPONSE_ERROR:{INVALID_DATA:"Неправильно заполнена форма",SERVICE_UNAVAILABLE:"Сервис временно недоступен",UNEXPECTED_RESPONSE:"Сервис вернул неожиданный ответ",UNAUTHORIZED:"Требуется авторизация",RELOAD_PAGE:"Требуется повторная авторизация, перезагрузите страницу",FORBIDDEN:"Нет доступа",NOT_FOUND:"Запись не найдена"},CHANGE_RECORDS:{CREATE:"Запись создана",UPDATE:"Запись обновлена",DELETE:"Запись удалена"},BUTTON:{ADD:"Добавить",DELETE:"Удалить",DELETE_MARK:"Удалить метку",APPLY:"Применить",CLEAN:"Очистить",HIGHER_LEVEL:"На уровень выше",FILTER:"Фильтр"},LOADING:"Загрузка",SELECT_VALUE:"Выберите значение",PERFORMS_ACTIONS:"Выполняется действие",ELEMENT_NO:"Нет элементов для отображения",ELEMENTS:"Элементы",FROM:"из",SEARCH_ELEMENTS:"Поиск по элементам"};e.translations("ru",t),e.useStaticFilesLoader({prefix:"",suffix:""}),e.preferredLanguage("ru")}angular.module("universal.editor").config(e),e.$inject=["$translateProvider"]}(),function(){"use strict";function e(e){var t=function(e){this.scope=e.$new(),this.scope.setting=e.setting};return t.prototype.build=function(){var t="<"+this.scope.setting.component.name+' data-setting="setting"></'+this.scope.setting.component.name+">";return e(t)(this.scope)},t}angular.module("universal.editor").factory("ComponentBuilder",e),e.$inject=["$compile"]}(),function(){"use strict";function e(e){var t=function(e){this.scope=e.$new(),this.scope.filter=e.filter};return t.prototype.build=function(){var t="<div data-editor-filter-"+this.scope.filter.type+'=""></div>';return e(t)(this.scope)},t}angular.module("universal.editor").factory("FilterBuilder",e),e.$inject=["$compile"]}(),function(){"use strict";function e(e){return{getDefaultEntity:function(){return e.entities[0].name},$get:["$q",function(t){var n=t.defer();return n.resolve(e),n}]}}angular.module("universal.editor").provider("ConfigDataProvider",e),e.$inject=["configData"]}(),function(){"use strict";function e(e){var t={};this.setArrayField=function(e,n){t[e]=n},this.getFieldValue=function(e,n,i){return!(!t.hasOwnProperty(e)||void 0===t[e][n]||!t[e][n].hasOwnProperty(i))&&t[e][n][i]},this.removeFieldIndex=function(e,n){t[e].splice(n,1)},this.fieldDestroy=function(e,n,i,a){void 0===t[e][n]?(t[e][n]={},t[e][n][i]=a):t[e][n][i]=a},e.$on("editor:set_entity_type",function(e,n){t=[]})}angular.module("universal.editor").service("ArrayFieldStorage",e),e.$inject=["$rootScope"]}(),function(){"use strict";function e(e){function t(t){if(!t)return t;var n=t.split(".");return e[n[0]][n[1]]}var n=this;n.getCallback=t}angular.module("universal.editor").service("ButtonsService",e),e.$inject=["$window"]}(),function(){"use strict";function e(e,t,n,i,a){var l,r,o=[],d=this;this.actionType="create",this.getValueField=function(e){for(var t=o.length;t--;){var n=o[t];if(n.fieldName===e)return n.getFieldValue()}},this.createNewEntity=function(){var l={};l.editorEntityType="new";d.getEntity();angular.forEach(o,function(e){angular.merge(l,e.getInitialValue())});var r=i.search(),s=r.type||a.params.type;if(r.hasOwnProperty("parent")){var u=n.entities.filter(function(e){return e.name===s})[0];l[u.backend.fields.parent]=r.parent}t(function(){e.$broadcast("editor:entity_loaded",l)},0)},this.setSourceEntity=function(t){t.editorEntityType="exist",e.$broadcast("editor:entity_loaded",t)},this.getEntityType=function(){return l},this.setEntityType=function(e){l=e},this.addFieldController=function(e){o.push(e),e.$fieldHash=Math.random().toString(36).substr(2,15)},this.deleteFieldController=function(e){angular.forEach(o,function(t,n){t.$fieldHash===e.$fieldHash&&o.splice(n,1)})},this.setActionType=function(e){this.actionType=e},this.editEntityUpdate=function(t,n){this.setActionType(t);var i={};switch(angular.forEach(o,function(e){e.hasOwnProperty("readonly")&&e.readonly!==!1||angular.merge(i,e.getFieldValue())}),t){case"create":e.$emit("editor:create_entity",[i,n]);break;case"update":e.$emit("editor:update_entity",[i,n])}},this.editEntityPresave=function(t){var n={};angular.forEach(o,function(e){e.hasOwnProperty("readonly")&&e.readonly!==!1||angular.merge(n,e.getFieldValue())}),e.$emit("editor:presave_entity",[n,t])},this.getEntity=function(e,t){return n.entities.filter(function(e){return e.name===l})[0]},this.getStateConfig=function(e,t){var t=t||l,i=null;return 0!==e.indexOf(t+"_")&&(e=t+"_"+e),angular.forEach(n.entities,function(n){n.name===t&&angular.forEach(n.states,function(n){n.name&&(0!==n.name.indexOf(t+"_")&&(n.name=t+"_"+n.name),n.name===e&&(i=n))})}),i},this.getIndexState=function(){var e=null;return angular.forEach(n.entities,function(t){t.name===l&&angular.forEach(t.states,function(t){t.name&&t.name.indexOf("_index")===t.name.length-6&&(e=t)})}),e},this.getEditState=function(){var e=null;return angular.forEach(n.entities,function(t){t.name===l&&angular.forEach(t.states,function(t){t.name&&t.name.indexOf("_edit")===t.name.length-5&&(e=t)})}),e},e.$on("editor:add_entity",function(e,t){d.actionType=t}),e.$on("editor:set_entity_type",function(e,t){r=t,o=[]})}angular.module("universal.editor").service("EditEntityStorage",e),e.$inject=["$rootScope","$timeout","configData","$location","$state"]}(),function(){"use strict";function e(e,t,n){var i,a=[];this.addFilterController=function(e){a.push(e),e.$fieldHash=Math.random().toString(36).substr(2,15)},this.deleteFilterController=function(e){angular.forEach(a,function(t,n){t.$fieldHash===e.$fieldHash&&a.splice(n,1)})},this.getFilterValue=function(){var e={};return angular.forEach(a,function(t,n){t.getFilterValue()&&angular.extend(e,t.getFilterValue())}),e},this.setInitialValues=function(){angular.forEach(a,function(e,t){e.setInitialValue()})},e.$on("editor:set_entity_type",function(e,t){i=t,a=[]})}angular.module("universal.editor").service("FilterFieldsStorage",e),e.$inject=["$rootScope","$timeout","configData"]}(),function(){"use strict";function e(e,t,n,i,a,l,r,o,d,s,u){function c(e){g=e.settings,e.settings.modal=!0,p=u.open({component:"ueModal",resolve:{settings:function(){return g}}}),p.rendered.then(function(){h=!0}),p.result.then(f,f)}function m(){return h}function f(){h&&(h=!1,p&&p.close(),p=null,g.fromState&&o.go(g.fromState.name,g.fromState.params,{reload:!1}),g=null)}var p,g,v=this,h=!1;v.close=f,v.open=c,v.isModalOpen=m}angular.module("universal.editor").service("ModalService",e),e.$inject=["$q","$rootScope","$http","configData","EditEntityStorage","$location","$timeout","$state","$httpParamSerializer","$document","$uibModal"]}(),function(){"use strict";function e(e,t,n,i,a,l,r,o,d,s){var u,c,m,f,p,g,v=this;v.isProcessing=!1,v.methodType="",v.editedEntityId=null,t.$on("editor:set_entity_type",function(e,t){p=t,f="items"}),t.$on("editor:create_entity",function(e,t){v.addNewItem(t)}),t.$on("editor:update_entity",function(e,t){v.updateItem(t)}),t.$on("editor:presave_entity",function(e,t){v.presaveItem(t)}),this.getQueryParams=function(){try{return JSON.parse(JSON.stringify(c))}catch(e){return{}}},this.setQueryParams=function(e){c=Object.keys(e).length>0?e:void 0},this.setFilterParams=function(e){m=Object.keys(e).length>0?e:void 0},this.getItemsList=function(i){var a=e.defer();c&&c.hasOwnProperty("filter")&&delete c.filter;var r=this.getQueryParams(),o="GET",d=i.url;if("undefined"!=typeof i&&(r="undefined"!=typeof i.params?i.params:r,o="undefined"!=typeof i.method?i.method:o,void 0!==i.sort&&(r.sort=i.sort)),c=r,v.isProcessing,l.search().hasOwnProperty("parent")){var s={};s[p.dataSource.parentField]=l.search().parent,angular.extend(r,{filter:JSON.stringify(s)})}if(m)if(r.hasOwnProperty("filter")){var u=JSON.parse(r.filter);angular.extend(u,m),r.filter=JSON.stringify(u)}else r.filter=JSON.stringify(m);p.dataSource.hasOwnProperty("parentField")&&(r=r||{},r.hasOwnProperty("filter")||(r.root=!0)),!p.dataSource.hasOwnProperty("sortBy")||r.hasOwnProperty(p.dataSource.sortBy)||r.sort||(r=r||{},angular.extend(r,{sort:p.dataSource.sortBy})),r.hasOwnProperty("filter")&&delete r.root,v.isProcessing=!0;var g=[];angular.forEach(p.dataSource.fields,function(e){e.hasOwnProperty("expandable")&&e.expandable===!0&&g.push(e.name)}),g.length>0&&(r.expand=g.join(","));var h=i.id;return n({method:o,url:d,params:r}).then(function(e){v.isProcessing=!1,0===e.data[f].length?(t.$broadcast("editor:parent_empty"),t.$broadcast("editor:items_list_"+h,e.data),a.resolve()):(t.$broadcast("editor:items_list_"+h,e.data),a.resolve())},function(e){v.isProcessing=!1,a.reject()}),a.promise},this.getItemsListWithParams=function(e,i){v.isProcessing||(p.dataSource.fields.parent&&(e=e||{},e.hasOwnProperty("filter")||("object"==typeof e?angular.extend(e,{root:!0}):e+="&root=true")),"object"==typeof e&&(e=d(e)),v.isProcessing=!0,n({method:"GET",url:p.dataSource.url+"?"+e}).then(function(e){v.isProcessing=!1,t.$broadcast("editor:items_list_"+i,e.data)},function(e){v.isProcessing=!1}))},this.getData=function(e,t){return n({method:"GET",url:e,params:t})},this.addNewItem=function(e){var i=e[0],a=e[1];if(!v.isProcessing){var r=p.dataSource.fields.parent;if(r&&l.search().parent){var d=!s[0].querySelector(".field-wrapper [name='"+r+"']");d&&(i[r]=l.search().parent)}v.isProcessing=!0;var c={},m="POST",f=p.dataSource.url,g="id";p.dataSource.hasOwnProperty("fields")&&(g=p.dataSource.fields.primaryKey||g),"undefined"!=typeof a&&(c="undefined"!=typeof a.params?a.params:c,m="undefined"!=typeof a.method?a.method:m,f="undefined"!=typeof a.url?a.url:f),n({method:m,url:f,data:i,params:c}).then(function(e){t.$broadcast("editor:presave_entity_created",e.data[g]),v.isProcessing=!1,t.$broadcast("uploader:remove_session"),t.$broadcast("editor:entity_success");var n={};l.search().parent&&(n.parent=l.search().parent),o.go(u+"_index",n,{reload:!0})},function(e){e.data.error&&e.data.hasOwnProperty("data")&&e.data.data.length>0&&angular.forEach(e.data.data,function(e){e.hasOwnProperty("field")&&(t.$broadcast("editor:api_error_field_"+e.field,e.message),e.hasOwnProperty("fields")&&angular.forEach(e.fields,function(n,i){t.$broadcast("editor:api_error_field_"+e.field+"_"+i+"_"+n.field,n.message)}))}),v.isProcessing=!1})}},this.updateItem=function(e){var i=e[0],a=e[1];if(!v.isProcessing){v.isProcessing=!0;var r={},d="PUT",s=p.dataSource.url+"/"+v.editedEntityId;"undefined"!=typeof a&&(r="undefined"!=typeof a.params?a.params:r,d="undefined"!=typeof a.method?a.method:d,s="undefined"!=typeof a.url?a.url:s),n({method:d,url:s,data:i,params:r}).then(function(e){v.isProcessing=!1,t.$broadcast("uploader:remove_session"),t.$broadcast("editor:entity_success");var n={};l.search().parent&&(n.parent=l.search().parent),o.params.back&&(n.type=o.params.back),o.go(u+"_index",n,{reload:!0})},function(e){e.data.error&&e.data.hasOwnProperty("data")&&e.data.data.length>0&&angular.forEach(e.data.data,function(e){e.hasOwnProperty("field")&&(t.$broadcast("editor:api_error_field_"+e.field,e.message),e.hasOwnProperty("fields")&&angular.forEach(e.fields,function(n,i){t.$broadcast("editor:api_error_field_"+e.field+"_"+i+"_"+n.field,n.message)}))}),v.isProcessing=!1})}},this.presaveItem=function(e){var i,a=e[0],l=e[1],r={},d="POST",s="id";v.isProcessing||(v.isProcessing=!0,""!==v.editedEntityId?(i=p.dataSource.url+"/"+v.editedEntityId,d="PUT"):i=p.dataSource.url,p.dataSource.hasOwnProperty("fields")&&(s=p.dataSource.fields.primaryKey||s),"undefined"!=typeof l&&(r="undefined"!=typeof l.params?l.params:r,d="undefined"!=typeof l.method?l.method:d,i="undefined"!=typeof l.url?l.url:i),n({method:d,url:i,data:a,params:r}).then(function(e){v.isProcessing=!1,o.go(o.current.name,{pk:e.data[s]}),t.$broadcast("editor:presave_entity_created",e.data[s])},function(e){if((422===e.status||400===e.status)&&e.data){var n=e.data.hasOwnProperty("data")?e.data.data:e.data;angular.forEach(n,function(e){e.hasOwnProperty("field")&&(t.$broadcast("editor:api_error_field_"+e.field,e.message),e.hasOwnProperty("fields")&&angular.forEach(e.fields,function(n,i){t.$broadcast("editor:api_error_field_"+e.field+"_"+i+"_"+n.field,n.message)}))})}v.isProcessing=!1}))},this.getItemById=function(e,t){var i={};if(!v.isProcessing){v.isProcessing=!0;var l=[];angular.forEach(p.dataSource.fields,function(e){e.hasOwnProperty("expandable")&&e.expandable===!0&&l.push(e.name)}),l.length>0&&(i.expand=l.join(",")),n({method:"GET",url:p.dataSource.url+"/"+e,params:i}).then(function(e){v.isProcessing=!1,a.setSourceEntity(e.data)},function(e){v.isProcessing=!1})}},this.deleteItemById=function(e,a,r,d){var s={};if(!v.isProcessing){v.isProcessing=!0;var c="DELETE",m=p.dataSource.url+"/"+e;if("edit"===d.buttonClass&&(m=p.dataSource.url.replace(":pk",e)),"mix"===r){var f=i.entities.filter(function(e){return e.name===g.entity})[0];m=f.dataSource.url+"/"+e}return"undefined"!=typeof a&&(s="undefined"!=typeof a.params?a.params:s,c="undefined"!=typeof a.method?a.method:c,m="undefined"!=typeof a.url?a.url:m),n({method:c,url:m,params:s}).then(function(e){v.isProcessing=!1,v.setQueryParams({}),v.setFilterParams({}),t.$broadcast("editor:entity_success_deleted");var n={};l.search().parent&&(n.parent=l.search().parent),o.params.back&&(n.type=o.params.back),o.go(u+"_index",n,{reload:!0})},function(e){v.isProcessing=!1})}},this.getUrlResource=function h(t,i,a,l,r){function o(e,t){return n({method:"GET",url:e,params:{page:t||1,"per-page":50}})}var d=a||e.defer(),s=i||[],u=[];if(l=l||1,r=r||0,12===l&&(l=11),r)for(var c=l;c<=r;c++)u.push(o(t,c));else u.push(o(t));return e.all(u).then(function(e){for(var n,i,a=e.length;a--;)n=e[a],s=s.concat(n.data.items);return n.data._meta&&(i=n.data._meta.pageCount),i&&i!==r&&1!==i?(l=1===l?2:l+10,r+=10,r>i&&(r=i),h(t,s,d,l,r)):void d.resolve({data:{items:s}})},function(e){}),d.promise},this.actionRequest=function(t){var i=e.defer(),a=t.params||{},l=t.url;return t.id&&(l=t.url.replace(":id",id)),v.isProcessing=!0,n({method:t.method,url:l,params:a,beforeSend:t.beforeSend}).then(function(e){v.isProcessing=!1,i.resolve(e)},function(e){v.isProcessing=!1,i.reject(e)}),i.promise},this.loadChilds=function(e,t,n){l.search("parent",e);var i=angular.merge({},t);i.url=n,v.getItemsList(i).then(function(t){r(function(){l.search("parent",e)},0)})},this.loadParent=function(e){e="undefined"!=typeof e?e:void 0,e?(v.isProcessing=!0,n({method:"GET",url:p.backend.url+"/"+e}).then(function(e){var t;null!==e.data[p.backend.fields.parent]?(v.isProcessing=!1,t=e.data[p.backend.fields.parent],l.search("parent",t),v.getItemsList()):(v.isProcessing=!1,l.search("parent",null),v.getItemsList())},function(e){v.isProcessing=!1})):(v.isProcessing=!0,l.search("parent",null),v.getItemsList())},this.setEntityType=function(e){u=e},this.getEntityType=function(){return u},this.getEntityObject=function(){return p},this.getMixModeByEntity=function(){var e={};return e.existence=!1,i.hasOwnProperty("mixedMode")&&angular.forEach(i.mixedMode,function(t){t.entities[0]==u&&(e.existence=!0,e.entity=t.entities[1],e.entityTypeName=t.fields.type,e.prependIcon=t.fields.prependIcon)}),e}}angular.module("universal.editor").service("RestApiService",e),e.$inject=["$q","$rootScope","$http","configData","EditEntityStorage","$location","$timeout","$state","$httpParamSerializer","$document"]}(),function(){"use strict";function e(e,t,n,i,a,l,r){function o(t){if(!(""===t||t.length<=f.minCount))if(f.searching=!0,e.filter.hasOwnProperty("values"))angular.forEach(e.filter.values,function(e,n){var i={};i[f.filter_id]=n,i[f.filter_search]=e,d(e,t)&&!u(i)&&f.possibleValues.push(i)}),f.activeElement=0,f.searching=!1;else{var n={};n[f.filter_search]="%"+t+"%",a.getUrlResource(e.filter.valuesRemote.url+"?filter="+JSON.stringify(n)).then(function(e){angular.forEach(e.data.items,function(e){u(e)||s(e)||f.possibleValues.push(e)}),f.activeElement=0,f.searching=!1},function(t){console.error('EditorFieldAutocompleteController: Не удалось получить значения для поля "'+e.filter.name+'" с удаленного ресурса'),f.searching=!1})}}function d(e,t){return e.toLowerCase().indexOf(t.toLowerCase())>=0}function s(e){var t=!1;return angular.forEach(f.possibleValues,function(n){n[f.filter_id]==e[f.filter_id]&&(t=!0)}),t}function u(e){var t=!1;return angular.forEach(f.selectedValues,function(n){n[f.filter_id]==e[f.filter_id]&&(t=!0)}),t}function c(){var t=i.search();if(e.filter.hasOwnProperty("values"))angular.forEach(e.filter.values,function(n,i){var a={};angular.isArray(e.filter.values)?a[f.filter_id]=n:a[f.filter_id]=i,a[f.filter_search]=n,t&&t.hasOwnProperty(f.filterName)&&t[f.filterName]==a[f.filter_id]&&(f.selectedValues.push(a),f.placeholder=a[f.filter_search])}),f.preloadedData=!0;else if(e.filter.hasOwnProperty("valuesRemote")){if(void 0===f.filterValue||""===f.filterValue)return void(f.preloadedData=!0);var n;n={},n[f.filter_id]=[],n[f.filter_id].push(f.filterValue),a.getUrlResource(e.filter.valuesRemote.url+"?filter="+JSON.stringify(n)).then(function(e){t&&t.hasOwnProperty(f.filterName)&&angular.forEach(e.data.items,function(e){t[f.filterName]==e[f.filter_id]&&(f.selectedValues.push(e),f.placeholder=e[f.filter_search])}),f.preloadedData=!0},function(t){f.preloadedData=!0,console.error('EditorFieldAutocompleteController: Не удалось получить значения для поля "'+e.filter.name+'" с удаленного ресурса')})}else f.preloadedData=!0,console.error("EditorFieldAutocompleteController: Для поля не указан ни один тип получения значений ( локальный или удаленный )")}var m,f=this,p=(e.filterName,angular.element(t[0].getElementsByClassName("possible-scroll")[0])),g=e.filter.valuesRemote;f.filter_id="id",f.filter_search="title",g&&g.fields&&(g.fields.value&&(f.filter_id=g.fields.value),g.fields.label?f.filter_search=g.fields.label:f.filter_search=f.filter_id),f.filterName=e.filter.name,f.filterDisplayName=e.filter.label,f.selectedValues=[],f.activeElement=0,f.preloadedData=!1,f.searching=!1,f.minCount=e.filter.minCount||2,f.filterValue=i.search()[f.filterName]||"",f.inputValue="",f.classInput={width:"99%","padding-right":"25px"},f.showPossible=!1,f.placeholder="",c(),n.addFilterController(this),t.find("input").bind("keydown",function(e){switch(e.which){case 13:if(e.preventDefault(),f.possibleValues.length<1)break;l(function(){f.addToSelected(e,f.possibleValues[f.activeElement])},0);break;case 40:if(e.preventDefault(),f.possibleValues.length<1)break;p=angular.element(t[0].getElementsByClassName("possible-scroll")[0]),f.activeElement<f.possibleValues.length-1&&(l(function(){f.activeElement++},0),l(function(){var e=angular.element(p[0].getElementsByClassName("active")[0])[0].offsetTop,t=angular.element(p[0].getElementsByClassName("active")[0])[0].clientHeight,n=p[0].scrollTop,i=p[0].clientHeight;e>=i+n-t&&(p[0].scrollTop+=t+1)},1));break;case 38:if(e.preventDefault(),f.possibleValues.length<1)break;p=angular.element(t[0].getElementsByClassName("possible-scroll")[0]),f.activeElement>0&&(l(function(){f.activeElement--},0),l(function(){var e=angular.element(p[0].getElementsByClassName("active")[0])[0].offsetTop,t=angular.element(p[0].getElementsByClassName("active")[0])[0].clientHeight,n=p[0].scrollTop;p[0].clientHeight;e<n&&(p[0].scrollTop-=t+1)},1))}}),this.getFilterValue=function(){var e={};return""!==f.filterValue&&(e[f.filterName]=f.filterValue,e)},this.getInitialValue=function(){var e={};return e[f.filterName]="",e},this.setInitialValue=function(){f.filterValue="",f.selectedValues=[],f.inputValue="",f.placeholder=""},e.$on("$destroy",function(){n.deleteFilterController(f)}),e.$watch(function(){return f.inputValue},function(e){m&&l.cancel(m),f.possibleValues=[],m=l(function(){o(e)},300)}),e.$watch(function(){return f.filterValue},function(e){""!==e?i.search(f.filterName,e):i.search(f.filterName,null)}),f.addToSelected=function(e,t){f.selectedValues=[],f.selectedValues.push(t),f.filterValue=t.id,f.inputValue="",f.possibleValues=[],f.placeholder=t[f.filter_search],e.stopPropagation()},f.removeFromSelected=function(e){f.selectedValues=[],f.filterValue="",f.placeholder=""},f.focusPossible=function(e){f.isActivePossible=e,f.multiple||t.find(".autocomplete-item").length>0&&(e?(t.find(".autocomplete-field-search").removeClass("hidden"),t.find(".autocomplete-item").addClass("opacity-item")):(t.find(".autocomplete-field-search").addClass("hidden"),t.find(".autocomplete-item").removeClass("opacity-item")))}}angular.module("universal.editor").controller("EditorFilterAutocompleteController",e),e.$inject=["$scope","$element","FilterFieldsStorage","$location","RestApiService","$timeout","ArrayFieldStorage"]}(),function(){"use strict";function e(e,t){function n(e,n,i,a){t.on("click",function(t){n.find(".filter-inner-wrapper")[0].contains(t.target)||e.$apply(function(){e.vm.showPossible=!1})}),e.inputFocus=function(){e.vm.multiple||(n.find(".autocomplete-field-search").removeClass("hidden"),n.find(".autocomplete-item").addClass("opacity-item")),e.vm.showPossible=!0,n.find("input")[0].focus()},n.on("$destroy",function(){e.$destroy()})}return{restrict:"A",replace:!0,scope:!0,template:e.get("module/components/editorFilterAutocomplete/editorFilterAutocomplete.html"),controller:"EditorFilterAutocompleteController",controllerAs:"vm",link:n}}angular.module("universal.editor").directive("editorFilterAutocomplete",e),e.$inject=["$templateCache","$document"]}(),function(e){try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/components/editorFilterAutocomplete/editorFilterAutocomplete.html",'\n<div class="editor-autocomplete-wrapper">\n    <div class="filter-name-label"><span>{{vm.filterDisplayName}}</span></div>\n    <div class="filter-inner-wrapper">\n        <div data-ng-show="vm.preloadedData" data-ng-class="{&quot;active&quot; : vm.isActivePossible}" data-ng-click="inputFocus()" class="autocomplete-input-wrapper form-control">\n            <input type="text" name="{{vm.filterName}}" data-ng-model="vm.inputValue" data-ng-focus="vm.focusPossible(true)" data-ng-blur="vm.focusPossible(false)" data-ng-style="vm.classInput" placeholder="{{vm.placeholder}}" data-ng-class="!vm.isActivePossible ? &quot;color-placeholder&quot; : &quot;&quot;" class="autocomplete-field-search"/><span data-ng-if="!vm.multiple &amp;&amp; !!vm.selectedValues.length" data-ng-click="vm.removeFromSelected($event)" class="selecte-delete selecte-delete-autocomplete">×</span>\n            <div data-ng-show="vm.searching" class="loader-search-wrapper">\n                <div class="loader-search">{{\'LOADING\' | translate}}</div>\n            </div>\n            <div data-ng-if="vm.possibleValues.length &gt; 0 &amp;&amp; vm.showPossible" class="possible-values possible-autocomplete active possible-bottom">\n                <div class="possible-scroll">\n                    <div data-ng-repeat="possible in vm.possibleValues" data-ng-mouseover="vm.activeElement = $index" data-ng-click="vm.addToSelected($event,possible)" data-ng-class="vm.activeElement == $index ? \'active\' : \'\'" class="possible-value-item">{{possible[vm.filter_search]}}</div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>')}])}(),function(){"use strict";var e={bindings:{setting:"=",entityId:"@",buttonClass:"@"},template:["$templateCache",function(e){return e.get("module/components/componentWrapper/componentWrapper.html")}],controller:"ComponentWrapperController",controllerAs:"vm"};angular.module("universal.editor").component("componentWrapper",e)}(),function(){"use strict";function e(e,t,n){var i=this;t.setting=i.setting,t.setting.entityId=i.entityId,t.setting.buttonClass=i.buttonClass,this.$postLink=function(){e.on("$destroy",function(){t.$destroy()}),e.append(new n(t).build())}}angular.module("universal.editor").controller("ComponentWrapperController",e),e.$inject=["$element","$scope","ComponentBuilder"]}(),function(e){try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/components/componentWrapper/componentWrapper.html",'\n<div class="component-wrapper"></div>')}])}(),function(){"use strict";function e(e,t,n){var i=this;i.filterName=e.filter.name,i.filterDisplayName=e.filter.label,i.filterValue=[],i.selectedValues=[];var a=e.filter.valuesRemote;i.field_id="id",i.field_search="title",a&&a.fields&&(a.fields.value&&(i.field_id=a.fields.value),a.fields.label&&(i.field_search=a.fields.label)),t.addFilterController(this),e.filter.hasOwnProperty("values")?angular.forEach(e.filter.values,function(e,t){var n={};n[i.field_id]=t,n[i.field_search]=e,i.selectedValues.push(n)}):e.filter.hasOwnProperty("valuesRemote")?n.getUrlResource(e.filter.valuesRemote.url).then(function(e){angular.forEach(e.data.items,function(e){i.selectedValues.push(e)})},function(t){console.error('EditorFilterCheckboxController: Не удалось получить значения для поля "'+e.filter.fieldName+'" с удаленного ресурса')}):console.error("EditorFilterCheckboxController: Для поля не указан ни один тип получения значений ( локальный или удаленный )"),this.getFilterValue=function(){var e={};return 0!==i.filterValue.length&&(e[i.filterName]=i.filterValue,e)},this.getInitialValue=function(){var e={};return e[i.filterValue]=[],e},this.setInitialValue=function(){i.filterValue=[]},e.$on("$destroy",function(){t.deleteFilterController(i)})}angular.module("universal.editor").controller("EditorFilterCheckboxController",e),e.$inject=["$scope","FilterFieldsStorage","RestApiService"]}(),function(){"use strict";function e(e){function t(e,t,n,i){t.on("$destroy",function(){e.$destroy()})}return{restrict:"A",replace:!0,scope:!0,template:e.get("module/components/editorFilterCheckbox/editorFilterCheckbox.html"),controller:"EditorFilterCheckboxController",controllerAs:"vm",link:t}}angular.module("universal.editor").directive("editorFilterCheckbox",e),e.$inject=["$templateCache"]}(),function(e){try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/components/editorFilterCheckbox/editorFilterCheckbox.html",'\n<div>\n    <div class="filter-name-label"><span>{{vm.filterDisplayName}}</span></div>\n    <div class="filter-inner-wrapper">\n        <label data-ng-repeat="item in vm.selectedValues" class="checkbox-inline">\n            <input type="checkbox" data-checklist-model="vm.filterValue" data-checklist-value="item[vm.field_id]"/>{{item[vm.field_search]}}\n        </label>\n    </div>\n</div>')}])}(),function(){"use strict";function e(e,t,n){var i=this;i.filterName=e.filter.name,i.filterDisplayName=e.filter.label,i.filterValueStartDate="",i.filterValueStartTime="",i.filterValueEndDate="",i.filterValueEndTime="",t.addFilterController(this),this.getFilterValue=function(){var e={};if(""===i.filterValueStartDate&&""===i.filterValueEndDate&&""===i.filterValueStartTime&&""===i.filterValueEndTime)return!1;var t=n.isMoment(i.filterValueStartTime)?" "+n(i.filterValueStartTime).format("HH:mm:ss"):"",a=n.isMoment(i.filterValueEndTime)?" "+n(i.filterValueEndTime).format("HH:mm:ss"):"";return""!==i.filterValueStartDate&&""===i.filterValueEndDate?e[">="+i.filterName]=n(i.filterValueStartDate).format("YYYY-MM-DD")+t:""===i.filterValueStartDate&&""!==i.filterValueEndDate?e["<="+i.filterName]=n(i.filterValueEndDate).format("YYYY-MM-DD")+a:(e[">="+i.filterName]=n(i.filterValueStartDate).format("YYYY-MM-DD")+t,e["<="+i.filterName]=n(i.filterValueEndDate).format("YYYY-MM-DD")+a),e},this.getInitialValue=function(){var e={};return e[i.filterName]="",e},this.setInitialValue=function(){i.filterValueStartDate="",i.filterValueStartTime="",i.filterValueEndDate="",i.filterValueEndTime=""},e.$on("$destroy",function(){t.deleteFilterController(i)})}angular.module("universal.editor").controller("EditorFilterDateController",e),e.$inject=["$scope","FilterFieldsStorage","moment"]}(),function(){"use strict";function e(e){function t(e,t,n,i){t.on("$destroy",function(){e.$destroy()})}return{restrict:"A",replace:!0,scope:!0,template:e.get("module/components/editorFilterDate/editorFilterDate.html"),controller:"EditorFilterDateController",controllerAs:"vm",link:t}}angular.module("universal.editor").directive("editorFilterDate",e),e.$inject=["$templateCache"]}(),function(e){
try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/components/editorFilterDate/editorFilterDate.html",'\n<div class="filter-date-wrapper">\n    <div class="filter-name-label"><span>{{vm.filterDisplayName}}</span></div>\n    <div class="filter-inner-wrapper">\n        <div class="filter-start">\n            <div class="editor-date">\n                <input data-date-time="" data-ng-model="vm.filterValueStartDate" data-format="YYYY-MM-DD" data-max-view="year" data-min-view="date" data-view="date" class="form-control input-sm"/>\n            </div>\n            <div class="editor-time">\n                <input data-ng-disabled="!vm.filterValueStartDate" data-date-time="" data-ng-model="vm.filterValueStartTime" data-format="HH:mm:ss" data-max-view="hours" data-min-view="minutes" data-view="hours" class="form-control input-sm"/>\n            </div>\n        </div><span class="divider">-</span>\n        <div class="filter-end">\n            <div class="editor-date">\n                <input data-date-time="" data-ng-model="vm.filterValueEndDate" data-format="YYYY-MM-DD" data-max-view="year" data-min-view="date" data-view="date" class="form-control input-sm"/>\n            </div>\n            <div class="editor-time">\n                <input data-ng-disabled="!vm.filterValueEndDate" data-date-time="" data-ng-model="vm.filterValueEndTime" data-format="HH:mm:ss" data-max-view="hours" data-min-view="minutes" data-view="hours" class="form-control input-sm"/>\n            </div>\n        </div>\n    </div>\n</div>')}])}(),function(){"use strict";function e(e,t,n){var i=this;i.filterName=e.filter.name,i.filterDisplayName=e.filter.label,i.filterValueStartDateTime="",i.filterValueEndDateTime="",t.addFilterController(this),this.getFilterValue=function(){var e={};return(""!==i.filterValueStartDateTime||""!==i.filterValueEndDateTime)&&(""!==i.filterValueStartDateTime&&""===i.filterValueEndDateTime?e[">="+i.filterName]=n.utc(i.filterValueStartDateTime).format("YYYY-MM-DD HH:mm:ss"):""===i.filterValueStartDateTime&&""!==i.filterValueEndDateTime?e["<="+i.filterName]=n.utc(i.filterValueEndDateTime).format("YYYY-MM-DD HH:mm:ss"):(e[">="+i.filterName]=n.utc(i.filterValueStartDateTime).format("YYYY-MM-DD HH:mm:ss"),e["<="+i.filterName]=n.utc(i.filterValueEndDateTime).format("YYYY-MM-DD HH:mm:ss")),e)},this.getInitialValue=function(){var e={};return e[i.filterName]="",e},this.setInitialValue=function(){i.filterValueStartDateTime="",i.filterValueEndDateTime=""},e.$on("$destroy",function(){t.deleteFilterController(i)})}angular.module("universal.editor").controller("EditorFilterDateTimeController",e),e.$inject=["$scope","FilterFieldsStorage","moment"]}(),function(){"use strict";function e(e){function t(e,t,n,i){t.on("$destroy",function(){e.$destroy()})}return{restrict:"A",replace:!0,scope:!0,template:e.get("module/components/editorFilterDatetime/editorFilterDatetime.html"),controller:"EditorFilterDateTimeController",controllerAs:"vm",link:t}}angular.module("universal.editor").directive("editorFilterDatetime",e),e.$inject=["$templateCache"]}(),function(e){try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/components/editorFilterDatetime/editorFilterDatetime.html",'\n<div class="filter-datetime-wrapper">\n    <div class="filter-name-label"><span>{{vm.filterDisplayName}}</span></div>\n    <div class="filter-inner-wrapper">\n        <div class="filter-start">\n            <div class="editor-datetime">\n                <input date-time="" name="{{vm.fieldName}}" data-ng-disabled="vm.readonly" ng-model="vm.filterValueStartDateTime" view="date" timezone="UTC" format="YYYY-MM-DD HH:mm:ss" class="form-control input-sm"/>\n            </div>\n        </div><span class="divider">-</span>\n        <div class="filter-end">\n            <div class="editor-datetime">\n                <input date-time="" name="{{vm.fieldName}}" data-ng-disabled="vm.readonly" ng-model="vm.filterValueEndDateTime" view="date" timezone="UTC" format="YYYY-MM-DD HH:mm:ss" class="form-control input-sm"/>\n            </div>\n        </div>\n    </div>\n</div>')}])}(),function(){"use strict";function e(e,t,n,i){var a=this;a.filterName=e.filter.name,a.filterDisplayName=e.filter.label,a.filterValue=n.search()[a.filterName]||null,t.addFilterController(this),this.getFilterValue=function(){var e={};return null!==a.filterValue&&(e[a.filterName]=a.filterValue,e)},this.getInitialValue=function(){var e={};return e[a.filterName]=null,e},this.setInitialValue=function(){a.filterValue=null},e.$on("$destroy",function(){t.deleteFilterController(a)}),e.$watch(function(){return a.filterValue},function(e){null!==e?n.search(a.filterName,e):n.search(a.filterName,null)})}angular.module("universal.editor").controller("EditorFilterNumberController",e),e.$inject=["$scope","FilterFieldsStorage","$location","RestApiService"]}(),function(){"use strict";function e(e){function t(e,t,n,i){t.on("$destroy",function(){e.$destroy()})}return{restrict:"A",replace:!0,scope:!0,template:e.get("module/components/editorFilterNumber/editorFilterNumber.html"),controller:"EditorFilterNumberController",controllerAs:"vm",link:t}}angular.module("universal.editor").directive("editorFilterNumber",e),e.$inject=["$templateCache"]}(),function(e){try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/components/editorFilterNumber/editorFilterNumber.html",'\n<div>\n    <div class="filter-name-label"><span>{{vm.filterDisplayName}}</span></div>\n    <div class="filter-inner-wrapper">\n        <input type="number" name="{{vm.filterName}}" data-ng-model="vm.filterValue" class="form-control input-sm"/>\n    </div>\n</div>')}])}(),function(){"use strict";function e(e,t,n){var i=this;i.filterName=e.filter.name,i.filterDisplayName=e.filter.label,i.filterValue=null,i.selectedValues=[];var a=e.filter.valuesRemote;i.field_id="id",i.field_search="title",a&&a.fields&&(a.fields.value&&(i.field_id=a.fields.value),a.fields.label&&(i.field_search=a.fields.label)),t.addFilterController(this),e.filter.hasOwnProperty("values")?angular.forEach(e.filter.values,function(e,t){var n={};n[i.field_id]=t,n[i.field_search]=e,i.selectedValues.push(n)}):e.filter.hasOwnProperty("valuesRemote")?n.getUrlResource(e.filter.valuesRemote.url).then(function(e){angular.forEach(e.data.items,function(e){i.selectedValues.push(e)})},function(t){console.error('EditorFilterRadiolistController: Не удалось получить значения для поля "'+e.filter.fieldName+'" с удаленного ресурса')}):console.error("EditorFilterRadiolistController: Для поля не указан ни один тип получения значений ( локальный или удаленный )"),this.getFilterValue=function(){var e={};return!!i.filterValue&&(e[i.filterName]=i.filterValue,e)},this.getInitialValue=function(){var e={};return e[i.filterValue]=null,e},this.setInitialValue=function(){i.filterValue=null},e.$on("$destroy",function(){t.deleteFilterController(i)})}angular.module("universal.editor").controller("EditorFilterRadiolistController",e),e.$inject=["$scope","FilterFieldsStorage","RestApiService"]}(),function(){"use strict";function e(e){function t(e,t,n,i){t.on("$destroy",function(){e.$destroy()})}return{restrict:"A",replace:!0,scope:!0,template:e.get("module/components/editorFilterRadiolist/editorFilterRadiolist.html"),controller:"EditorFilterRadiolistController",controllerAs:"vm",link:t}}angular.module("universal.editor").directive("editorFilterRadiolist",e),e.$inject=["$templateCache"]}(),function(e){try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/components/editorFilterRadiolist/editorFilterRadiolist.html",'\n<div>\n    <div class="filter-name-label"><span>{{vm.filterDisplayName}}</span></div>\n    <div class="filter-inner-wrapper">\n        <label data-ng-repeat="item in vm.selectedValues" class="radio-inline">\n            <input type="radio" data-ng-model="vm.filterValue" value="{{item[vm.field_id]}}"/>{{item[vm.field_search]}}\n        </label>\n    </div>\n</div>')}])}(),function(){"use strict";function e(e,t,n,i,a,l,r){function o(){u.activeElement=0;var t=f.filter(function(e){return e[u.field_id]==u.filterValue});return u.filterValue&&!u.filterText?(u.isSelection=!1,u.placeholder=e.filter.placeholder||""):u.placeholder="",u.filterText?(f||(f=angular.copy(u.selectedValues)),void(u.selectedValues=d(angular.copy(f),u.filterText))):(u.placeholder=e.filter.placeholder,u.filterValue&&t.length>0&&(u.placeholder=t[0][u.field_search],u.isSelection=!0),void(f&&(u.selectedValues=f)))}function d(e,t){var n=[];return n=e.filter(function(e){return e.childOpts&&e.childOpts.length&&(e.childOpts=d(e.childOpts,t)),e[u.field_search].toLowerCase().indexOf(t.toLowerCase())>-1||e.childOpts&&e.childOpts.length})}function s(){u.search||(u.colorPlaceholder=!(u.placeholder===e.filter.placeholder||u.showPossible))}var u=this,c=e.filter.valuesRemote;u.field_id="id",u.field_search="title",c&&c.fields&&(c.fields.value&&(u.field_id=c.fields.value),c.fields.label&&(u.field_search=c.fields.label)),u.filterName=e.filter.name,u.filterDisplayName=e.filter.label,u.selectedValues=[],u.placeholder=e.filter.placeholder||"",u.activeElement=0,u.search=e.filter.search;var m=angular.element(l[0].getElementsByClassName("possible-values")[0]);u.change=o,u.isSelection=!1,u.isSpanSelectDelete=!1,t.addFilterController(this);var f;e.filter.hasOwnProperty("values")?(i.search()[u.filterName]&&(u.filterValue=parseInt(i.search()[u.filterName]),u.isSpanSelectDelete=!0),angular.forEach(e.filter.values,function(e,t){var n={};n[u.field_id]=t,n[u.field_search]=e,u.selectedValues.push(n),i.search()[u.filterName]&&t==u.filterValue&&(u.placeholder=e,u.isSelection=!0)}),f=angular.copy(u.selectedValues)):e.filter.hasOwnProperty("valuesRemote")?n.getUrlResource(e.filter.valuesRemote.url).then(function(e){i.search()[u.filterName]&&(u.filterValue=parseInt(i.search()[u.filterName]),u.isSpanSelectDelete=!0),angular.forEach(e.data.items,function(e){u.selectedValues.push(e),i.search()[u.filterName]&&e[u.field_id]==u.filterValue&&a(function(){u.placeholder=e[u.field_search],u.isSelection=!0,s()},0)}),f=angular.copy(u.selectedValues)},function(t){console.error('EditorFilterSelectController: Не удалось получить значения для поля "'+e.filter.fieldName+'" с удаленного ресурса')}):console.error("EditorFilterSelectController: Для поля не указан ни один тип получения значений ( локальный или удаленный )"),this.getFilterValue=function(){var e={};return null!==u.filterValue&&(e[u.filterName]=u.filterValue,e)},this.getInitialValue=function(){var e={};return e[u.filterValue]=[],e},this.setInitialValue=function(){u.filterValue=null},e.$on("$destroy",function(){t.deleteFilterController(u)}),e.$watch(function(){return u.filterValue},function(e){u.isSelection=!1,void 0!==e&&(u.isSelection=u.showPossible,i.search(u.filterName,e))}),u.addToSelected=function(t){u.filterValue=t[u.field_id],u.filterText="",a(function(){u.placeholder=t&&t[u.field_search]?t[u.field_search]:e.filter.placeholder,u.showPossible=!1,u.isSpanSelectDelete=!0,s()},0)},u.isShowPossible=function(e){u.activeElement=0,o(),u.showPossible=!u.showPossible;var t=l.find(".select-input");u.showPossible&&t.addClass("active"),s()},r.bind("keydown",function(e){if(9===e.which&&u.isBlur(),u.showPossible)switch(e.which){case 27:e.preventDefault(),a(function(){u.showPossible=!1},0);break;case 13:if(e.preventDefault(),u.selectedValues.length<1)break;a(function(){u.addToSelected(u.selectedValues[u.activeElement])},0);break;case 40:if(e.preventDefault(),u.selectedValues.length<1)break;m=angular.element(l[0].getElementsByClassName("possible-scroll")[0]),u.activeElement<u.selectedValues.length-1&&(a(function(){u.activeElement++},0),a(function(){var e=angular.element(m[0].getElementsByClassName("active")[0])[0].offsetTop,t=angular.element(m[0].getElementsByClassName("active")[0])[0].clientHeight,n=m[0].scrollTop,i=m[0].clientHeight;e>=i+n-t&&(m[0].scrollTop+=t+1)},1));break;case 38:if(e.preventDefault(),u.selectedValues.length<1)break;m=angular.element(l[0].getElementsByClassName("possible-scroll")[0]),u.activeElement>0&&(a(function(){u.activeElement--},0),a(function(){var e=angular.element(m[0].getElementsByClassName("active")[0])[0].offsetTop,t=angular.element(m[0].getElementsByClassName("active")[0])[0].clientHeight,n=m[0].scrollTop;m[0].clientHeight;e<n&&(m[0].scrollTop-=t+1)},1))}}),u.isBlur=function(){u.showPossible=!1;var e=l.find(".select-input");e.removeClass("active"),s()},u.clickSelect=function(){l.find("input")[0].focus()},u.deleteToSelected=function(t,n){u.isSpanSelectDelete=!1,u.filterValue=null,u.placeholder=e.filter.placeholder||"",s(),t.stopPropagation()}}angular.module("universal.editor").controller("EditorFilterSelectController",e),e.$inject=["$scope","FilterFieldsStorage","RestApiService","$location","$timeout","$element","$document"]}(),function(){"use strict";function e(e,t){function n(e,n,i,a){t.on("click",function(){n.find(".filter-inner-wrapper")[0].contains(event.target)||e.$apply(function(){e.vm.isBlur()})}),n.on("$destroy",function(){e.$destroy()})}return{restrict:"A",replace:!0,scope:!0,template:e.get("module/components/editorFilterSelect/editorFilterSelect.html"),controller:"EditorFilterSelectController",controllerAs:"vm",link:n}}angular.module("universal.editor").directive("editorFilterSelect",e),e.$inject=["$templateCache","$document"]}(),function(e){try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/components/editorFilterSelect/editorFilterSelect.html",'\n<div>\n    <div class="filter-name-label"><span>{{vm.filterDisplayName}}</span></div>\n    <div class="filter-inner-wrapper">\n        <div data-ng-click="vm.clickSelect()" data-ng-class="!vm.search ? &quot;but-for-search&quot; : &quot;&quot;" class="select-input-wrapper">\n            <input data-ng-if="vm.search" placeholder="{{vm.placeholder}}" data-ng-class="vm.isSelection ? &quot;color-placeholder&quot; : &quot;&quot;" data-ng-model="vm.filterText" data-ng-change="vm.change()" data-ng-focus="vm.isShowPossible()" class="form-control"/>\n            <input data-ng-if="!vm.search" data-ng-focus="vm.isShowPossible()" class="focus-input"/>\n            <div data-ng-if="!vm.search" class="form-control select-input">\n                <div data-ng-class="vm.colorPlaceholder ? &quot;color-placeholder-div&quot; : &quot;&quot;" class="dropdown__selected-items">{{vm.placeholder}}</div>\n            </div><span data-ng-if="vm.isSpanSelectDelete" data-ng-click="vm.deleteToSelected($event, false)" class="selecte-delete">×</span>\n            <div data-ng-if="!vm.readonly &amp;&amp; (vm.selectedValues.length &gt; 0) &amp;&amp; vm.showPossible" class="possible-values active possible-bottom">\n                <div class="possible-scroll">\n                    <div data-ng-repeat="option in vm.selectedValues" data-ng-mouseover="vm.activeElement = $index" data-ng-click="vm.addToSelected(option)" data-ng-class="vm.activeElement == $index ? \'active\' : \'\'" class="possible-value-item">{{option[vm.field_search]}}</div>\n                </div>\n            </div>\n        </div>\n    </div>\n</div>')}])}(),function(){"use strict";function e(e,t,n,i){var a=this;a.filterName=e.filter.name,a.filterDisplayName=e.filter.label,a.filterValue=n.search()[a.filterName]||"",t.addFilterController(this),this.getFilterValue=function(){var e={};return""!==a.filterValue.trim()&&(e[a.filterName]="%"+a.filterValue+"%",e)},this.getInitialValue=function(){var e={};return e[a.filterName]="",e},this.setInitialValue=function(){a.filterValue=""},e.$on("$destroy",function(){t.deleteFilterController(a)}),e.$watch(function(){return a.filterValue},function(e){""!==e?n.search(a.filterName,e):n.search(a.filterName,null)})}angular.module("universal.editor").controller("EditorFilterStringController",e),e.$inject=["$scope","FilterFieldsStorage","$location","RestApiService"]}(),function(){"use strict";function e(e){function t(e,t,n,i){t.on("$destroy",function(){e.$destroy()})}return{restrict:"A",replace:!0,scope:!0,template:e.get("module/components/editorFilterString/editorFilterString.html"),controller:"EditorFilterStringController",controllerAs:"vm",link:t}}angular.module("universal.editor").directive("editorFilterString",e),e.$inject=["$templateCache"]}(),function(e){try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/components/editorFilterString/editorFilterString.html",'\n<div>\n    <div class="filter-name-label"><span>{{vm.filterDisplayName}}</span></div>\n    <div class="filter-inner-wrapper">\n        <input type="text" name="{{vm.filterName}}" data-ng-model="vm.filterValue" class="form-control input-sm"/>\n    </div>\n</div>')}])}(),function(){"use strict";function e(e,t,n){var i=this;i.filterName=e.filter.name,i.filterDisplayName=e.filter.label,i.filterValueStartTime="",i.filterValueEndTime="",t.addFilterController(this),this.getFilterValue=function(){var e={};return(""!==i.filterValueStartTime||""!==i.filterValueEndTime)&&(""!==i.filterValueStartTime&&""===i.filterValueEndTime?e[">="+i.filterName]=n(i.filterValueStartTime).format("HH:mm:ss"):""===i.filterValueStartTime&&""!==i.filterValueEndTime?e["<="+i.filterName]=n(i.filterValueEndTime).format("HH:mm:ss"):(e[">="+i.filterName]=n(i.filterValueStartTime).format("HH:mm:ss"),e["<="+i.filterName]=n(i.filterValueEndTime).format("HH:mm:ss")),e)},this.getInitialValue=function(){var e={};return e[i.filterName]="",e},this.setInitialValue=function(){i.filterValueStartTime="",i.filterValueEndTime=""},e.$on("$destroy",function(){t.deleteFilterController(i)})}angular.module("universal.editor").controller("EditorFilterTimeController",e),e.$inject=["$scope","FilterFieldsStorage","moment"]}(),function(){"use strict";function e(e){function t(e,t,n,i){t.on("$destroy",function(){e.$destroy()})}return{restrict:"A",replace:!0,scope:!0,template:e.get("module/components/editorFilterTime/editorFilterTime.html"),controller:"EditorFilterTimeController",controllerAs:"vm",link:t}}angular.module("universal.editor").directive("editorFilterTime",e),e.$inject=["$templateCache"]}(),function(e){try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/components/editorFilterTime/editorFilterTime.html",'\n<div class="filter-time-wrapper">\n    <div class="filter-name-label"><span>{{vm.filterDisplayName}}</span></div>\n    <div class="filter-inner-wrapper">\n        <div class="filter-start">\n            <div class="editor-time">\n                <input data-date-time="" data-ng-model="vm.filterValueStartTime" data-format="HH:mm:ss" data-max-view="hours" data-min-view="minutes" data-view="hours" class="form-control input-sm"/>\n            </div>\n        </div><span class="divider">-</span>\n        <div class="filter-end">\n            <div class="editor-time">\n                <input data-date-time="" data-ng-model="vm.filterValueEndTime" data-format="HH:mm:ss" data-max-view="hours" data-min-view="minutes" data-view="hours" class="form-control input-sm"/>\n            </div>\n        </div>\n    </div>\n</div>')}])}(),function(){"use strict";function e(){}angular.module("universal.editor").controller("FilterWrapperController",e),e.$inject=[]}(),function(){"use strict";function e(e,t,n,i){function a(e,n,a,l){n.on("$destroy",function(){e.$destroy()}),n.ready(function(){n.find("input").bind("keydown",function(e){13==e.which&&e.preventDefault()})});var r=i.getEntityObject();angular.forEach(r.tabs,function(t){angular.forEach(t.fields,function(t){if(t.name==e.filterName)return void(e.filter=t)})}),n.append(new t(e).build())}return{restrict:"A",replace:!0,scope:{filterName:"@"},template:e.get("module/components/filterWrapper/filterWrapper.html"),controller:"FilterWrapperController",controllerAs:"vm",link:a}}angular.module("universal.editor").directive("filterWrapper",e),e.$inject=["$templateCache","FilterBuilder","configData","RestApiService"]}(),function(e){try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/components/filterWrapper/filterWrapper.html",'\n<div class="filter-wrapper"></div>')}])}(),function(){"use strict";var e={bindings:{field:"=",parentField:"=",parentFieldIndex:"="},transclude:!0,template:["$templateCache",function(e){return e.get("module/components/ueArray/ueArray.html")}],controller:"UeArrayController",controllerAs:"vm"};angular.module("universal.editor").component("ueArray",e)}(),function(){"use strict";function e(e,t,n,i,a,l,r){var o,d=this;o=d.parentField?d.parentFieldIndex?d.parentField+"_"+d.parentFieldIndex+"_"+d.fieldName:d.parentField+"_"+d.fieldName:d.field.name,d.fieldName=d.field.name,d.fieldDisplayName=d.field.label,d.hint=d.field.hint||!1,d.innerFields=d.field.fields,d.fieldsArray=[],d.multiple=d.field.hasOwnProperty("multiple")&&d.field.multiple===!0,a.addFieldController(this),this.getFieldValue=function(){var e={};return e[d.fieldName]=d.fieldsArray.length>0?[]:"",e},this.getInitialValue=function(){var e={};return e[d.fieldName]=[],e};var s=e.$on("editor:entity_loaded",function(e,t){d.multiple&&("new"===t.editorEntityType?(d.fieldsArray=[],r.setArrayField(d.fieldName,[])):(r.setArrayField(d.fieldName,JSON.parse(JSON.stringify(t[d.field.name]))),d.fieldsArray=t[d.field.name]))}),u=e.$on("editor:api_error_field_"+o,function(e,t){angular.isArray(t)?angular.forEach(t,function(e){d.error.indexOf(e)<0&&d.error.push(e)}):d.error.indexOf(t)<0&&d.error.push(t)});d.removeItem=function(e){var t=d.fieldsArray;d.fieldsArray=[],l(function(){r.removeFieldIndex(d.fieldName,e),t.splice(e,1),d.fieldsArray=t},0)},d.addItem=function(){d.fieldsArray.push("")},this.$onDestroy=function(){s(),u()},this.$postLink=function(){n.on("$destroy",function(){e.$destroy()})}}angular.module("universal.editor").controller("UeArrayController",e),e.$inject=["$scope","$rootScope","$element","configData","EditEntityStorage","$timeout","ArrayFieldStorage"]}(),function(e){try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/components/ueArray/ueArray.html",'\n<div class="editor-field-array">\n    <div class="field-name-label label-array">\n        <div data-ng-if="vm.hint" class="field-hint">\n            <div class="hint-text">{{vm.hint}}</div>\n        </div>{{vm.fieldDisplayName}}\n    </div>\n    <div class="field-array-wrapper">\n        <div data-ng-if="vm.multiple">\n            <div data-ng-repeat="array in vm.fieldsArray track by $index" data-ng-init="outerIndex = $index" class="item-array-wrapper">\n                <div data-ng-repeat="field in vm.innerFields" data-field-wrapper="" data-field-name="{{field.name}}" data-parent-field="{{vm.fieldName}}" data-parent-field-index="{{outerIndex}}"></div>\n                <div class="row">\n                    <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 col-lg-offset-6 col-md-offset-6 col-sm-offset-6 col-xs-offset-6">\n                        <div data-ng-click="vm.removeItem(outerIndex)" data-ng-if="!vm.readonly" class="btn btn-primary btn-xs">{{\'BUTTON.DELETE\' | translate}}</div>\n                    </div>\n                </div>\n            </div>\n            <div class="row">\n                <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6 col-lg-offset-6 col-md-offset-6 col-sm-offset-6 col-xs-offset-6">\n                    <div data-ng-click="vm.addItem()" data-ng-if="!vm.readonly" class="btn btn-primary btn-sm">{{\'BUTTON.ADD\' | translate}}</div>\n                </div>\n            </div>\n        </div>\n        <div data-ng-if="!vm.multiple">\n            <div data-ng-repeat="field in vm.innerFields" data-field-wrapper="" data-field-name="{{field.name}}" data-parent-field="{{vm.fieldName}}"></div>\n        </div>\n    </div>\n</div>')}])}(),function(){"use strict";var e={bindings:{setting:"="},template:["$templateCache",function(e){return e.get("module/components/ueAutocomplete/ueAutocomplete.html")}],controller:"UeAutocompleteController",controllerAs:"vm"};angular.module("universal.editor").component("ueAutocomplete",e)}(),function(){"use strict";function e(e,t,n,i,a,l,r){function o(){g.setting.hasOwnProperty("multiple")&&g.field.multiple===!0?g.fieldValue=[]:g.fieldValue=void 0,t.find(".autocomplete-field-search").removeClass("hidden"),g.inputValue="",g.sizeInput=1,g.selectedValues=[],g.placeholder=""}function d(e){if(g.error=[],!(""===e||e.length<=g.minCount))if(g.searching=!0,g.setting.hasOwnProperty("values"))angular.forEach(g.setting.values,function(t,n){var i={};angular.isArray(g.setting.values)?i[g.field_id]=t:i[g.field_id]=n,i[g.field_search]=t,s(t,e)&&!c(i)&&g.possibleValues.push(i)}),g.activeElement=0,g.searching=!1;else{var t={};t[g.field_search]="%"+e+"%",a.getUrlResource(g.setting.valuesRemote.url+"?filter="+JSON.stringify(t)).then(function(e){angular.forEach(e.data.items,function(e){c(e)||u(e)||g.possibleValues.push(e)}),g.activeElement=0,g.searching=!1},function(e){console.error('EditorFieldAutocompleteController: Не удалось получить значения для поля "'+g.setting.name+'" с удаленного ресурса'),g.searching=!1})}}function s(e,t){return e.toLowerCase().indexOf(t.toLowerCase())>=0}function u(e){var t=!1;return angular.forEach(g.possibleValues,function(n){n[g.field_id]==e[g.field_id]&&(t=!0)}),t}function c(e){var t=!1;return angular.forEach(g.selectedValues,function(n){n[g.field_id]==e[g.field_id]&&(t=!0)}),t}function m(){if(g.setting.hasOwnProperty("values"))angular.forEach(g.setting.values,function(e,t){var n={};Array.isArray(g.fieldValue)&&g.fieldValue.indexOf(t)>=0&&g.multiple?(angular.isArray(g.setting.values)?n[g.field_id]=e:n[g.field_id]=t,n[g.field_search]=e,g.selectedValues.push(n)):g.fieldValue!=t||g.multiple||(angular.isArray(g.setting.values)?n[g.field_id]=e:n[g.field_id]=t,n[g.field_search]=e,g.selectedValues.push(n),g.placeholder=n[g.field_search])}),g.preloadedData=!0;else if(g.setting.hasOwnProperty("valuesRemote")){if(void 0===g.fieldValue||null===g.fieldValue)return void(g.preloadedData=!0);var e;if(g.multiple&&angular.isArray(g.fieldValue)&&g.fieldValue.length>0)e={},e[g.field_id]=g.fieldValue;else{if(g.multiple||""===g.fieldValue)return void(g.preloadedData=!0);e={},e[g.field_id]=[],e[g.field_id].push(g.fieldValue)}a.getUrlResource(g.setting.valuesRemote.url+"?filter="+JSON.stringify(e)).then(function(e){angular.forEach(e.data.items,function(e){Array.isArray(g.fieldValue)&&(g.fieldValue.indexOf(e[g.field_id])>=0||g.fieldValue.indexOf(String(e[g.field_id]))>=0)&&g.multiple?g.selectedValues.push(e):g.fieldValue!=e[g.field_id]||g.multiple||(g.selectedValues.push(e),g.placeholder=e[g.field_search])}),g.preloadedData=!0},function(e){g.preloadedData=!0,console.error('EditorFieldAutocompleteController: Не удалось получить значения для поля "'+g.setting.name+'" с удаленного ресурса')})}else g.preloadedData=!0,console.error("EditorFieldAutocompleteController: Для поля не указан ни один тип получения значений ( локальный или удаленный )")}var f,p,g=this;p=g.setting.parentField?g.setting.parentFieldIndex?g.setting.parentField+"_"+g.setting.parentFieldIndex+"_"+g.fieldName:g.setting.parentField+"_"+g.fieldName:g.field.name;var v=angular.element(t[0].getElementsByClassName("possible-scroll")[0]),h=g.setting.component.settings.valuesRemote;g.field_id="id",g.field_search="title",h&&h.fields&&(h.fields.value&&(g.field_id=h.fields.value),h.fields.label?g.field_search=h.fields.label:g.field_search=g.field_id),g.fieldName=g.setting.name,g.readonly=g.setting.readonly||!1,g.selectedValues=[],g.inputValue="",g.possibleValues=[],g.activeElement=0,g.preloadedData=!1,g.searching=!1,g.maxItemsCount=g.setting.maxItems||Number.POSITIVE_INFINITY,g.minCount=g.setting.minCount||2,g.sizeInput=1,g.classInput={width:"1px"},g.showPossible=!1,g.placeholder="",g.fieldDisplayName=g.setting.component.settings.label,g.hint=g.setting.hint||!1,g.required=g.setting.required||!1,g.error=[],g.setting.hasOwnProperty("multiple")&&g.setting.multiple===!0?(g.multiple=!0,g.fieldValue=[],(g.setting.multiname||angular.isString(g.setting.multiname))&&(g.multiname=""+g.setting.multiname||"value")):(g.multiple=!1,g.fieldValue=void 0,g.classInput.width="99%",g.classInput["padding-right"]="25px"),g.setting.parentFieldIndex&&(g.multiple?(g.fieldValue=[],angular.forEach(r.getFieldValue(g.setting.parentField,g.setting.parentFieldIndex,g.setting.name),function(e){g.multiname?g.fieldValue.push(e[g.multiname]):g.fieldValue.push(e)})):g.fieldValue=r.getFieldValue(g.setting.parentField,g.setting.parentFieldIndex,g.setting.name)||g.fieldValue,g.preloadedData=!1,m()),i.addFieldController(this),t.find("input").bind("keydown",function(e){switch(e.which){case 13:if(e.preventDefault(),g.possibleValues.length<1)break;l(function(){g.addToSelected(e,g.possibleValues[g.activeElement])},0);break;case 40:if(e.preventDefault(),g.possibleValues.length<1)break;v=angular.element(t[0].getElementsByClassName("possible-scroll")[0]),g.activeElement<g.possibleValues.length-1&&(l(function(){g.activeElement++},0),l(function(){var e=angular.element(v[0].getElementsByClassName("active")[0])[0].offsetTop,t=angular.element(v[0].getElementsByClassName("active")[0])[0].clientHeight,n=v[0].scrollTop,i=v[0].clientHeight;e>=i+n-t&&(v[0].scrollTop+=t+1)},1));break;case 38:if(e.preventDefault(),g.possibleValues.length<1)break;v=angular.element(t[0].getElementsByClassName("possible-scroll")[0]),g.activeElement>0&&(l(function(){g.activeElement--},0),l(function(){var e=angular.element(v[0].getElementsByClassName("active")[0])[0].offsetTop,t=angular.element(v[0].getElementsByClassName("active")[0])[0].clientHeight,n=v[0].scrollTop;v[0].clientHeight;e<n&&(v[0].scrollTop-=t+1)},1))}}),this.getFieldValue=function(){var e,t={};return g.multiname?(e=[],angular.forEach(g.selectedValues,function(t){var n={};n[g.multiname]=t[g.field_id],e.push(n)})):g.multiple?(e=[],angular.forEach(g.selectedValues,function(t){e.push(t[g.field_id])})):e=g.selectedValues.length>0?g.selectedValues[0][g.field_id]:"",g.setting.parentField?g.setting.parentFieldIndex?(t[g.setting.parentField]=[],t[g.setting.parentField][g.setting.parentFieldIndex]={},t[g.setting.parentField][g.setting.parentFieldIndex][g.fieldName]=e):(t[g.setting.parentField]={},t[g.setting.parentField][g.fieldName]=e):t[g.fieldName]=e,t},this.getInitialValue=function(){var e={};return g.setting.parentField?g.multiple?(e[g.setting.parentField]={},e[g.setting.parentField][g.fieldName]=[]):(e[g.setting.parentField]={},e[g.setting.parentField][g.fieldName]=void 0):g.multiple?e[g.fieldName]=[]:e[g.fieldName]=void 0,e};var y,b=e.$on("editor:entity_loaded",function(n,a){return g.preloadedData=!1,t.find(".autocomplete-field-search").removeClass("hidden"),g.inputValue="",g.selectedValues=[],g.placeholder="",g.setting.requiredField&&(y=e.$watch(function(){var e=i.getValueField(g.setting.requiredField),t=!1,n=!1;return function a(e){for(var i=Object.keys(e),l=i.length;l--;){var r=e[i[l]];null!==r&&void 0!==r&&""!==r&&(angular.isObject(r)&&!n&&a(r),t=!0,n=!0)}}(e),t},function(e){e?g.readonly=g.setting.readonly||!1:(o(),g.readonly=!0)},!0)),"new"===a.editorEntityType?(g.setting.defaultValue?(g.fieldValue=g.multiple?[g.setting.defaultValue]:g.setting.defaultValue,m()):g.fieldValue=g.multiple?[]:void 0,a.hasOwnProperty(g.fieldName)&&(g.fieldValue=a[g.fieldName],m()),g.sizeInput=1,void(g.preloadedData=!0)):(g.setting.parentField?g.multiple?g.multiname?(g.fieldValue=[],
angular.forEach(a[g.setting.parentField][g.setting.name],function(e){g.fieldValue.push(e[g.multiname])})):(g.fieldValue=[],angular.forEach(a[g.setting.parentField][g.setting.name],function(e){g.fieldValue.push(e)})):g.fieldValue=a[g.setting.parentField][g.setting.name]:g.multiple?g.multiname?(g.fieldValue=[],angular.forEach(a[g.setting.name],function(e){g.fieldValue.push(e[g.multiname])})):(g.fieldValue=[],angular.forEach(a[g.setting.name],function(e){g.fieldValue.push(e)})):g.fieldValue=a[g.setting.name],void m())}),F=e.$on("editor:api_error_field_"+p,function(e,t){angular.isArray(t)?angular.forEach(t,function(e){g.error.indexOf(e)<0&&g.error.push(e)}):g.error.indexOf(t)<0&&g.error.push(t)}),V=e.$watch(function(){return g.inputValue},function(e){f&&l.cancel(f),g.showPossible=!0,g.possibleValues=[],g.multiple&&(g.sizeInput=e.length||1,1===g.sizeInput&&1!=e.length?g.classInput.width="1px":g.classInput.width="initial"),f=l(function(){d(e)},300)},!0),$=e.$watch(function(){return g.fieldValue},function(){g.error=[]});g.addToSelected=function(e,n){g.multiple||(g.selectedValues=[],g.placeholder=n[g.field_search]),g.selectedValues.push(n),t.find(".autocomplete-field-search").removeClass("hidden"),g.inputValue="",g.sizeInput=1,g.possibleValues=[],g.multiple||e.stopPropagation()},g.removeFromSelected=function(e,t){angular.forEach(g.selectedValues,function(e,n){e[g.field_id]==t[g.field_id]&&(g.selectedValues.splice(n,1),g.multiple||(g.placeholder=""))})},g.focusPossible=function(e){g.isActivePossible=e,g.multiple||t.find(".autocomplete-item").length>0&&(e?(t.find(".autocomplete-field-search").removeClass("hidden"),t.find(".autocomplete-item").addClass("opacity-item")):(t.find(".autocomplete-field-search").addClass("hidden"),t.find(".autocomplete-item").removeClass("opacity-item")))},g.deleteToAutocomplete=function(e){8==e.which&&g.selectedValues&&g.selectedValues.length&&!g.inputValue&&g.multiple&&g.removeFromSelected(e,g.selectedValues[g.selectedValues.length-1])},this.$postLink=function(){n.on("click",function(n){t[0].contains(n.target)||e.$apply(function(){g.showPossible=!1})}),e.inputFocus=function(){g.multiple||(t.find(".autocomplete-field-search").removeClass("hidden"),t.find(".autocomplete-item").addClass("opacity-item")),g.showPossible=!0,t.find("input")[0].focus()},t.on("$destroy",function(){e.$destroy()})},this.$onDestroy=function(){angular.isFunction(y)&&y(),b(),F(),V(),$(),i.deleteFieldController(g),g.setting.parentFieldIndex&&r.fieldDestroy(g.setting.parentField,g.setting.parentFieldIndex,g.setting.name,g.fieldValue)}}angular.module("universal.editor").controller("UeAutocompleteController",e),e.$inject=["$scope","$element","$document","EditEntityStorage","RestApiService","$timeout","ArrayFieldStorage"]}(),function(e){try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/components/ueAutocomplete/ueAutocomplete.html",'\n<div class="field-wrapper row">\n    <div class="form-group">\n        <label class="field-name-label">\n            <div data-ng-if="vm.hint" class="field-hint">\n                <div class="hint-text">{{vm.hint}}</div>\n            </div><span data-ng-class="vm.required ? \'editor-required\' : \'\' ">{{vm.fieldDisplayName}}:</span>\n        </label>\n        <div class="field-element">\n            <div class="col-lg-2 col-md-2 col-sm-3 col-xs-3">\n                <div data-ng-show="vm.preloadedData &amp;&amp; vm.selectedValues.length &lt; vm.maxItemsCount" data-ng-class="{&quot;active&quot; : vm.isActivePossible}" data-ng-click="inputFocus()" class="autocomplete-input-wrapper form-control">\n                    <div data-ng-repeat="acItem in vm.selectedValues" data-ng-show="vm.preloadedData" data-ng-if="vm.multiple" class="autocomplete-item">{{acItem[vm.field_search]}}<span data-ng-click="vm.removeFromSelected($event, acItem)" data-ng-if="!vm.readonly" class="remove-from-selected">×</span></div>\n                    <input type="text" ng-disabled="vm.readonly" data-ng-model="vm.inputValue" data-ng-focus="vm.focusPossible(true)" data-ng-blur="vm.focusPossible(false)" size="{{vm.sizeInput}}" data-ng-style="vm.classInput" data-ng-keydown="vm.deleteToAutocomplete($event)" placeholder="{{vm.placeholder}}" data-ng-class="!vm.isActivePossible ? &quot;color-placeholder&quot; : &quot;&quot;" class="autocomplete-field-search"/><span data-ng-if="!vm.multiple &amp;&amp; !!vm.selectedValues.length" data-ng-click="vm.removeFromSelected($event, vm.selectedValues[0])" class="selecte-delete selecte-delete-autocomplete">×</span>\n                    <div data-ng-show="vm.searching" class="loader-search-wrapper">\n                        <div class="loader-search">{{\'LOADING\' | translate}}</div>\n                    </div>\n                    <div data-ng-if="!vm.readonly &amp;&amp; (vm.possibleValues.length &gt; 0) &amp;&amp; vm.showPossible" class="possible-values possible-autocomplete active possible-bottom">\n                        <div class="possible-scroll">\n                            <div data-ng-repeat="possible in vm.possibleValues" data-ng-mouseover="vm.activeElement = $index" data-ng-click="vm.addToSelected($event, possible)" data-ng-class="vm.activeElement == $index ? \'active\' : \'\'" class="possible-value-item">{{possible[vm.field_search]}}</div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n    <div class="field-error-wrapper">\n        <div data-ng-repeat="err in vm.error track by $index" class="error-item alert alert-danger">{{err}}</div>\n    </div>\n</div>')}])}(),function(){"use strict";var e={template:["$templateCache",function(e){return e.get("module/components/ueButtonGoto/ueButtonGoto.html")}],bindings:{setting:"="},controller:"UeButtonGotoController",controllerAs:"vm"};angular.module("universal.editor").component("ueButtonGoto",e)}(),function(){"use strict";function e(e,t,n,i,a,l,r,o){var d=this,s=d.setting.component.settings.state,u=n.getEntityType();d.setting.component.settings.type?d.setting.component.settings.type:u;d.label=d.setting.component.settings.label,d.processing=n.isProcessing,d.entityId=d.setting.entityId;var c=e.$watch(function(){return n.isProcessing},function(e){d.processing=e});d.$onDestroy=function(){c()},t.bind("click",function(){var e={reload:!0},t=d.entityId||"new";if(!d.processing){var n=o.getStateConfig(s);n&&"ue-modal"===n.component.name&&(e.reload=!1),i.params.pk=t,i.go(n.name,{pk:d.entityId||"new"},e)}}),d.$postLink=function(){t.on("$destroy",function(){e.$destroy()})}}angular.module("universal.editor").controller("UeButtonGotoController",e),e.$inject=["$scope","$element","RestApiService","$state","$location","$uibModal","configData","EditEntityStorage"]}(),function(e){try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/components/ueButtonGoto/ueButtonGoto.html",'\n<div>\n    <button data-ng-class="{ processing : vm.processing}" data-ng-if="vm.setting.buttonClass == \'header\'" class="btn btn-lg btn-create btn-success">{{vm.label}}\n        <div data-ng-show="vm.processing" class="loader-search-wrapper">\n            <div class="loader-search">{{\'LOADING\' | translate}}</div>\n        </div>\n    </button>\n    <button data-ng-if="vm.setting.buttonClass == \'context\'" class="editor-action-button">{{vm.label}}</button>\n</div>')}])}(),function(){"use strict";var e={template:["$templateCache",function(e){return e.get("module/components/ueButtonModal/ueButtonModal.html")}],bindings:{setting:"="},controller:"UeButtonModalController",controllerAs:"vm"};angular.module("universal.editor").component("ueButtonModal",e)}(),function(){"use strict";function e(e,t,n,i,a,l,r,o){var d=this;d.label=d.setting.component.settings.label,d.action=d.setting.component.settings.action,d.beforeAction=d.setting.component.settings.beforeAction,n.find("button").bind("click",function(){var e=o.getCallback(d.beforeAction);"close"===d.action&&(e&&e(),r.close())}),n.on("$destroy",function(){t.$destroy()})}angular.module("universal.editor").controller("UeButtonModalController",e),e.$inject=["$rootScope","$scope","$element","RestApiService","configData","$window","ModalService","ButtonsService"]}(),function(e){try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/components/ueButtonModal/ueButtonModal.html",'\n<div>\n    <button data-ng-class="{ processing : vm.processing}" style="display: inline-block; margin: 10px;" class="btn btn-lg btn-create btn-success">{{vm.label}}\n        <div data-ng-show="vm.processing" class="loader-search-wrapper">\n            <div class="loader-search">{{\'LOADING\' | translate}}</div>\n        </div>\n    </button>\n</div>')}])}(),function(){"use strict";var e={template:["$templateCache",function(e){return e.get("module/components/ueButtonOpen/ueButtonOpen.html")}],bindings:{setting:"="},controller:"UeButtonOpenController",controllerAs:"vm"};angular.module("universal.editor").component("ueButtonOpen",e)}(),function(){"use strict";function e(e,t,n,i){var a,l,r=this;try{l=JSON.parse(t.buttonRequest),a=l.params}catch(o){}r.label=r.setting.component.settings.label,r.processing=i.isProcessing;var d=t.$watch(function(){return i.isProcessing},function(e){r.processing=e}),s=r.setting.entityId;r.$onDestroy=function(){d()},n.bind("click",function(){if(!r.processing){var e=i.getEntityObject().dataSource.url;i.loadChilds(s,l,e)}}),r.$postLink=function(){t.editor=i.getEntityType(),n.on("$destroy",function(){t.$destroy()})}}angular.module("universal.editor").controller("UeButtonOpenController",e),e.$inject=["$rootScope","$scope","$element","RestApiService"]}(),function(e){try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/components/ueButtonOpen/ueButtonOpen.html",'\n<button data-ng-class="{ processing : vm.processing}" class="editor-action-button">{{vm.label}}\n    <div data-ng-show="vm.processing" class="loader-search-wrapper">\n        <div class="loader-search">{{\'LOADING\' | translate}}</div>\n    </div>\n</button>')}])}(),function(){"use strict";var e={template:["$templateCache",function(e){return e.get("module/components/ueButtonRequest/ueButtonRequest.html")}],bindings:{setting:"="},controller:"UeButtonRequestController",controllerAs:"vm"};angular.module("universal.editor").component("ueButtonRequest",e)}(),function(){"use strict";function e(e,t,n,i,a,l){var r=this;r.label=r.setting.component.settings.label,n.bind("click",function(){if(r.setting.component.settings.target)window.open(r.setting.component.settings.url,r.setting.component.settings.target);else{var e={url:r.setting.component.settings.url,method:r.setting.component.settings.method,beforeSend:l.getCallback(r.setting.component.settings.beforeSend)};i.actionRequest(e).then(function(e){var t=l.getCallback(r.setting.component.settings.success);t&&t(e)},function(e){var t=l.getCallback(r.setting.component.settings.error);t&&t(e)})["finally"](function(){var e=l.getCallback(r.setting.component.settings.complete);e&&e(),i.isProcessing=!1})}}),r.$postLink=function(){t.editor=i.getEntityType(),n.on("$destroy",function(){t.$destroy()})}}angular.module("universal.editor").controller("UeButtonRequestController",e),e.$inject=["$rootScope","$scope","$element","RestApiService","configData","ButtonsService"]}(),function(e){try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/components/ueButtonRequest/ueButtonRequest.html",'\n<div>\n    <button data-ng-if="vm.setting.buttonClass == \'footer\'" class="btn btn-md btn-success">{{vm.label}}</button>\n    <button data-ng-if="vm.setting.buttonClass == \'header\'" class="btn btn-lg btn-success">{{vm.label}}</button>\n    <button data-ng-if="vm.setting.buttonClass == \'context\'" class="editor-action-button">{{vm.label}}</button>\n</div>')}])}(),function(){"use strict";var e={template:["$templateCache",function(e){return e.get("module/components/ueButtonService/ueButtonService.html")}],bindings:{setting:"="},controller:"UeButtonServiceController",controllerAs:"vm"};angular.module("universal.editor").component("ueButtonService",e)}(),function(){"use strict";function e(e,t,n,i,a,l,r){var o,d=this,s=d.setting.component.settings.action,u=d.setting.type;d.setting.component.settings.request&&(o=JSON.parse(d.setting.component.settings.request)),d.label=d.setting.component.settings.label,d.processing=a.isProcessing,d.entityId=d.setting.entityId,"delete"===s&&(d.disabled="new"===r.params.pk||!r.params.pk);var c=t.$watch(function(){return a.isProcessing},function(e){d.processing=e});d.$onDestroy=function(){c()},n.bind("click",function(){if(!d.processing&&!d.disabled)switch(s){case"save":"create"==u?(i.editEntityUpdate("create"),l.close()):"update"==u&&(a.editedEntityId=d.entityId,i.editEntityUpdate("update"),l.close());break;case"delete":confirm("Удалить запись «"+d.entityId+"»?")&&(a.deleteItemById(d.entityId,o,t.entityType,d.setting),l.close());break;case"presave":a.editedEntityId=d.entityId,i.editEntityPresave(o)}}),d.$postLink=function(){t.editor=a.getEntityType(),n.on("$destroy",function(){t.$destroy()})}}angular.module("universal.editor").controller("UeButtonServiceController",e),e.$inject=["$rootScope","$scope","$element","EditEntityStorage","RestApiService","ModalService","$state"]}(),function(e){try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/components/ueButtonService/ueButtonService.html",'\n<div>\n    <button data-ng-class="{ processing : vm.processing}" ng-disabled="vm.disabled" data-ng-if="vm.setting.buttonClass == \'footer\'" class="btn btn-md btn-success">{{vm.label}}\n        <div data-ng-show="vm.processing" class="loader-search-wrapper">\n            <div class="loader-search">{{\'LOADING\' | translate}}</div>\n        </div>\n    </button>\n    <button data-ng-if="vm.setting.buttonClass == \'context\'" class="editor-action-button">{{vm.label}}</button>\n</div>')}])}(),function(){"use strict";var e={bindings:{field:"=",parentField:"=",parentFieldIndex:"="},template:["$templateCache",function(e){return e.get("module/components/ueCheckbox/ueCheckbox.html")}],controller:"UeCheckboxController",controllerAs:"vm"};angular.module("universal.editor").component("ueCheckbox",e)}(),function(){"use strict";function e(e,t,n,i,a){function l(){o.fieldValue=o.parentFieldIndex?[]:void 0}var r,o=this;r=o.parentField?o.parentFieldIndex?o.parentField+"_"+o.parentFieldIndex+"_"+o.fieldName:o.parentField+"_"+o.fieldName:o.field.name;var d=o.field.valuesRemote;if(o.field_id="id",o.field_search="title",d&&d.fields&&(d.fields.value&&(o.field_id=d.fields.value),d.fields.label&&(o.field_search=d.fields.label)),o.fieldName=o.field.name,o.selectedValues=[],o.inputValue="",o.readonly=o.field.readonly||!1,o.parentFieldIndex=o.parentFieldIndex||!1,o.fieldDisplayName=o.setting.component.settings.label,o.hint=o.setting.hint||!1,o.required=o.setting.required||!1,o.error=[],(o.field.multiname||angular.isString(o.field.multiname))&&(o.multiname=""+o.field.multiname||"value"),n.addFieldController(this),o.parentFieldIndex){o.fieldValue=[];var s=a.getFieldValue(o.parentField,o.parentFieldIndex,o.field.name);s&&(angular.isArray(s)?angular.forEach(s,function(e){o.multiname?o.fieldValue.push(e[o.multiname]):o.fieldValue.push(e)}):o.multiname?o.fieldValue.push(s[o.multiname]):o.fieldValue.push(s))}o.field.hasOwnProperty("values")?angular.forEach(o.field.values,function(e,t){var n={};n[o.field_id]=t,n[o.field_search]=e,o.selectedValues.push(n)}):o.field.hasOwnProperty("valuesRemote")?i.getUrlResource(o.field.valuesRemote.url).then(function(e){angular.forEach(e.data.items,function(e){o.selectedValues.push(e)})},function(e){console.error('EditorFieldCheckboxController: Не удалось получить значения для поля "'+o.field.fieldName+'" с удаленного ресурса')}):console.error("EditorFieldCheckboxController: Для поля не указан ни один тип получения значений ( локальный или удаленный )"),this.getFieldValue=function(){var e,t={};if(o.selectedValues.length&&1===o.selectedValues.length)if(e="",angular.isUndefined(o.fieldValue)&&(o.fieldValue=[]),o.multiname){var n={};n[o.multiname]=o.fieldValue[0],e=n}else e=o.fieldValue[0];else o.selectedValues.length&&o.selectedValues.length>1&&(e=[],o.multiname?angular.forEach(o.fieldValue,function(t){var n={};n[o.multiname]=t,e.push(n)}):angular.forEach(o.fieldValue,function(t){e.push(t)}));return o.parentField?o.parentFieldIndex?(t[o.parentField]=[],t[o.parentField][o.parentFieldIndex]={},t[o.parentField][o.parentFieldIndex][o.fieldName]=e):(t[o.parentField]={},t[o.parentField][o.fieldName]=e):t[o.fieldName]=e,t},this.getInitialValue=function(){var e={};return o.parentField?(e[o.parentField]={},e[o.parentField][o.fieldName]=[]):e[o.fieldName]=[],e};var u,c=e.$on("editor:entity_loaded",function(t,i){return o.field.requiredField&&(u=e.$watch(function(){var e=n.getValueField(o.field.requiredField),t=!1,i=!1;return function a(e){for(var n=Object.keys(e),l=n.length;l--;){var r=e[n[l]];null!==r&&void 0!==r&&""!==r&&(angular.isObject(r)&&!i&&a(r),t=!0,i=!0)}}(e),t},function(e){e?o.readonly=o.field.readonly||!1:(l(),o.readonly=!0)},!0)),"new"===i.editorEntityType?(o.fieldValue=[],void angular.forEach(o.field.defaultValue,function(e){o.multiname?o.fieldValue.push(e[o.multiname]):o.fieldValue.push(e)})):void(o.parentField?(o.fieldValue=[],i[o.field.name]&&(angular.isArray(i[o.parentField][o.field.name])?angular.forEach(i[o.parentField][o.field.name],function(e){o.multiname?o.fieldValue.push(e[o.multiname]):o.fieldValue.push(e)}):o.multiname?o.fieldValue.push(i[o.parentField][o.field.name][o.multiname]):o.fieldValue.push(i[o.parentField][o.field.name]))):(o.fieldValue=[],i[o.field.name]&&(angular.isArray(i[o.field.name])?angular.forEach(i[o.field.name],function(e){o.multiname?o.fieldValue.push(e[o.multiname]):o.fieldValue.push(e)}):o.multiname?o.fieldValue.push(i[o.field.name][o.multiname]):o.fieldValue.push(i[o.field.name]))))}),m=e.$on("editor:api_error_field_"+r,function(e,t){angular.isArray(t)?angular.forEach(t,function(e){o.error.indexOf(e)<0&&o.error.push(e)}):o.error.indexOf(t)<0&&o.error.push(t)}),f=e.$watch(function(){return o.fieldValue},function(){o.error=[]},!0);this.$onDestroy=function(){angular.isFunction(u)&&u(),c(),m(),f(),n.deleteFieldController(o),o.parentFieldIndex&&a.fieldDestroy(o.parentField,o.parentFieldIndex,o.field.name,o.fieldValue)},this.$postLink=function(){t.on("$destroy",function(){e.$destroy()})}}angular.module("universal.editor").controller("UeCheckboxController",e),e.$inject=["$scope","$element","EditEntityStorage","RestApiService","ArrayFieldStorage"]}(),function(e){try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/components/ueCheckbox/ueCheckbox.html",'\n<div class="field-wrapper row">\n    <div class="form-group">\n        <label class="field-name-label">\n            <div data-ng-if="vm.hint" class="field-hint">\n                <div class="hint-text">{{vm.hint}}</div>\n            </div><span data-ng-class="vm.required ? \'editor-required\' : \'\' ">{{vm.fieldDisplayName}}:</span>\n        </label>\n        <div class="field-element">\n            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">\n                <div data-ng-repeat="item in vm.selectedValues" data-ng-class="vm.readonly ? \'disabled\' : \'\'" class="checkbox">\n                    <label>\n                        <input type="checkbox" data-ng-disabled="vm.readonly" data-checklist-model="vm.fieldValue" data-checklist-value="item[vm.field_id]"/>{{item[vm.field_search]}}\n                    </label>\n                </div>\n            </div>\n        </div>\n    </div>\n    <div class="field-error-wrapper">\n        <div data-ng-repeat="err in vm.error track by $index" class="error-item alert alert-danger">{{err}}</div>\n    </div>\n</div>')}])}(),function(){"use strict";var e={bindings:{field:"=",parentField:"=",parentFieldIndex:"="},template:["$templateCache",function(e){return e.get("module/components/ueColorpicker/ueColorpicker.html")}],controller:"UeColorpickerController",controllerAs:"vm"};angular.module("universal.editor").component("ueColorpicker",e)}(),function(){"use strict";function e(e,t,n,i){var a,l=this,r="#000000";a=l.parentField?l.parentFieldIndex?l.parentField+"_"+l.parentFieldIndex+"_"+l.fieldName:l.parentField+"_"+l.fieldName:l.field.name,l.fieldName=l.field.name,l.readonly=l.field.readonly||!1,l.parentFieldIndex=l.parentFieldIndex||!1,l.fieldDisplayName=l.setting.component.settings.label,l.hint=l.setting.hint||!1,l.required=l.setting.required||!1,l.error=[],l.field.hasOwnProperty("multiple")&&l.field.multiple===!0?(l.multiple=!0,l.fieldValue=[r],(l.field.multiname||angular.isString(l.field.multiname))&&(l.multiname=""+l.field.multiname||"value")):(l.multiple=!1,l.fieldValue=r),l.parentFieldIndex&&(l.multiple?(l.fieldValue=[],angular.forEach(i.getFieldValue(l.parentField,l.parentFieldIndex,l.field.name),function(e){l.multiname?l.fieldValue.push(e[l.multiname]):l.fieldValue.push(e)})):l.fieldValue=i.getFieldValue(l.parentField,l.parentFieldIndex,l.field.name)||""),n.addFieldController(this),this.getFieldValue=function(){var e,t={};return l.multiname?(e=[],angular.forEach(l.fieldValue,function(t){var n={};n[l.multiname]=t,e.push(n)})):l.multiple?(e=[],angular.forEach(l.fieldValue,function(t){e.push(t)})):e=l.fieldValue,l.parentField?l.parentFieldIndex?(t[l.parentField]=[],t[l.parentField][l.parentFieldIndex]={},t[l.parentField][l.parentFieldIndex][l.fieldName]=e):(t[l.parentField]={},t[l.parentField][l.fieldName]=e):t[l.fieldName]=e,t},this.getInitialValue=function(){var e={};return l.parentField?l.multiple?(e[l.parentField]={},e[l.parentField][l.fieldName]=[r]):(e[l.parentField]={},e[l.parentField][l.fieldName]=r):l.multiple?e[l.fieldName]=[]:e[l.fieldName]=r,e},l.addItem=function(){l.fieldValue.push(r)},l.removeItem=function(e){angular.forEach(l.fieldValue,function(t,n){n==e&&l.fieldValue.splice(e,1)})};var o=e.$on("editor:entity_loaded",function(e,t){return"new"===t.editorEntityType?void(l.fieldValue=l.multiple?[l.field.defaultValue||r]:l.field.defaultValue||r):void(l.parentField?l.multiple?l.multiname?(l.fieldValue=[],angular.forEach(t[l.parentField][l.field.name],function(e){l.fieldValue.push(e[l.multiname])})):(l.fieldValue=[],angular.forEach(t[l.parentField][l.field.name],function(e){l.fieldValue.push(e)})):l.fieldValue=t[l.parentField][l.field.name]:l.multiple?l.multiname?(l.fieldValue=[],angular.forEach(t[l.field.name],function(e){l.fieldValue.push(e[l.multiname])})):(l.fieldValue=[],angular.forEach(t[l.field.name],function(e){l.fieldValue.push(e)})):l.fieldValue=t[l.field.name])}),d=e.$on("editor:api_error_field_"+a,function(e,t){angular.isArray(t)?angular.forEach(t,function(e){l.error.indexOf(e)<0&&l.error.push(e)}):l.error.indexOf(t)<0&&l.error.push(t)}),s=e.$watch(function(){return l.fieldValue},function(){l.error=[]});this.$onDestroy=function(){o(),d(),s(),n.deleteFieldController(l),l.parentFieldIndex&&i.fieldDestroy(l.parentField,l.parentFieldIndex,l.field.name,l.fieldValue)},this.$postLink=function(){t.on("$destroy",function(){e.$destroy()})}}angular.module("universal.editor").controller("UeColorpickerController",e),e.$inject=["$scope","$element","EditEntityStorage","ArrayFieldStorage"]}(),function(e){try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/components/ueColorpicker/ueColorpicker.html",'\n<div class="field-wrapper row">\n    <div class="form-group">\n        <label class="field-name-label">\n            <div data-ng-if="vm.hint" class="field-hint">\n                <div class="hint-text">{{vm.hint}}</div>\n            </div><span data-ng-class="vm.required ? \'editor-required\' : \'\' ">{{vm.fieldDisplayName}}:</span>\n        </label>\n        <div class="field-element">\n            <div data-ng-if="vm.multiple" class="col-lg-2 col-md-2 col-sm-3 col-xs-3">\n                <div data-ng-repeat="field_item in vm.fieldValue track by $index" class="item-colorpicker-wrapper input-group">\n                    <input type="text" data-ng-disabled="vm.readonly" data-minicolors="" data-ng-model="vm.fieldValue[$index]" class="form-control input-sm"/><span class="input-group-btn">\n                        <button data-ng-click="vm.removeItem($index)" data-ng-if="!vm.readonly" class="btn btn-default btn-sm">x</button></span>\n                </div>\n                <div data-ng-click="vm.addItem()" data-ng-if="!vm.readonly" class="btn btn-primary btn-sm">{{\'BUTTON.ADD\' | translate}}</div>\n            </div>\n            <div data-ng-if="!vm.multiple" class="col-lg-2 col-md-2 col-sm-3 col-xs-3">\n                <input type="text" data-ng-disabled="vm.readonly" data-minicolors="" data-ng-model="vm.fieldValue" class="form-control input-sm"/>\n            </div>\n        </div>\n    </div>\n    <div class="field-error-wrapper">\n        <div data-ng-repeat="err in vm.error track by $index" class="error-item alert alert-danger">{{err}}</div>\n    </div>\n</div>')}])}(),function(){"use strict";var e={bindings:{field:"=",parentField:"=",parentFieldIndex:"="},template:["$templateCache",function(e){return e.get("module/components/ueDate/ueDate.html")}],controller:"UeDateController",controllerAs:"vm"};angular.module("universal.editor").component("ueDate",e)}(),function(){"use strict";function e(e,t,n,i,a){function l(){o.fieldValue=o.field.hasOwnProperty("multiple")&&o.field.multiple===!0?[]:""}var r,o=this;if(r=o.parentField?o.parentFieldIndex?o.parentField+"_"+o.parentFieldIndex+"_"+o.fieldName:o.parentField+"_"+o.fieldName:o.field.name,o.fieldName=o.field.name,o.fieldValue="",o.readonly=o.field.readonly||!1,o.parentFieldIndex=o.parentFieldIndex||!1,o.fieldDisplayName=o.setting.component.settings.label,o.hint=o.setting.hint||!1,o.required=o.setting.required||!1,o.error=[],o.field.hasOwnProperty("multiple")&&o.field.multiple===!0?(o.multiple=!0,o.fieldValue=[],(o.field.multiname||angular.isString(o.field.multiname))&&(o.multiname=""+o.field.multiname||"value")):(o.multiple=!1,o.fieldValue=""),o.parentFieldIndex)if(o.multiple)o.fieldValue=[],angular.forEach(a.getFieldValue(o.parentField,o.parentFieldIndex,o.field.name),function(e){o.multiname?o.fieldValue.push(e[o.multiname]?i(e[o.multiname],"YYYY-MM-DD HH:mm:ss"):""):o.fieldValue.push(e?i(e,"YYYY-MM-DD HH:mm:ss"):"")});else{var d=a.getFieldValue(o.parentField,o.parentFieldIndex,o.field.name);o.fieldValue=d?i(d,"YYYY-MM-DD HH:mm:ss"):o.fieldValue}n.addFieldController(this),this.getFieldValue=function(){var e,t={};return o.multiname?(e=[],angular.forEach(o.fieldValue,function(t){if(t&&""!==t&&i.isMoment(t)){var n={};n[o.multiname]=i(t).set({second:0,minute:0,hour:0}).format("YYYY-MM-DD HH:mm:ss"),e.push(n)}})):o.multiple?(e=[],angular.forEach(o.fieldValue,function(t){e.push(i(t).set({second:0,minute:0,hour:0}).format("YYYY-MM-DD HH:mm:ss"))})):e=void 0!==o.fieldValue&&""!==o.fieldValue&&i.isMoment(o.fieldValue)?i(o.fieldValue).set({second:0,minute:0,hour:0}).format("YYYY-MM-DD HH:mm:ss"):"",o.parentField?o.parentFieldIndex?(t[o.parentField]=[],t[o.parentField][o.parentFieldIndex]={},t[o.parentField][o.parentFieldIndex][o.fieldName]=e):(t[o.parentField]={},t[o.parentField][o.fieldName]=e):t[o.fieldName]=e,t},this.getInitialValue=function(){var e={};return o.parentField?o.multiple?(e[o.parentField]={},e[o.parentField][o.fieldName]=[]):(e[o.parentField]={},e[o.parentField][o.fieldName]=i()):o.multiple?e[o.fieldName]=[]:e[o.fieldName]=i(),e},o.addItem=function(){o.fieldValue.push(i())},o.removeItem=function(e){angular.forEach(o.fieldValue,function(t,n){n==e&&o.fieldValue.splice(e,1)})};var s,u=e.$on("editor:entity_loaded",function(t,a){if(o.field.requiredField&&(s=e.$watch(function(){var e=n.getValueField(o.field.requiredField),t=!1,i=!1;return function a(e){for(var n=Object.keys(e),l=n.length;l--;){var r=e[n[l]];null!==r&&void 0!==r&&""!==r&&(angular.isObject(r)&&!i&&a(r),t=!0,i=!0)}}(e),t},function(e){e?o.readonly=o.field.readonly||!1:(l(),o.readonly=!0)},!0)),"new"===a.editorEntityType){var r=i();return o.field.defaultValue&&i(o.field.defaultValue).isValid()&&(r=i(o.field.defaultValue)),void(o.fieldValue=o.multiple?[r]:r)}o.parentField?o.multiple?o.multiname?(o.fieldValue=[],angular.forEach(a[o.parentField][o.field.name],function(e){o.fieldValue.push(i(e[o.multiname],"YYYY-MM-DD HH:mm:ss"))})):(o.fieldValue=[],angular.forEach(a[o.parentField][o.field.name],function(e){o.fieldValue.push(i(e,"YYYY-MM-DD HH:mm:ss"))})):o.fieldValue=a[o.parentField][o.field.name]?i(a[o.parentField][o.field.name],"YYYY-MM-DD HH:mm:ss"):"":o.multiple?o.multiname?(o.fieldValue=[],angular.forEach(a[o.field.name],function(e){o.fieldValue.push(i(e[o.multiname],"YYYY-MM-DD HH:mm:ss"))})):(o.fieldValue=[],angular.forEach(a[o.field.name],function(e){o.fieldValue.push(i(e,"YYYY-MM-DD HH:mm:ss"))})):o.fieldValue=a[o.field.name]?i(a[o.field.name],"YYYY-MM-DD HH:mm:ss"):""}),c=e.$on("editor:api_error_field_"+r,function(e,t){angular.isArray(t)?angular.forEach(t,function(e){o.error.indexOf(e)<0&&o.error.push(e)}):o.error.indexOf(t)<0&&o.error.push(t)}),m=e.$watch(function(){return o.fieldValue},function(){o.error=[]},!0);this.$onDestroy=function(){angular.isFunction(s)&&s(),u(),c(),m(),n.deleteFieldController(o),o.parentFieldIndex&&a.fieldDestroy(o.parentField,o.parentFieldIndex,o.field.name,o.fieldValue)},this.$postLink=function(){t.on("$destroy",function(){e.$destroy()})}}angular.module("universal.editor").controller("UeDateController",e),e.$inject=["$scope","$element","EditEntityStorage","moment","ArrayFieldStorage"]}(),function(e){try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/components/ueDate/ueDate.html",'\n<div class="field-wrapper row">\n    <div class="form-group">\n        <label class="field-name-label">\n            <div data-ng-if="vm.hint" class="field-hint">\n                <div class="hint-text">{{vm.hint}}</div>\n            </div><span data-ng-class="vm.required ? \'editor-required\' : \'\' ">{{vm.fieldDisplayName}}:</span>\n        </label>\n        <div class="field-element">\n            <div data-ng-if="vm.multiple" class="col-lg-2 col-md-2 col-sm-3 col-xs-3">\n                <div data-ng-repeat="field_item in vm.fieldValue track by $index" class="item-datepicker-wrapper input-group">\n                    <input data-date-time="" name="{{vm.fieldName}}" data-ng-disabled="vm.readonly" data-ng-model="vm.fieldValue[$index]" data-format="DD.MM.YYYY" data-max-view="year" data-min-view="date" data-view="date" class="form-control input-sm"/><span class="input-group-btn">\n                        <button data-ng-click="vm.removeItem($index)" data-ng-if="!vm.readonly" class="btn btn-default btn-sm">x</button></span>\n                </div>\n                <div data-ng-click="vm.addItem()" data-ng-if="!vm.readonly || !vm.emptyRequiredField" class="btn btn-primary btn-sm">{{\'BUTTON.ADD\' | translate}}</div>\n            </div>\n            <div data-ng-if="!vm.multiple" class="col-lg-2 col-md-2 col-sm-3 col-xs-3">\n                <input data-date-time="" name="{{vm.fieldName}}" data-ng-disabled="vm.readonly" data-ng-model="vm.fieldValue" data-format="DD.MM.YYYY" data-max-view="year" data-min-view="date" data-view="date" class="form-control input-sm"/>\n            </div>\n        </div>\n    </div>\n    <div class="field-error-wrapper">\n        <div data-ng-repeat="err in vm.error track by $index" class="error-item alert alert-danger">{{err}}</div>\n    </div>\n</div>');
}])}(),function(){"use strict";var e={bindings:{field:"=",parentField:"=",parentFieldIndex:"="},template:["$templateCache",function(e){return e.get("module/components/ueDatetime/ueDatetime.html")}],controller:"UeDatetimeController",controllerAs:"vm"};angular.module("universal.editor").component("ueDatetime",e)}(),function(){"use strict";function e(e,t,n,i,a){function l(){o.fieldValue=o.field.hasOwnProperty("multiple")&&o.field.multiple===!0?[]:""}var r,o=this;r=o.parentField?o.parentFieldIndex?o.parentField+"_"+o.parentFieldIndex+"_"+o.fieldName:o.parentField+"_"+o.fieldName:o.field.name,o.fieldName=o.field.name,o.fieldValue="",o.readonly=o.field.readonly||!1,o.parentFieldIndex=o.parentFieldIndex||!1,o.multiname=o.field.multiname||"value",o.fieldDisplayName=o.setting.component.settings.label,o.hint=o.setting.hint||!1,o.required=o.setting.required||!1,o.error=[],o.field.hasOwnProperty("multiple")&&o.field.multiple===!0?(o.multiple=!0,o.fieldValue=[]):(o.multiple=!1,o.fieldValue=i.utc()),o.parentFieldIndex&&(o.multiple?(o.fieldValue=[],angular.forEach(a.getFieldValue(o.parentField,o.parentFieldIndex,o.field.name),function(e){o.fieldValue.push(e[o.multiname])})):o.fieldValue=a.getFieldValue(o.parentField,o.parentFieldIndex,o.field.name)||o.fieldValue),n.addFieldController(this),this.getFieldValue=function(){var e,t={};return o.multiple&&o.multiname?(e=[],angular.forEach(o.fieldValue,function(t){if(t&&""!==t&&i.isMoment(t)){var n={};n[o.multiname]=i.utc(t).format("YYYY-MM-DD HH:mm:ss"),e.push(n)}})):e=void 0!==o.fieldValue&&""!==o.fieldValue&&i.isMoment(o.fieldValue)?i.utc(o.fieldValue).format("YYYY-MM-DD HH:mm:ss"):"",o.parentField?o.parentFieldIndex?(t[o.parentField]=[],t[o.parentField][o.parentFieldIndex]={},t[o.parentField][o.parentFieldIndex][o.fieldName]=e):(t[o.parentField]={},t[o.parentField][o.fieldName]=e):t[o.fieldName]=e,t},this.getInitialValue=function(){var e={};return o.parentField?o.multiple?(e[o.parentField]={},e[o.parentField][o.fieldName]=[]):(e[o.parentField]={},e[o.parentField][o.fieldName]=i.utc()):o.multiple?e[o.fieldName]=[]:e[o.fieldName]=i.utc(),e},o.addItem=function(){o.fieldValue.push(i.utc())},o.removeItem=function(e){angular.forEach(o.fieldValue,function(t,n){n==e&&o.fieldValue.splice(e,1)})};var d,s=e.$on("editor:entity_loaded",function(t,a){if(o.field.requiredField&&(d=e.$watch(function(){var e=n.getValueField(o.field.requiredField),t=!1,i=!1;return function a(e){for(var n=Object.keys(e),l=n.length;l--;){var r=e[n[l]];null!==r&&void 0!==r&&""!==r&&(angular.isObject(r)&&!i&&a(r),t=!0,i=!0)}}(e),t},function(e){e?o.readonly=o.field.readonly||!1:(l(),o.readonly=!0)},!0)),"new"===a.editorEntityType){var r=i().utc();return o.field.defaultValue&&i(o.field.defaultValue).isValid()&&(r=i(o.field.defaultValue,"YYYY-MM-DD HH:mm").utc()),void(o.fieldValue=o.multiple?[r]:r)}o.parentField?o.multiple?(o.fieldValue=[],angular.forEach(a[o.parentField][o.field.name],function(e){o.fieldValue.push(i.utc(e[o.multiname],"YYYY-MM-DD HH:mm:ss"))})):o.fieldValue=null!==a[o.parentField][o.field.name]?i.utc(a[o.parentField][o.field.name],"YYYY-MM-DD HH:mm:ss"):"":o.multiple?(o.fieldValue=[],angular.forEach(a[o.field.name],function(e){o.fieldValue.push(i.utc(e[o.multiname],"YYYY-MM-DD HH:mm:ss"))})):o.fieldValue=null!==a[o.field.name]?i.utc(a[o.field.name]):""}),u=e.$on("editor:api_error_field_"+r,function(e,t){angular.isArray(t)?angular.forEach(t,function(e){o.error.indexOf(e)<0&&o.error.push(e)}):o.error.indexOf(t)<0&&o.error.push(t)}),c=e.$watch(function(){return o.fieldValue},function(){o.error=[]},!0);this.$onDestroy=function(){angular.isFunction(d)&&d(),s(),u(),c(),n.deleteFieldController(o),o.parentFieldIndex&&a.fieldDestroy(o.parentField,o.parentFieldIndex,o.field.name,o.fieldValue)},this.$postLink=function(){t.on("$destroy",function(){e.$destroy()})}}angular.module("universal.editor").controller("UeDatetimeController",e),e.$inject=["$scope","$element","EditEntityStorage","moment","ArrayFieldStorage"]}(),function(e){try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/components/ueDatetime/ueDatetime.html",'\n<div class="field-wrapper row">\n    <div class="form-group">\n        <label class="field-name-label">\n            <div data-ng-if="vm.hint" class="field-hint">\n                <div class="hint-text">{{vm.hint}}</div>\n            </div><span data-ng-class="vm.required ? \'editor-required\' : \'\' ">{{vm.fieldDisplayName}}:</span>\n        </label>\n        <div class="field-element">\n            <div data-ng-if="vm.multiple" class="col-lg-2 col-md-2 col-sm-3 col-xs-3">\n                <div data-ng-repeat="field_item in vm.fieldValue track by $index" class="item-datepicker-wrapper input-group">\n                    <input date-time="" name="{{vm.fieldName}}" data-ng-disabled="vm.readonly" ng-model="vm.fieldValue[$index]" view="date" timezone="UTC" format="YYYY-MM-DD HH:mm:ss" class="form-control input-sm"/><span class="input-group-btn">\n                        <button data-ng-click="vm.removeItem($index)" data-ng-if="!vm.readonly" class="btn btn-default btn-sm">x</button></span>\n                </div>\n                <div data-ng-click="vm.addItem()" data-ng-if="!vm.readonly" class="btn btn-primary btn-sm">{{\'BUTTON.ADD\' | translate}}</div>\n            </div>\n            <div data-ng-if="!vm.multiple" class="col-lg-2 col-md-2 col-sm-3 col-xs-3">\n                <input date-time="" name="{{vm.fieldName}}" data-ng-disabled="vm.readonly" ng-model="vm.fieldValue" view="date" timezone="UTC" format="YYYY-MM-DD HH:mm:ss" class="form-control input-sm"/>\n            </div>\n        </div>\n    </div>\n    <div class="field-error-wrapper">\n        <div data-ng-repeat="err in vm.error track by $index" class="error-item alert alert-danger">{{err}}</div>\n    </div>\n</div>')}])}(),function(){"use strict";var e={bindings:{setting:"=",funcCloseModal:"&"},template:["$templateCache",function(e){return e.get("module/components/ueForm/ueForm.html")}],controller:"UeFormController",controllerAs:"vm"};angular.module("universal.editor").component("ueForm",e)}(),function(){"use strict";function e(e,t,n,i,a,l,r,o,d,s,u,c,m,f,p){e.entity=i.getEntityType();var g,v=(i.getEntityObject(),this);v.assetsPath="/assets/universal-editor",v.configData=n,v.correctEntityType=!0,v.entityLoaded=!1,v.listLoaded=!1,v.loadingData=!0,v.tabs=[],v.tableFields=[],v.links=[],v.errors=[],v.notifys=[],v.tabsVisibility=[],v.currentTab=v.setting.component.settings.body[0].component.settings.label,v.entityId="",v.editorEntityType="new",v.editFooterBar=v.setting.component.settings.footer,v.editFooterBarNew=[],v.editFooterBarExist=[],v.parentButton=!1,v.filterFields=[],v.idField="id",v.visibleFilter=!0,v.autoCompleteFields=[],v.entityType=e.entity,v.setting.component.settings.modal&&s.params.pk&&"new"!==s.params.pk&&(i.isProcessing=!1,i.getItemById(s.params.pk)),v.configData.ui&&v.configData.ui.assetsPath&&(v.assetsPath=v.configData.ui.assetsPath),v.setting.component.settings.dataSource.hasOwnProperty("primaryKey")&&(v.idField=v.setting.component.settings.dataSource.primaryKey||v.idField),g="items",angular.forEach(v.editFooterBar,function(e,t){"new"===s.params.pk?e.type="create":e.type="update"}),angular.forEach(v.setting.component.settings.body,function(e){var t={};t.label=e.component.settings.label,t.fields=[],angular.forEach(e.component.settings.fields,function(e){if(angular.isString(e)){var n=v.setting.component.settings.dataSource.fields.filter(function(t){return t.name==e});n.length>0&&t.fields.push(n[0])}else t.fields.push(e)}),v.tabs.push(t)}),v.getScope=function(){return e},v.setTabVisible=function(e,t){v.tabsVisibility[e]=t},v.closeEditor=function(){e.$apply(function(){v.entityLoaded=!1})},v.closeButton=function(){v.entityLoaded=!1,v.listLoaded=!1;var e={},t=!1,n=p.getStateConfig("index");s.params.back&&(e.type=s.params.back),s.params.parent&&(e.parent=s.params.parent,t=!1),i.getItemsList({url:v.setting.component.settings.dataSource.url}),s.go(n.name,e,{reload:t})},v.toggleFilterVisibility=function(){v.entityLoaded||(v.visibleFilter=!v.visibleFilter)},e.$on("editor:entity_loaded",function(e,t){v.editorEntityType=t.editorEntityType,v.entityId=t[v.idField],v.entityLoaded=!0}),e.$on("editor:server_error",function(e,t){v.errors.push(t)}),"new"!==s.params.pk&&(s.params.pk?i.getItemById(s.params.pk,v.setting.component.settings.dataSource):v.setting.pk&&i.getItemById(v.setting.pk,v.setting.component.settings.dataSource)),e.$on("editor:presave_entity_created",function(e,t){c("CHANGE_RECORDS.CREATE").then(function(e){u.success(e)}),v.entityId=t,v.editorEntityType="exist"}),e.$on("editor:presave_entity_updated",function(e,t){c("CHANGE_RECORDS.UPDATE").then(function(e){u.success(e)})}),e.$on("editor:entity_success_deleted",function(e,t){c("CHANGE_RECORDS.DELETE").then(function(e){u.success(e)})}),e.$on("editor:field_error",function(e,t){v.errors.push(t)}),e.$on("editor:request_start",function(e,t){v.errors=[],v.notifys=[]}),e.$watch(function(){return i.isProcessing},function(e){v.loadingData=e}),n.hasOwnProperty("ui")&&n.ui.hasOwnProperty("language")&&(n.ui.language.search(".json")!==-1?c.use(n.ui.language):"ru"!==n.ui.language&&c.use("assets/json/language/"+n.ui.language+".json")),v.clickEnter=function(e){13===e.keyCode&&v.applyFilter()},"new"===s.params.pk&&(v.entityLoaded=!0)}angular.module("universal.editor").controller("UeFormController",e),e.$inject=["$scope","$rootScope","configData","RestApiService","FilterFieldsStorage","$location","$document","$timeout","$httpParamSerializer","$state","toastr","$translate","ConfigDataProvider","ModalService","EditEntityStorage"]}(),function(e){try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/components/ueForm/ueForm.html",'\n<div class="editor-body">\n    <div data-ng-click="vm.closeButton()" ng-style="{\'background-image\':\'url(\'+ vm.assetsPath +\'/images/close.jpg)\'}" class="close-editor"></div>\n    <div class="nav nav-tabs">\n        <li data-ng-repeat="tab in vm.tabs" data-ng-class="vm.currentTab == tab.label ? \'active\' : \'\'" data-ng-click="vm.currentTab = tab.label"><a href="">{{tab.label}}</a></li>\n    </div>\n    <div class="tab-content-wrapper">\n        <div data-ng-repeat="tab in vm.tabs" data-ng-show="vm.currentTab == tab.label" class="tab-item-content">\n            <div class="field-content-wrapper">\n                <component-wrapper data-ng-repeat="field in tab.fields" data-setting="field" data-button-class="footer"></component-wrapper>\n            </div>\n        </div>\n    </div>\n    <div class="field-error-bottom-wrapper">\n        <div data-ng-repeat="err in vm.errors" class="error-item alert alert-danger">{{err}}</div>\n    </div>\n    <div class="field-notify-bottom-wrapper">\n        <div data-ng-repeat="notify in vm.notifys" class="notify-item">{{notify}}</div>\n    </div>\n    <div data-ng-if="vm.entityLoaded" class="editor-entity-actions">\n        <component-wrapper data-ng-repeat="button in vm.editFooterBar track by $index" data-entity-id="{{vm.entityId}}" data-setting="button" data-button-class="footer" class="editor-action-button"></component-wrapper>\n    </div>\n</div>')}])}(),function(){"use strict";var e={bindings:{setting:"="},transclude:!0,template:["$templateCache",function(e){return e.get("module/components/ueFormGroup/ueFormGroup.html")}],controller:"UeFormGroupController",controllerAs:"vm"};angular.module("universal.editor").component("ueFormGroup",e)}(),function(){"use strict";function e(e,t,n,i,a,l,r,o){var d,s=this;d=s.setting.parentField?s.setting.parentFieldIndex?s.setting.parentField+"_"+s.setting.parentFieldIndex+"_"+s.setting.name:s.setting.parentField+"_"+s.setting.name:s.setting.name;var u=o.getEntityObject();s.fieldDisplayName=s.setting.label,s.hint=s.setting.hint||!1,s.innerFields=[],s.fieldsArray=[],s.multiple=s.setting.hasOwnProperty("multiple")&&s.setting.multiple===!0,a.addFieldController(this),angular.forEach(s.setting.component.settings.fields,function(e){var t=u.dataSource.fields.filter(function(t){return t.name==e});t.length>0&&s.innerFields.push(t[0])}),this.getFieldValue=function(){var e={};return e[s.setting.name]=s.fieldsArray.length>0?[]:"",e},this.getInitialValue=function(){var e={};return e[s.setting.name]=[],e};var c=e.$on("editor:entity_loaded",function(e,t){s.multiple&&("new"===t.editorEntityType?(s.fieldsArray=[],r.setArrayField(s.setting.name,[])):(r.setArrayField(s.setting.name,JSON.parse(JSON.stringify(t[s.setting.name]))),s.fieldsArray=t[s.field.name]))}),m=e.$on("editor:api_error_field_"+d,function(e,t){angular.isArray(t)?angular.forEach(t,function(e){s.error.indexOf(e)<0&&s.error.push(e)}):s.error.indexOf(t)<0&&s.error.push(t)});s.removeItem=function(e){var t=s.fieldsArray;s.fieldsArray=[],l(function(){r.removeFieldIndex(s.setting.name,e),t.splice(e,1),s.fieldsArray=t},0)},this.$onDestroy=function(){c(),m()},this.$postLink=function(){n.on("$destroy",function(){e.$destroy()})}}angular.module("universal.editor").controller("UeFormGroupController",e),e.$inject=["$scope","$rootScope","$element","configData","EditEntityStorage","$timeout","ArrayFieldStorage","RestApiService"]}(),function(e){try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/components/ueFormGroup/ueFormGroup.html",'\n<div class="editor-field-array">\n    <div class="field-name-label label-array">\n        <div data-ng-if="vm.hint" class="field-hint">\n            <div class="hint-text">{{vm.hint}}</div>\n        </div>{{vm.fieldDisplayName}}\n    </div>\n    <div class="field-array-wrapper">\n        <data-field-wrapper data-ng-repeat="field in vm.innerFields" data-field-name="{{field}}" data-parent-field="{{vm.fieldName}}" data-setting="field"></data-field-wrapper>\n    </div>\n</div>')}])}(),function(){"use strict";angular.module("universal.editor").component("ueModal",{template:["$templateCache",function(e){return e.get("module/components/ueModal/ueModal.html")}],bindings:{resolve:"<",close:"&",dismiss:"&"},controllerAs:"vm",controller:function(e,t,n,i,a){var l=this;l.entityId=a.params.pk,l.assetsPath="/assets/universal-editor",n.ui&&n.ui.assetsPath&&(l.assetsPath=n.ui.assetsPath);var r=i.closest(".modal-dialog");l.size=l.resolve.settings.size,l.size&&(l.size.width&&r.width(l.size.width),l.size.height&&r.height(l.size.height)),l.header=l.resolve.settings.header,l.body=l.resolve.settings.body,l.body&&(l.body.component.settings.modal=!0),l.footer=[],l.resolve.settings.footer&&l.resolve.settings.footer.controls&&angular.forEach(l.resolve.settings.footer.controls,function(e){l.footer.push(e)}),l.$onInit=function(){l.resolve.settings.isModal=!0},l.ok=function(){l.close({$value:"ок modal"})},l.cancel=function(){l.close()},t.$on("exit_modal",function(){l.dismiss({$value:"cancel modal emit"})})}})}(),function(e){try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/components/ueModal/ueModal.html",'\n<div style="background: #ebf1f3;">\n    <div data-ng-click="vm.cancel()" style="display: block; position: absolute; top: 22px; right: 22px; width: 13px; height: 13px; cursor: pointer;" ng-style="{\'background-image\':\'url(\'+ vm.assetsPath +\'/images/close.jpg)\'}" class="close-editor"></div>\n    <div ng-show="vm.header" style="padding: 10px;" class="ue-modal-header">\n        <label ng-bind="vm.header.label"></label>\n    </div>\n    <div ng-show="vm.body" class="ue-modal-body">\n        <div ng-bind="vm.body.text" ng-show="vm.body.text" class="text"></div>\n        <div class="field-content-wrapper">\n            <component-wrapper data-setting="vm.body" data-ng-if="vm.body"></component-wrapper>\n        </div>\n    </div>\n    <div data-ng-show="vm.footer" class="ue-modal-footer">\n        <component-wrapper data-ng-repeat="button in vm.footer track by $index" data-setting="button" class="editor-action-button"></component-wrapper>\n    </div>\n</div>')}])}(),function(){"use strict";var e={bindings:{setting:"="},template:["$templateCache",function(e){return e.get("module/components/ueNumber/ueNumber.html")}],controller:"UeNumberController",controllerAs:"vm"};angular.module("universal.editor").component("ueNumber",e)}(),function(){"use strict";function e(e,t,n,i){function a(){r.fieldValue=r.setting.hasOwnProperty("multiple")&&r.setting.multiple===!0?[]:r.defaultValue||null}var l,r=this;l=r.setting.parentField?r.setting.parentFieldIndex?r.setting.parentField+"_"+r.setting.parentFieldIndex+"_"+r.setting.name:r.setting.parentField+"_"+r.setting.name:r.setting.name,r.classTextarea="",r.fieldValue=void 0,r.readonly=r.setting.readonly||!1,r.max=r.setting.max,r.min=r.setting.min,r.defaultValue=isNaN(parseFloat(r.setting.defaultValue))?null:r.setting.defaultValue,r.fieldDisplayName=r.setting.component.settings.label,r.hint=r.setting.hint||!1,r.required=r.setting.required||!1,r.error=[],r.inputLeave=function(e){if(e){if(r.setting.hasOwnProperty("max")&&e>r.setting.max){var t="Для поля превышено максимальное допустимое значение "+r.setting.max+". Сейчас введено "+e+".";r.error.indexOf(t)<0&&r.error.push(t)}if(r.setting.hasOwnProperty("min")&&e<r.setting.min){var n="Минимальное значение поля не может быть меньше "+r.setting.min+". Сейчас введено "+e+".";r.error.indexOf(n)<0&&r.error.push(n)}}},r.cols&&(r.cols>6&&(r.cols=6),r.cols<1&&(r.cols=1)),r.setting.hasOwnProperty("multiple")&&r.setting.multiple===!0?(r.multiple=!0,r.fieldValue=[],(r.setting.multiname||angular.isString(r.setting.multiname))&&(r.multiname=""+r.setting.multiname||"value")):(r.multiple=!1,r.fieldValue=r.defaultValue||null),r.setting.parentFieldIndex&&(r.multiple?(r.fieldValue=[],angular.forEach(i.getFieldValue(r.setting.parentField,r.setting.parentFieldIndex,r.setting.name),function(e){r.multiname?r.fieldValue.push(e[r.multiname]):r.fieldValue.push(e)})):r.fieldValue=i.getFieldValue(r.setting.parentField,r.setting.parentFieldIndex,r.setting.name)||null),n.addFieldController(this),this.getFieldValue=function(){var e,t={};return r.multiname?(e=[],angular.forEach(r.fieldValue,function(t){var n={};n[r.multiname]=t,e.push(n)})):r.multiple?(e=[],angular.forEach(r.fieldValue,function(t){e.push(t)})):e=r.fieldValue,r.setting.parentField?r.setting.parentFieldIndex?(t[r.setting.parentField]=[],t[r.setting.parentField][r.setting.parentFieldIndex]={},t[r.setting.parentField][r.setting.parentFieldIndex][r.setting.name]=e):(t[r.setting.parentField]={},t[r.setting.parentField][r.setting.name]=e):t[r.setting.name]=e,t},this.getInitialValue=function(){var e={};return r.setting.parentField?r.multiple?(e[r.setting.parentField]={},e[r.setting.parentField][r.setting.name]=[]):(e[r.setting.parentField]={},e[r.setting.parentField][r.setting.name]=null):r.multiple?e[r.setting.name]=[]:e[r.setting.name]=null,e},r.addItem=function(){r.fieldValue.push(r.defaultValue)},r.removeItem=function(e){angular.forEach(r.fieldValue,function(t,n){n==e&&r.fieldValue.splice(e,1)})};var o,d=e.$on("editor:entity_loaded",function(t,i){return r.setting.requiredField&&(o=e.$watch(function(){var e=n.getValueField(r.setting.requiredField),t=!1,i=!1;return function a(e){for(var n=Object.keys(e),l=n.length;l--;){var r=e[n[l]];null!==r&&void 0!==r&&null!==r&&(angular.isObject(r)&&!i&&a(r),t=!0,i=!0)}}(e),t},function(e){e?r.readonly=r.setting.readonly||!1:(a(),r.readonly=!0)},!0)),"new"===i.editorEntityType?(r.defaultValue?r.fieldValue=r.multiple?[r.defaultValue]:r.defaultValue:r.fieldValue=r.multiple?[]:null,void(i.hasOwnProperty(r.setting.name)&&(r.fieldValue=i[r.setting.name]))):void(r.setting.parentField?r.multiple?r.multiname?(r.fieldValue=[],angular.forEach(i[r.setting.parentField][r.setting.name],function(e){r.fieldValue.push(e[r.multiname])})):(r.fieldValue=[],angular.forEach(i[r.setting.parentField][r.setting.name],function(e){r.fieldValue.push(e)})):r.fieldValue=i[r.setting.parentField][r.setting.name]:r.multiple?r.multiname?(r.fieldValue=[],angular.forEach(i[r.setting.name],function(e){r.fieldValue.push(e[r.multiname])})):(r.fieldValue=[],angular.forEach(i[r.setting.name],function(e){r.fieldValue.push(e)})):r.fieldValue=i[r.setting.name])}),s=e.$on("editor:api_error_field_"+l,function(e,t){angular.isArray(t)?angular.forEach(t,function(e){r.error.indexOf(e)<0&&r.error.push(e)}):r.error.indexOf(t)<0&&r.error.push(t)}),u=e.$watch(function(){return r.fieldValue},function(){r.error=[]},!0);this.$onDestroy=function(){angular.isFunction(o)&&o(),d(),s(),u(),n.deleteFieldController(r),r.setting.parentFieldIndex&&i.fieldDestroy(r.setting.parentField,r.setting.parentFieldIndex,r.setting.name,r.fieldValue)},this.$postLink=function(){t.on("$destroy",function(){e.$destroy()})}}angular.module("universal.editor").controller("UeNumberController",e),e.$inject=["$scope","$element","EditEntityStorage","ArrayFieldStorage"]}(),function(e){try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/components/ueNumber/ueNumber.html",'\n<div class="field-wrapper row">\n    <div class="form-group">\n        <label class="field-name-label">\n            <div data-ng-if="vm.hint" class="field-hint">\n                <div class="hint-text">{{vm.hint}}</div>\n            </div><span data-ng-class="vm.required ? \'editor-required\' : \'\' ">{{vm.fieldDisplayName}}:</span>\n        </label>\n        <div class="field-element">\n            <div data-ng-if="vm.multiple" data-ng-class="vm.classTextarea">\n                <div data-ng-repeat="field_item in vm.fieldValue track by $index" class="item-string-wrapper input-group">\n                    <input type="number" data-ng-disabled="vm.readonly" name="{{vm.fieldName}}" data-ng-model="vm.fieldValue[$index]" data-ng-min="vm.min" data-ng-max="vm.max" data-ng-blur="vm.inputLeave(vm.fieldValue[$index])" class="form-control input-sm"/><span class="input-group-btn">\n                        <button data-ng-click="vm.removeItem($index)" data-ng-if="!vm.readonly" class="btn btn-default btn-sm">x</button></span>\n                </div>\n                <div data-ng-click="vm.addItem()" data-ng-if="!vm.readonly" class="btn btn-primary btn-sm">{{\'BUTTON.ADD\' | translate}}</div>\n            </div>\n            <div data-ng-if="!vm.multiple" data-ng-class="vm.classTextarea">\n                <input type="number" data-ng-disabled="vm.readonly" name="{{vm.fieldName}}" data-ng-model="vm.fieldValue" data-ng-min="vm.min" data-ng-max="vm.max" data-ng-blur="vm.inputLeave(vm.fieldValue)" class="form-control input-sm"/>\n            </div>\n        </div>\n    </div>\n    <div class="field-error-wrapper">\n        <div data-ng-repeat="err in vm.error track by $index" class="error-item alert alert-danger">{{err}}</div>\n    </div>\n</div>')}])}(),function(){"use strict";var e={bindings:{setting:"="},template:["$templateCache",function(e){return e.get("module/components/ueRadiolist/ueRadiolist.html")}],controller:"UeRadiolistController",controllerAs:"vm"};angular.module("universal.editor").component("ueRadiolist",e)}(),function(){"use strict";function e(e,t,n,i,a){function l(){o.fieldValue=o.setting.parentFieldIndex?[]:o.setting.defaultValue||null}var r,o=this;r=o.setting.parentField?o.setting.parentFieldIndex?o.setting.parentField+"_"+o.setting.parentFieldIndex+"_"+o.setting.name:o.setting.parentField+"_"+o.setting.name:o.setting.name;var d=o.setting.valuesRemote;if(o.field_id="id",o.field_search="title",d&&d.fields&&(d.fields.value&&(o.field_id=d.fields.value),d.fields.label&&(o.field_search=d.fields.label)),o.selectedValues=[],o.inputValue="",o.readonly=o.setting.readonly||!1,o.fieldDisplayName=o.setting.component.settings.label,o.hint=o.setting.hint||!1,o.required=o.setting.required||!1,o.error=[],(o.setting.multiname||angular.isString(o.setting.multiname))&&(o.multiname=""+o.setting.multiname||"value"),n.addFieldController(this),o.setting.parentFieldIndex){o.fieldValue=[];var s=a.getFieldValue(o.setting.parentField,o.setting.parentFieldIndex,o.setting.name);s&&(o.multiname?o.fieldValue=s[o.multiname]:o.fieldValue=s)}o.setting.hasOwnProperty("values")?angular.forEach(o.setting.component.settings.values,function(e,t){var n={};n[o.field_id]=t,n[o.field_search]=e,t===o.setting.defaultValue&&(o.fieldValue=t),o.selectedValues.push(n)}):o.setting.hasOwnProperty("valuesRemote")?i.getUrlResource(o.setting.component.settings.valuesRemote.url).then(function(e){angular.forEach(e.data.items,function(e){o.setting.defaultValue&&e[o.field_id]===o.setting.defaultValue&&(o.fieldValue=e[o.field_id]),o.selectedValues.push(e)})},function(e){console.error('EditorFieldRadiolistController: Не удалось получить значения для поля "'+o.setting.name+'" с удаленного ресурса')}):console.error("EditorFieldRadiolistController: Для поля не указан ни один тип получения значений ( локальный или удаленный )"),this.getFieldValue=function(){var e,t={};if(o.multiname){var n={};n[o.multiname]=o.fieldValue,e=n}else e=o.fieldValue;return o.setting.parentField?o.setting.parentFieldIndex?(t[o.setting.parentField]=[],t[o.setting.parentField][o.setting.parentFieldIndex]={},t[o.setting.parentField][o.setting.parentFieldIndex][o.setting.name]=e):(t[o.setting.parentField]={},t[o.setting.parentField][o.setting.name]=e):t[o.setting.name]=e,t},this.getInitialValue=function(){var e={};return o.setting.parentField?(e[o.setting.parentField]={},e[o.setting.parentField][o.setting.name]=null):e[o.setting.name]=null,e};var u,c=e.$on("editor:entity_loaded",function(t,i){return o.setting.requiredField&&(u=e.$watch(function(){var e=n.getValueField(o.setting.requiredField),t=!1,i=!1;return function a(e){for(var n=Object.keys(e),l=n.length;l--;){var r=e[n[l]];null!==r&&void 0!==r&&""!==r&&(angular.isObject(r)&&!i&&a(r),t=!0,i=!0)}}(e),t},function(e){e?o.readonly=o.setting.readonly||!1:(l(),o.readonly=!0)},!0)),"new"===i.editorEntityType?void(o.fieldValue=o.setting.defaultValue||null):void(o.setting.parentField?o.multiname?o.fieldValue=i[o.setting.parentField][o.setting.name][o.multiname]:o.fieldValue=i[o.setting.parentField][o.setting.name]:o.multiname?o.fieldValue=i[o.setting.name][o.multiname]:o.fieldValue=i[o.setting.name])}),m=e.$on("editor:api_error_field_"+r,function(e,t){angular.isArray(t)?angular.forEach(t,function(e){o.error.indexOf(e)<0&&o.error.push(e)}):o.error.indexOf(t)<0&&o.error.push(t)}),f=e.$watch(function(){return o.fieldValue},function(){o.error=[]},!0);this.$onDestroy=function(){angular.isFunction(u)&&u(),c(),m(),f(),n.deleteFieldController(o),o.setting.parentFieldIndex&&a.fieldDestroy(o.setting.parentField,o.setting.parentFieldIndex,o.setting.name,o.fieldValue)},this.$postLink=function(){t.on("$destroy",function(){e.$destroy()})}}angular.module("universal.editor").controller("UeRadiolistController",e),e.$inject=["$scope","$element","EditEntityStorage","RestApiService","ArrayFieldStorage"]}(),function(e){try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/components/ueRadiolist/ueRadiolist.html",'\n<div class="field-wrapper row">\n    <div class="form-group">\n        <label class="field-name-label">\n            <div data-ng-if="vm.hint" class="field-hint">\n                <div class="hint-text">{{vm.hint}}</div>\n            </div><span data-ng-class="vm.required ? \'editor-required\' : \'\' ">{{vm.fieldDisplayName}}:</span>\n        </label>\n        <div class="field-element">\n            <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">\n                <div data-ng-repeat="item in vm.selectedValues" data-ng-class="vm.readonly ? \'disabled\' : \'\'" class="radio">\n                    <label>\n                        <input type="radio" data-ng-disabled="vm.readonly" data-ng-model="vm.fieldValue" value="{{item[vm.field_id]}}"/>{{item[vm.field_search]}}\n                    </label>\n                </div>\n            </div>\n        </div>\n    </div>\n    <div class="field-error-wrapper">\n        <div data-ng-repeat="err in vm.error track by $index" class="error-item alert alert-danger">{{err}}</div>\n    </div>\n</div>')}])}(),function(){"use strict";function e(e,t){}angular.module("universal.editor").controller("DropdownItemsController",e),e.$inject=["$scope","RestApiService"]}(),function(){"use strict";function e(e,t,n){function i(e,t){angular.isFunction(t)&&(t={post:t});var i,a=e.contents().remove();return{post:function(e,l){i||(i=n(a)),i(e,function(e){l.append(e)}),t&&t.post&&t.post.apply(null,arguments)}}}return{restrict:"A",replace:!0,scope:{options:"=",isOpen:"=",fieldSearch:"=",childCountField:"=",onToggle:"=",api:"=",selectBranches:"=",assetsPath:"=",multiple:"=",activeElement:"=",setActiveElement:"=",lvlDropdown:"="},template:e.get("module/components/ueSelect/dropdownItems.html"),controller:"DropdownItemsController",controllerAs:"vm",compile:i}}angular.module("universal.editor").directive("dropdownItems",e),e.$inject=["$templateCache","$document","$compile"]}(),function(e){try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/components/ueSelect/dropdownItems.html",'\n<div data-ng-show="isOpen">\n    <div data-ng-class="{&quot;dropdown-scroll&quot; : (lvlDropdown == 1)}">\n        <div data-ng-repeat="option in options track by $index" data-ng-class="activeElement == $index ? \'active\' : \'\'" data-ng-mouseover="setActiveElement($event, $index)" class="dropdown-items__item">\n            <div class="option">\n                <div data-ng-if="::selectBranches || !option[childCountField]" data-ng-mousedown="onToggle($event, option)" data-ng-class="{&quot;multi_radio&quot; : !multiple}" class="option__checkbox">\n                    <div data-ng-style="{\'display\': option.checked ? \'block\' : \'\', \'background-image\':\'url(\'+ assetsPath + (!multiple ? \'/images/radio_green.png)\' : \'/images/checkbox_green.png)\')}" data-ng-class="{&quot;multi_radio&quot; : !multiple}" class="checkbox__check"></div>\n                </div>\n                <div data-ng-mousedown="onToggle($event, option, true)" class="option__label"><span data-ng-bind="option[fieldSearch]"></span> <span data-ng-if="option[childCountField]" data-ng-class="{\'option__child-count_open\': option.isOpen}" class="option__child-count">({{option[childCountField]}})</span>\n                </div>\n            </div>\n            <div data-ng-if="option[childCountField]" data-ng-show="!!option.loadingData" class="processing-status-wrapper">\n                <div class="processing-status">Выполняется действие</div>\n            </div>\n            <div data-ng-if="option.childOpts" data-dropdown-items="" data-options="option.childOpts" data-is-open="option.isOpen" data-field-search="fieldSearch" data-child-count-field="childCountField" data-on-toggle="onToggle" data-api="api" data-select-branches="selectBranches" data-assets-path="assetsPath" data-multiple="multiple" data-active-element="activeElement" data-set-active-element="setActiveElement" data-lvl-dropdown="lvlDropdown + 1" class="dropdown-items__children"></div>\n        </div>\n    </div>\n</div>')}])}(),function(){"use strict";var e={bindings:{field:"=",parentField:"=",parentFieldIndex:"="},template:["$templateCache",function(e){return e.get("module/components/ueSelect/ueSelect.html")}],controller:"UeSelectController",controllerAs:"vm"};angular.module("universal.editor").component("ueSelect",e)}(),function(){"use strict";function e(e,t,n,i,a,l,r,o,d,s){function u(e){w.loadingData=!0,i.getUrlResource(w.field.valuesRemote.url).then(function(t){angular.forEach(t.data.items,function(e){
w.options.push(e)}),E(),D=angular.copy(w.options),e?$():V()},function(e){console.error('EditorFieldSelectController: Не удалось получить значения для поля "'+w.field.fieldName+'" с удаленного ресурса')})["finally"](function(){w.loadingData=!1})}function c(){w.loadingData=!0,i.getUrlResource(w.field.valuesRemote.url+'?filter={"id":["'+S.join('","')+'"]}').then(function(e){w.multiple?angular.forEach(e.data.items,function(e){w.fieldValue.push(e)}):w.fieldValue=[e.data.items[0]],u(!0)},function(e){console.error('EditorFieldSelectController: Не удалось получить значения для поля "'+w.field.fieldName+'" с удаленного ресурса')})["finally"](function(){w.loadingData=!1})}function m(){w.fieldValue=w.field.hasOwnProperty("multiple")&&w.field.multiple===!0?[]:"",w.selectedValues=[],w.inputValue=""}function f(e,t,n){if(n&&t[w.treeChildCountField])t.isOpen=!t.isOpen,t[w.treeChildCountField]&&!t.childOpts&&(t.loadingData=!0,i.getUrlResource(w.field.valuesRemote.url+'?filter={"'+w.treeParentField+'":"'+t[w.field_id]+'"}').then(function(e){t.childOpts||(t.childOpts=[]),t.loadingData=!1,angular.forEach(e.data.items,function(e){t.childOpts.push(e)}),w.filterText||(D=angular.copy(w.options)),w.fieldValue.length&&$(t)},function(e){console.error('EditorFieldSelectController: Не удалось получить значения для поля "'+w.field.fieldName+'" с удаленного ресурса')}));else{angular.isArray(w.fieldValue)||(w.fieldValue=[]);var a=b(t[w.field_id]);w.multiple?null!==a?(t.checked=!1,w.fieldValue.splice(a,1)):(t.checked=!0,w.fieldValue.push(t)):null===a?(w.fieldValue.splice(0),p(w.options),t.checked=!0,w.isSpanSelectDelete=!0,w.fieldValue.push(t)):(w.fieldValue.splice(0),t.checked=!1,w.isSpanSelectDelete=!1),w.multiple||l(function(){w.isBlur(),d.find("input")[0].blur()},0)}0!==w.fieldValue.length||w.filterText?(w.placeholder=w.multiple?"":w.fieldValue[0][w.field_search],w.sizeInput=w.filterText?w.filterText.length:1):(w.placeholder=w.field.placeholder||"",w.sizeInput=w.placeholder.length),e&&(e.stopPropagation(),e.preventDefault())}function p(e){for(var t=0,n=e.length;t<n;t++)e[t].checked=!1,e[t].childOpts&&p(e[t].childOpts)}function g(e,n){if(w.treeParentField&&n[w.treeParentField]&&w.multiple){F(w.options,n[w.treeParentField],n[w.field_id]);var i=b(n[w.field_id],n[w.treeParentField]);null!==i&&w.fieldValue.splice(i,1)}else{var i=b(n[w.field_id]);if(null!==i){w.fieldValue.splice(i,1);for(var a=0,l=w.options.length;a<l;a++)w.options[a][w.field_id]===n[w.field_id]&&(w.options[a].checked=!1)}}0!==w.fieldValue.length||w.filterText?(w.placeholder="",w.sizeInput=w.filterText?w.filterText.length:1):(w.placeholder=t.field.placeholder||"",w.sizeInput=w.placeholder.length)}function v(e){t.toggleDropdown(e),t.isOpen=!0}function h(){if(w.activeElement=0,0!==w.fieldValue.length||w.filterText?(w.placeholder="",w.sizeInput=w.filterText?w.filterText.length:1):(w.placeholder=w.field.placeholder||"",w.sizeInput=w.placeholder.length),w.filterText){w.sizeInput=w.filterText?w.filterText.length:1,D||(D=angular.copy(w.options)),w.options=y(angular.copy(D),w.filterText);for(var e=0;e<w.fieldValue.length;e++)for(var t=0,n=w.options.length;t<n;t++)w.options[t][w.field_id]===w.fieldValue[e][w.field_id]&&(w.options[t].checked=!0)}else{if(w.multiple||w.isTree)!w.multiple&&w.isTree&&(w.placeholder=w.fieldValue.length&&w.fieldValue[0][w.field_search]?w.fieldValue[0][w.field_search]:w.field.placeholder);else{if(w.options&&w.options.length&&w.fieldValue){var i=w.options.filter(function(e){return e[w.field_id]===w.fieldValue[w.field_id]});i&&(w.fieldValue=i[0])}w.placeholder=w.fieldValue&&w.fieldValue[w.field_search]?w.fieldValue[w.field_search]:w.field.placeholder}w.sizeInput=w.placeholder.length,D&&(w.options=D);for(var e=0;e<w.fieldValue.length;e++)for(var t=0,n=w.options.length;t<n;t++)w.options[t][w.field_id]===w.fieldValue[e][w.field_id]&&(w.options[t].checked=!0)}}function y(e,t){var n=[];return n=e.filter(function(e){return e.childOpts&&e.childOpts.length&&(e.childOpts=y(e.childOpts,t)),e[w.field_search].toLowerCase().indexOf(t.toLowerCase())>-1||e.childOpts&&e.childOpts.length})}function b(e,t){if(t){for(var n=0,i=w.fieldValue.length;n<i;n++)if(w.fieldValue[n][w.field_id]===e&&w.fieldValue[n][w.treeParentField]===t)return n}else for(var n=0,i=w.fieldValue.length;n<i;n++)if(w.fieldValue[n][w.field_id]===e)return n;return null}function F(e,t,n){for(var i=0,a=e.length;i<a;i++)if(e[i][w.field_id]===t&&e[i].childOpts)for(var l=0,r=e[i].childOpts.length;l<r;l++)e[i].childOpts[l][w.field_id]===n&&(e[i].childOpts[l].checked=!1);else e[i].childOpts&&e[i].childOpts.length&&F(e[i].childOpts,t,n)}function V(){S.length&&w.options.length&&(w.fieldValue=w.options.filter(function(e){for(var t=0,n=S.length;t<n;t++)if(e[w.field_id]===S[t])return e.checked=!0,!0}),S.splice(0))}function $(e){if(e)for(var t=0,n=e.childOpts.length;t<n;t++)for(var i=0,a=w.fieldValue.length;i<a;i++)e[w.field_id]===w.fieldValue[i][w.treeParentField]&&e.childOpts[t][w.field_id]===w.fieldValue[i][w.field_id]&&(e.childOpts[t].checked=!0);else for(var t=0,n=w.options.length;t<n;t++)for(var i=0,a=w.fieldValue.length;i<a;i++)w.options[t][w.field_id]!==w.fieldValue[i][w.field_id]||w.fieldValue[i][w.treeParentField]||(w.options[t].checked=!0)}function E(){var e=w.options.length,t=d.find("select");t.length&&(e<=3?t[0].size=3:e>=7?t[0].size=7:t[0].size=e)}var x,w=this;x=w.parentField?w.parentFieldIndex?w.parentField+"_"+w.parentFieldIndex+"_"+w.fieldName:w.parentField+"_"+w.fieldName:w.field.name;var _=w.field.valuesRemote;w.field_id="id",w.field_search="title",_&&_.fields&&(_.fields.value&&(w.field_id=_.fields.value),_.fields.label&&(w.field_search=_.fields.label));var C=angular.element(d[0].getElementsByClassName("possible-scroll")[0]);w.assetsPath="/assets/universal-editor",r.ui&&r.ui.assetsPath&&(w.assetsPath=r.ui.assetsPath);var S=[];w.fieldName=w.field.name,w.options=[],w.selectedValues=[],w.inputValue="",w.readonly=w.field.readonly||!1,w.parentFieldIndex=w.parentFieldIndex||!1,w.depend=w.field.depend||!1,w.parentValue=!w.depend,w.search=w.field.search,w.placeholder=w.field.placeholder||"",w.showPossible=!1,w.activeElement=0,w.isSelection=!1,w.possibleLocation=!0,w.isSpanSelectDelete=!1,w.fieldDisplayName=w.setting.component.settings.label,w.hint=w.setting.hint||!1,w.required=w.setting.required||!1,w.error=[],w.field.hasOwnProperty("valuesRemote")&&w.field.valuesRemote.fields.parent&&w.field.valuesRemote.fields.childCount&&(w.treeParentField=w.field.valuesRemote.fields.parent,w.treeChildCountField=w.field.valuesRemote.fields.childCount,w.treeSelectBranches=w.field.selectBranches,w.isTree=w.treeParentField&&w.treeChildCountField,w.sizeInput=w.placeholder.length),w.depend&&(w.dependField=w.depend.fieldName,w.dependFilter=w.depend.filter),w.field.hasOwnProperty("multiple")&&w.field.multiple===!0?(w.multiple=!0,w.fieldValue=[],(w.field.multiname||angular.isString(w.field.multiname))&&(w.multiname=""+w.field.multiname||"value")):(w.multiple=!1,w.fieldValue="",w.styleInput={width:"99%"}),w.parentFieldIndex&&(w.multiple?(w.fieldValue=[],angular.forEach(a.getFieldValue(w.parentField,w.parentFieldIndex,w.field.name),function(e){w.multiname?S.push(e[w.multiname]):S.push(e)})):a.getFieldValue(w.parentField,w.parentFieldIndex,w.field.name)&&(w.isTree?S.push(a.getFieldValue(w.parentField,w.parentFieldIndex,w.field.name)):(w.fieldValue={},w.fieldValue[w.field_id]=a.getFieldValue(w.parentField,w.parentFieldIndex,w.field.name)))),n.addFieldController(this);var D;w.field.hasOwnProperty("values")?(angular.forEach(w.field.values,function(e,t){var n={};n[w.field_id]=t,n[w.field_search]=e,w.options.push(n)}),t.$evalAsync(function(){E()}),D=angular.copy(w.options)):w.field.hasOwnProperty("valuesRemote")?w.isTree?S.length&&!w.options.length?c():S.length||u():u():console.error("EditorFieldSelectController: Для поля не указан ни один тип получения значений ( локальный или удаленный )"),this.getFieldValue=function(){var e,t={};return(!w.multiple&&w.fieldValue||w.multiple&&w.fieldValue.length)&&(w.multiname?(e=[],angular.forEach(w.fieldValue,function(t){var n={};n[w.multiname]=w.isTree?t[w.field_id]:t,e.push(n)})):w.multiple?(e=[],angular.forEach(w.fieldValue,function(t){e.push(w.isTree?t[w.field_id]:t)})):e=w.isTree&&w.fieldValue.length?w.fieldValue[0][w.field_id]:w.fieldValue[w.field_id]),w.parentField?w.parentFieldIndex?(t[w.parentField]=[],t[w.parentField][w.parentFieldIndex]={},t[w.parentField][w.parentFieldIndex][w.fieldName]=e):(t[w.parentField]={},t[w.parentField][w.fieldName]=e):t[w.fieldName]=e,t},this.getInitialValue=function(){var e={};return w.parentField?w.multiple?(e[w.parentField]={},e[w.parentField][w.fieldName]=[]):(e[w.parentField]={},e[w.parentField][w.fieldName]=void 0):w.multiple?e[w.fieldName]=[]:e[w.fieldName]=void 0,e};var I,N,k=t.$on("editor:entity_loaded",function(e,i){if(w.fieldValue={},w.field.requiredField&&(I=t.$watch(function(){var e=n.getValueField(w.field.requiredField),t=!1,i=!1;return function a(e){for(var n=Object.keys(e),l=n.length;l--;){var r=e[n[l]];null!==r&&void 0!==r&&""!==r&&(angular.isObject(r)&&!i&&a(r),t=!0,i=!0)}}(e),t},function(e){e?w.readonly=w.field.readonly||!1:(m(),w.readonly=!0)},!0)),"new"!==i.editorEntityType)if(w.parentValue=!w.dependField,w.parentField)if(w.multiple)w.multiname?(w.fieldValue=[],angular.forEach(i[w.parentField][w.field.name],function(e){S.push(e[w.multiname])})):(w.fieldValue=[],angular.forEach(i[w.parentField][w.field.name],function(e){S.push(e)}));else if(w.isTree&&i[w.parentField][w.field.name])S.push(i[w.parentField][w.field.name]);else{var a={};a[w.field_id]=i[w.parentField][w.field.name],w.fieldValue=a}else if(w.multiple)w.multiname?(w.fieldValue=[],angular.forEach(i[w.field.name],function(e){S.push(e[w.multiname])})):(w.fieldValue=[],angular.forEach(i[w.field.name],function(e){S.push(e)}));else if(w.isTree&&i[w.field.name])S.push(i[w.field.name]);else{var a={};a[w.field_id]=i[w.field.name],w.fieldValue=a}else{if(w.fieldValue=w.multiple?[]:{},i.hasOwnProperty(w.field.name)){var a={};a[w.field_id]=i[w.field.name],isNaN(+a[w.field_id])||(a[w.field_id]=+a[w.field_id]),w.fieldValue=a}if(w.isTree&&(w.fieldValue=[]),w.field.defaultValue&&!w.isTree){var a={};a[w.field_id]=w.field.defaultValue,w.fieldValue=a}}}),T=t.$on("editor:api_error_field_"+x,function(e,t){angular.isArray(t)?angular.forEach(t,function(e){w.error.indexOf(e)<0&&w.error.push(e)}):w.error.indexOf(t)<0&&w.error.push(t)}),P=t.$watch(function(){return w.fieldValue},function(t){w.multiple||w.isTree||(w.search&&(w.filterText="",h()),w.placeholder=t&&t[w.field_search]?t[w.field_search]:w.field.placeholder,w.isSelection=!!t&&!!t[w.field_search]),w.isTree&&!w.search&&(w.placeholder=w.field.placeholder||""),w.isTree&&!w.multiple&&(w.placeholder=t.length&&t[0][w.field_search]?t[0][w.field_search]:w.field.placeholder),w.setColorPlaceholder(),w.error=[],e.$broadcast("select_field:select_name_"+w.fieldName,t)},!0);w.depend&&(N=t.$on("select_field:select_name_"+w.dependField,function(e,t){t&&""!==t?(w.parentValue=!1,w.options=[],i.getUrlResource(w.field.valuesRemote.url+'?filter={"'+w.dependFilter+'":"'+t+'"}').then(function(e){angular.forEach(e.data.items,function(e){w.options.push(e)}),l(function(){E()},0),D=angular.copy(w.options),w.parentValue=!0},function(e){console.error('EditorFieldSelectController: Не удалось получить значения для поля "'+w.field.fieldName+'" с удаленного ресурса')})):w.parentValue=!1})),w.toggle=f,w.remove=g,w.focus=v,w.change=h,w.addToSelected=function(e){var t={};t[w.field_id]=e[w.field_id],t[w.field_search]=e[w.field_search],w.fieldValue=t,w.filterText="",l(function(){w.isSpanSelectDelete=!0,w.showPossible=!1,w.setColorPlaceholder()},0)},w.isShowPossible=function(){w.activeElement=0,w.showPossible=!w.showPossible;var e=d.find(".select-input");w.showPossible&&e.addClass("active");var n=s.innerHeight,i=d.find(".select-input-wrapper"),a=i.height(),l=i.offset(),r=l.top+a;t.$evalAsync(function(){w.possibleLocation=!(n-r<162)}),w.setColorPlaceholder()},o.bind("keydown",function(e){if(w.showPossible||t.isOpen)switch(e.which){case 27:e.preventDefault(),l(function(){w.showPossible=!1,t.isOpen=!1},0);break;case 13:if(e.preventDefault(),(!w.multiple&&!w.isTree||w.isTree)&&w.options.length<1)break;l(function(){w.multiple||w.isTree?w.isTree&&w.toggle(void 0,w.options[w.activeElement],!0):w.addToSelected(w.options[w.activeElement])},0);break;case 40:if(e.preventDefault(),!w.multiple&&!w.isTree||w.isTree){if(w.options.length<1)break;w.multiple||w.isTree?w.isTree&&(C=angular.element(d[0].getElementsByClassName("dropdown__items")[0])):C=angular.element(d[0].getElementsByClassName("possible-scroll")[0]),w.activeElement<w.options.length-1&&(l(function(){w.activeElement++},0),l(function(){var e=angular.element(C[0].getElementsByClassName("active")[0])[0].offsetTop,t=angular.element(C[0].getElementsByClassName("active")[0])[0].clientHeight,n=C[0].scrollTop,i=C[0].clientHeight;e>=i+n-t&&(C[0].scrollTop+=t+1)},1))}break;case 38:if(e.preventDefault(),!w.multiple&&!w.isTree||w.isTree){if(w.options.length<1)break;w.multiple||w.isTree?w.isTree&&(C=angular.element(d[0].getElementsByClassName("dropdown__items")[0])):C=angular.element(d[0].getElementsByClassName("possible-scroll")[0]),w.activeElement>0&&(l(function(){w.activeElement--},0),l(function(){var e=angular.element(C[0].getElementsByClassName("active")[0])[0].offsetTop,t=angular.element(C[0].getElementsByClassName("active")[0])[0].clientHeight,n=C[0].scrollTop;C[0].clientHeight;e<n&&(C[0].scrollTop-=t+1)},1))}}}),w.setActiveElement=function(e,t){e.stopPropagation(),l(function(){w.activeElement=t},0)},w.setColorPlaceholder=function(){w.search||w.isTree?w.colorPlaceholder=!(w.placeholder===w.field.placeholder||t.isOpen):w.colorPlaceholder=!(w.placeholder===w.field.placeholder||w.showPossible)},w.isBlur=function(){w.showPossible=!1,t.isOpen=!1;var e=d.find(".select-input");e.removeClass("active"),w.setColorPlaceholder()},w.clickSelect=function(){d.find("input")[0].focus()},w.deleteToSelected=function(e,t){t&&8==e.which&&w.fieldValue&&w.fieldValue.length&&!w.filterText&&w.multiple?g(null,w.fieldValue[w.fieldValue.length-1]):w.isTree||t?w.isTree&&!t&&(w.isSpanSelectDelete=!1,g(null,w.fieldValue[0]),e.stopPropagation()):(w.isSpanSelectDelete=!1,w.fieldValue={},e.stopPropagation())},w.getDistanceByClass=function(e){var t=angular.element(d.find(e)[0]);return s.innerHeight-t.offset().top},this.$onDestroy=function(){angular.isFunction(I)&&I(),k(),P(),T(),angular.isFunction(N)&&N(),n.deleteFieldController(w),w.parentFieldIndex&&a.fieldDestroy(w.parentField,w.parentFieldIndex,w.field.name,w.fieldValue)},this.$postLink=function(){d.on("$destroy",function(){t.$destroy()}),t.isOpen=!1,o.on("click",function(e){d[0].contains(e.target)||t.$apply(function(){t.vm.isBlur()})}),t.toggleDropdown=function(){d.find("input")[0].focus();var e=o.height(),n=d.find(".dropdown__host"),i=n.height(),a=n.offset(),l=a.top+i;if(d.find(".dropdown__items").removeClass("dropdown-top"),d.find(".dropdown__items").removeClass("dropdown-bottom"),e-l<300?d.find(".dropdown__items").addClass("dropdown-top"):d.find(".dropdown__items").addClass("dropdown-bottom"),t.isOpen=!t.isOpen,t.isOpen){var r=d.find(".select-input");r.addClass("active")}w.setColorPlaceholder()}}}angular.module("universal.editor").controller("UeSelectController",e),e.$inject=["$rootScope","$scope","EditEntityStorage","RestApiService","ArrayFieldStorage","$timeout","configData","$document","$element","$window"],angular.module("universal.editor").filter("selectedValues",function(){return function(e,t){var n=e.map(function(e){return e[t]});return n.join(", ")}})}(),function(e){try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/components/ueSelect/ueSelect.html",'\n<div class="field-wrapper row">\n    <div class="form-group">\n        <label class="field-name-label">\n            <div data-ng-if="vm.hint" class="field-hint">\n                <div class="hint-text">{{vm.hint}}</div>\n            </div><span data-ng-class="vm.required ? \'editor-required\' : \'\' ">{{vm.fieldDisplayName}}:</span>\n        </label>\n        <div class="field-element">\n            <div data-ng-if="vm.multiple &amp;&amp; !vm.isTree" class="col-lg-2 col-md-2 col-sm-3 col-xs-3">\n                <div class="select-border">\n                    <select name="{{vm.fieldName}}" data-ng-disabled="vm.readonly || !vm.parentValue" data-ng-model="vm.fieldValue" multiple="multiple" size="3" class="form-control">\n                        <option data-ng-repeat="option in vm.options" value="{{option[vm.field_id]}}">{{option[vm.field_search]}}</option>\n                    </select>\n                </div>\n                <div data-ng-show="!!vm.loadingData" class="processing-status-wrapper">\n                    <div class="processing-status">{{\'PERFORMS_ACTIONS\' | translate}}</div>\n                </div>\n            </div>\n            <div data-ng-if="!vm.multiple &amp;&amp; !vm.isTree" class="col-lg-2 col-md-2 col-sm-3 col-xs-3">\n                <div data-ng-click="vm.clickSelect()" data-ng-class="!vm.search ? &quot;but-for-search&quot; : &quot;&quot;" class="select-input-wrapper">\n                    <input data-ng-if="vm.search" placeholder="{{vm.placeholder}}" data-ng-class="vm.isSelection ? &quot;color-placeholder&quot; : &quot;&quot;" data-ng-model="vm.filterText" data-ng-change="vm.change()" data-ng-focus="vm.isShowPossible()" data-ng-blur="vm.isBlur()" class="form-control select-input"/>\n                    <input data-ng-if="!vm.search" data-ng-focus="vm.isShowPossible()" data-ng-blur="vm.isBlur()" class="focus-input"/>\n                    <div data-ng-if="!vm.search" class="form-control select-input">\n                        <div data-ng-class="vm.colorPlaceholder ? &quot;color-placeholder-div&quot; : &quot;&quot;" class="dropdown__selected-items">{{vm.placeholder}}</div>\n                    </div><span data-ng-if="vm.isSpanSelectDelete" data-ng-click="vm.deleteToSelected($event, false)" class="selecte-delete">×</span>\n                    <div data-ng-if="!vm.readonly &amp;&amp; (vm.options.length &gt; 0) &amp;&amp; vm.showPossible" data-ng-class="vm.possibleLocation ? &quot;possible-bottom&quot; : &quot;possible-top&quot;" class="possible-values active">\n                        <div class="possible-scroll">\n                            <div data-ng-repeat="option in vm.options" data-ng-mouseover="vm.activeElement = $index" data-ng-mousedown="vm.addToSelected(option)" data-ng-class="vm.activeElement == $index ? \'active\' : \'\'" class="possible-value-item">{{option[vm.field_search]}}</div>\n                        </div>\n                    </div>\n                </div>\n                <div data-ng-show="!!vm.loadingData" class="processing-status-wrapper">\n                    <div class="processing-status">{{\'PERFORMS_ACTIONS\' | translate}}</div>\n                </div>\n            </div>\n            <div data-ng-if="vm.isTree" class="dropdown col-lg-3 col-md-3 col-sm-3 col-xs-3">\n                <div class="dropdown__host">\n                    <div data-ng-class="{\'dropdown__title_open\': isOpen}" data-ng-click="vm.clickSelect()" data-ng-style="{&quot;cursor&quot; : vm.search ? &quot;text&quot; : &quot;pointer&quot;}" class="dropdown__title form-control select-input">\n                        <div data-ng-repeat="value in vm.fieldValue" data-ng-if="vm.fieldValue.length &amp;&amp; (vm.multiple || vm.treeParentField &amp;&amp; vm.treeChildCountField) &amp;&amp; vm.multiple" class="selected-items__item">\n                            <div class="selected-item">{{value[vm.field_search]}}<span data-ng-click="vm.remove($event, value)" class="selected-item__btn_delete">×</span></div>\n                        </div>\n                        <input data-ng-if="vm.search" data-ng-model="vm.filterText" data-ng-change="vm.change()" placeholder="{{vm.placeholder}}" data-ng-style="vm.styleInput" size="{{vm.sizeInput}}" data-ng-focus="toggleDropdown()" data-ng-blur="vm.isBlur()" data-ng-keydown="vm.deleteToSelected($event, true)" data-ng-class="vm.colorPlaceholder ? &quot;color-placeholder&quot; : &quot;&quot;" class="dropdown__search-field"/>\n                        <input data-ng-if="!vm.search" data-ng-focus="toggleDropdown()" data-ng-blur="vm.isBlur()" class="focus-input"/>\n                        <div data-ng-if="!vm.search" class="dropdown__selected">\n                            <div data-ng-class="vm.colorPlaceholder ? &quot;color-placeholder-div&quot; : &quot;&quot;" data-ng-if="!vm.loadingData" class="dropdown__selected-items dropdown-tree">{{vm.placeholder}}</div>\n                        </div><span data-ng-if="vm.isSpanSelectDelete" data-ng-click="vm.deleteToSelected($event, false)" class="selecte-delete">×</span>\n                        <div data-ng-if="::(vm.treeParentField &amp;&amp; vm.treeChildCountField)" data-ng-class="{\'dropdown__items_with-selected\': vm.fieldValue.length &gt; 2 || (vm.search &amp;&amp; vm.fieldValue.length)}" data-dropdown-items="" data-options="vm.options" data-is-open="isOpen &amp;&amp; vm.options.length" data-field-search="vm.field_search" data-child-count-field="vm.treeChildCountField" data-on-toggle="vm.toggle" data-api="vm.field.values_remote.url" data-select-branches="vm.treeSelectBranches" data-assets-path="vm.assetsPath" data-multiple="vm.multiple" data-active-element="vm.activeElement" data-set-active-element="vm.setActiveElement" data-lvl-dropdown="1" class="dropdown__items dropdown__items_with-padding active dropdown-bottom"></div>\n                    </div>\n                </div>\n                <div data-ng-show="!!vm.loadingData" class="processing-status-wrapper">\n                    <div class="processing-status">{{\'PERFORMS_ACTIONS\' | translate}}</div>\n                </div>\n            </div>\n        </div>\n    </div>\n    <div class="field-error-wrapper">\n        <div data-ng-repeat="err in vm.error track by $index" class="error-item alert alert-danger">{{err}}</div>\n    </div>\n</div>')}])}(),function(){"use strict";var e={bindings:{setting:"="},template:["$templateCache",function(e){return e.get("module/components/ueString/ueString.html")}],controller:"UeStringController",controllerAs:"vm"};angular.module("universal.editor").component("ueString",e)}(),function(){"use strict";function e(e,t,n,i){function a(){r.fieldValue=r.setting.hasOwnProperty("multiple")&&r.setting.multiple===!0?[]:r.setting.defaultValue||""}var l,r=this;l=r.setting.parentField?r.setting.parentFieldIndex?r.setting.parentField+"_"+r.setting.parentFieldIndex+"_"+r.setting.name:r.setting.parentField+"_"+r.setting.name:r.setting.name,r.cols=r.setting.width,r.classTextarea="",r.fieldName=r.setting.name,r.fieldValue=void 0,r.readonly=r.setting.readonly||!1,r.setting.parentFieldIndex=r.setting.parentFieldIndex||!1,r.mask=r.setting.mask||!1,r.fieldDisplayName=r.setting.component.settings.label,r.hint=r.setting.hint||!1,r.required=r.setting.required||!1,r.error=[],r.cols&&(r.cols>6&&(r.cols=6),r.cols<1&&(r.cols=1)),r.setting.hasOwnProperty("multiple")&&r.setting.multiple===!0?(r.multiple=!0,r.fieldValue=[],(r.setting.multiname||angular.isString(r.setting.multiname))&&(r.multiname=""+r.setting.multiname||"value")):(r.multiple=!1,r.fieldValue=r.setting.defaultValue||""),r.setting.parentFieldIndex&&(r.multiple?(r.fieldValue=[],angular.forEach(i.getFieldValue(r.setting.parentField,r.setting.parentFieldIndex,r.setting.name),function(e){r.multiname?r.fieldValue.push(e[r.multiname]):r.fieldValue.push(e)})):r.fieldValue=i.getFieldValue(r.setting.parentField,r.setting.parentFieldIndex,r.setting.name)||""),this.getFieldValue=function(){var e,t={};return r.multiname?(e=[],angular.forEach(r.fieldValue,function(t){var n={};n[r.multiname]=t,e.push(n)})):r.multiple?(e=[],angular.forEach(r.fieldValue,function(t){e.push(t)})):e=r.fieldValue,r.setting.parentField?r.setting.parentFieldIndex?(t[r.setting.parentField]=[],t[r.setting.parentField][r.setting.parentFieldIndex]={},t[r.setting.parentField][r.setting.parentFieldIndex][r.fieldName]=e):(t[r.setting.parentField]={},t[r.setting.parentField][r.fieldName]=e):t[r.fieldName]=e,t},this.getInitialValue=function(){var e={};return r.setting.parentField?r.multiple?(e[r.setting.parentField]={},e[r.setting.parentField][r.fieldName]=[""]):(e[r.setting.parentField]={},e[r.setting.parentField][r.fieldName]=""):r.multiple?e[r.fieldName]=[""]:e[r.fieldName]="",e},r.addItem=function(){r.fieldValue.push("")},r.removeItem=function(e){angular.forEach(r.fieldValue,function(t,n){n==e&&r.fieldValue.splice(e,1)})},r.inputLeave=function(e){if(e){if(r.setting.hasOwnProperty("maxLength")&&e.length>r.setting.maxLength){var t="Для поля превышено максимальное допустимое значение в "+r.setting.maxLength+" символов. Сейчас введено "+e.length+" символов.";r.error.indexOf(t)<0&&r.error.push(t)}if(r.setting.hasOwnProperty("minLength")&&e.length<r.setting.minLength){var n="Минимальное значение поля не может быть меньше "+r.setting.minLength+" символов. Сейчас введено "+e.length+" символов.";r.error.indexOf(n)<0&&r.error.push(n)}}};var o,d=e.$on("editor:entity_loaded",function(t,i){return r.setting.requiredField&&(o=e.$watch(function(){var e=n.getValueField(r.setting.requiredField),t=!1,i=!1;return function a(e){for(var n=Object.keys(e),l=n.length;l--;){var r=e[n[l]];null!==r&&void 0!==r&&""!==r&&(angular.isObject(r)&&!i&&a(r),t=!0,i=!0)}}(e),t},function(e){e?r.readonly=r.setting.readonly||!1:(a(),r.readonly=!0)},!0)),"new"===i.editorEntityType?(r.setting.defaultValue?r.fieldValue=r.multiple?[r.setting.defaultValue]:r.setting.defaultValue:r.fieldValue=r.multiple?[]:"",void(i.hasOwnProperty(r.setting.name)&&(r.fieldValue=i[r.setting.name]))):void(r.setting.parentField?r.multiple?r.multiname?(r.fieldValue=[],angular.forEach(i[r.setting.parentField][r.setting.name],function(e){r.fieldValue.push(e[r.multiname])})):(r.fieldValue=[],angular.forEach(i[r.setting.parentField][r.setting.name],function(e){r.fieldValue.push(e)})):r.fieldValue=i[r.setting.parentField][r.setting.name]:r.multiple?r.multiname?(r.fieldValue=[],angular.forEach(i[r.setting.name],function(e){r.fieldValue.push(e[r.multiname])})):(r.fieldValue=[],angular.forEach(i[r.setting.name],function(e){r.fieldValue.push(e)})):r.fieldValue=i[r.setting.name])}),s=e.$on("editor:api_error_field_"+l,function(e,t){angular.isArray(t)?angular.forEach(t,function(e){r.error.indexOf(e)<0&&r.error.push(e)}):r.error.indexOf(t)<0&&r.error.push(t)}),u=e.$watch(function(){return r.fieldValue},function(){r.error=[]},!0);this.$onDestroy=function(){angular.isFunction(o)&&o(),d(),s(),u(),n.deleteFieldController(r),r.setting.parentFieldIndex&&i.fieldDestroy(r.setting.parentField,r.setting.parentFieldIndex,r.setting.name,r.fieldValue)},this.$postLink=function(){t.on("$destroy",function(){e.$destroy()})},n.addFieldController(this)}angular.module("universal.editor").controller("UeStringController",e),e.$inject=["$scope","$element","EditEntityStorage","ArrayFieldStorage"]}(),function(e){try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/components/ueString/ueString.html",'\n<div class="field-wrapper row">\n    <div class="form-group">\n        <label class="field-name-label">\n            <div data-ng-if="vm.hint" class="field-hint">\n                <div class="hint-text">{{vm.hint}}</div>\n            </div><span data-ng-class="vm.required ? \'editor-required\' : \'\' ">{{vm.fieldDisplayName}}:</span>\n        </label>\n        <div class="field-element">\n            <div data-ng-if="vm.multiple" data-ng-class="vm.classTextarea">\n                <div data-ng-repeat="field_item in vm.fieldValue track by $index" class="item-string-wrapper input-group">\n                    <input type="text" data-ui-mask="{{vm.mask}}" data-ng-disabled="vm.readonly" name="{{vm.fieldName}}" data-ng-model="vm.fieldValue[$index]" data-ng-blur="vm.inputLeave(vm.fieldValue[$index])" class="form-control input-sm"/><span class="input-group-btn">\n                        <button data-ng-click="vm.removeItem($index)" data-ng-if="!vm.readonly" class="btn btn-default btn-sm">x</button></span>\n                </div>\n                <div data-ng-click="vm.addItem()" data-ng-if="!vm.readonly" class="btn btn-primary btn-sm">{{\'BUTTON.ADD\' | translate}}</div>\n            </div>\n            <div data-ng-if="!vm.multiple" data-ng-class="vm.classTextarea">\n                <input type="text" data-ui-mask="{{vm.mask}}" data-ng-disabled="vm.readonly" name="{{vm.fieldName}}" data-ng-model="vm.fieldValue" data-ng-blur="vm.inputLeave(vm.fieldValue)" size="{{vm.size}}" class="form-control input-sm"/>\n            </div>\n        </div>\n    </div>\n    <div class="field-error-wrapper">\n        <div data-ng-repeat="err in vm.error track by $index" class="error-item alert alert-danger">{{err}}</div>\n    </div>\n</div>')}])}(),function(){"use strict";var e={bindings:{setting:"="},template:["$templateCache",function(e){return e.get("module/components/ueTable/ueTable.html")}],controller:"UeTableController",controllerAs:"vm"};angular.module("universal.editor").component("ueTable",e)}(),function(){"use strict";function e(e,t,n,i,a,l,r,o,d,s,u,c,m,f,p){e.entity=i.getEntityType();var g,v,h=this,y=3;h.configData=n,h.correctEntityType=!0,h.entityLoaded=!1,h.listLoaded=!1,h.loadingData=!0,h.tableFields=[],h.items=[],h.links=[],h.errors=[],h.notifys=[],h.tabsVisibility=[],h.entityId="",h.editorEntityType="new",h.sortField="",h.sortingDirection=!0,h.pageItemsArray=[],h.contextLinks=h.setting.component.settings.contextMenu,h.listHeaderBar=h.setting.component.settings.header,h.editFooterBarNew=[],h.editFooterBarExist=[],h.contextId=void 0,h.idField="id",h.parentButton=!1,h.filterFields=[],h.visibleFilter=!0,h.pagination=!h.setting.component.settings.dataSource.hasOwnProperty("pagination")||h.setting.component.settings.dataSource.pagination,h.autoCompleteFields=[],h.entityType=e.entity,h.setting.component.settings.dataSource.hasOwnProperty("primaryKey")&&(h.idField=h.setting.component.settings.dataSource.primaryKey||h.idField),h.metaKey=!1,g="_meta",v="items",angular.forEach(h.setting.component.settings.dataSource.fields,function(e){e.component.hasOwnProperty("settings")&&h.setting.component.settings.columns.indexOf(e.name)!=-1&&h.tableFields.push({field:e.name,displayName:e.component.settings.label||e.name})}),h.sortField=h.setting.component.settings.dataSource.sortBy||h.tableFields[0].field,h.getScope=function(){return e},h.setTabVisible=function(e,t){h.tabsVisibility[e]=t},h.closeEditor=function(){e.$apply(function(){h.entityLoaded=!1})},h.applyFilter=function(){i.setFilterParams(a.getFilterValue()),i.getItemsList({url:h.setting.component.settings.dataSource.url})},h.clearFilter=function(){a.setInitialValues(),i.getItemsList({url:h.setting.component.settings.dataSource.url})},h.changePage=function(t,n){t.preventDefault(),h.listLoaded=!1;var a=n.split("?")[1];i.getItemsListWithParams(a,e.$id)},h.changeSortField=function(t){h.listLoaded=!1,h.sortField==t?h.sortingDirection=!h.sortingDirection:h.sortField=t;({sort:h.sortingDirection?t:"-"+t});i.getItemsList({sort:h.sortingDirection?t:"-"+t,url:h.setting.component.settings.dataSource.url,id:e.$id})},h.toggleContextView=function(e){h.contextId==e?h.contextId=void 0:h.contextId=e},h.getParent=function(){i.loadParent(l.search().parent)},h.toggleFilterVisibility=function(){h.entityLoaded||(h.visibleFilter=!h.visibleFilter)},e.$on("editor:items_list_"+e.$id,function(e,t){if(o(function(){"new"===h.setting.pk&&f.find(".btn-create").trigger("click")},0),!s.is("editor.type.new")){h.metaKey=!0,h.listLoaded=!0,h.items=t[v],angular.isDefined(h.setting.component.settings.dataSource.keys)&&(g=h.setting.component.settings.dataSource.keys.meta||g,v=h.setting.component.settings.dataSource.keys.items||v,
h.metaKey=0!=h.setting.component.settings.dataSource.keys.meta),h.autoCompleteFields.forEach(function(e){if(0!==h.autoCompleteFields.length){var t=e.name,n=[],a="";if(t&&e.valuesRemote&&e.valuesRemote.fieldSearch&&(h.items.forEach(function(e){var i=e[t];e[t+"_copy"]=i,e[t]="",i&&n.indexOf(i)===-1&&n.push(i)}),n.length&&(a='?filter={"'+e.valuesRemote.fieldId+'":['+n.join(",")+"]}"),i.getData(e.valuesRemote.url+a).then(function(n){if(n.data.items&&n.data.items.length){h.linkedNames=n.data.items;for(var i=h.linkedNames.length;i--;){var a=h.linkedNames[i];a&&h.items.forEach(function(n){n[t+"_copy"]==a.id&&(n[t]=a[e.valuesRemote.fieldSearch])})}}},function(e){console.log(e)})),e.values)for(var l=h.items.length;l--;){var r=h.items[l][t];h.items[l][t]=e.values[r]||r}}}),h.entityLoaded=!1,h.parentButton=!!l.search().hasOwnProperty("parent"),h.pageItemsArray=[];var n,a,r=i.getQueryParams();if(0===h.items.length&&(h.metaKey=!1),h.pagination&&h.metaKey){for(h.metaData=t[g],h.metaData.fromItem=(t[g].currentPage-1)*t[g].perPage+1,h.metaData.toItem=(t[g].currentPage-1)*t[g].perPage+t[v].length,t[g].currentPage>1&&(r.page=1,h.pageItemsArray.push({label:"<<",href:h.setting.component.settings.dataSource.url+"?"+d(r)}),r.page=t[g].currentPage-1,h.pageItemsArray.push({label:"<",href:h.setting.component.settings.dataSource.url+"?"+d(r)})),t[g].currentPage>y+1&&(r.page=t[g].currentPage-y-1,h.pageItemsArray.push({label:"...",href:h.setting.component.settings.dataSource.url+"?"+d(r)})),n=t[g].currentPage-y>0?t[g].currentPage-y:1;n<t[g].currentPage;)r.page=n,h.pageItemsArray.push({label:n,href:h.setting.component.settings.dataSource.url+"?"+d(r)}),n++;h.pageItemsArray.push({label:t[g].currentPage,self:!0}),a=t[g].currentPage+y<t[g].pageCount?t[g].currentPage+y:t[g].pageCount;for(var u=t[g].currentPage+1;u<=a;)r.page=u,h.pageItemsArray.push({label:u,href:h.setting.component.settings.dataSource.url+"?"+d(r)}),u++;t[g].currentPage+y<t[g].pageCount&&(r.page=t[g].currentPage+y+1,h.pageItemsArray.push({label:"...",href:h.setting.component.settings.dataSource.url+"?"+d(r)})),t[g].currentPage<t[g].pageCount&&(r.page=t[g].currentPage+1,h.pageItemsArray.push({label:">",href:h.setting.component.settings.dataSource.url+"?"+d(r)}),r.page=t[g].pageCount,h.pageItemsArray.push({label:">>",href:h.setting.component.settings.dataSource.url+"?"+d(r)}))}o(function(){h.setting.pk&&$("#edit_btn_"+h.setting.pk).trigger("click")},0)}}),e.$on("editor:server_error",function(e,t){h.errors.push(t)}),e.$on("editor:presave_entity_updated",function(e,t){c("CHANGE_RECORDS.UPDATE").then(function(e){u.success(e)})}),e.$on("editor:parent_childs",function(e,t){angular.forEach(h.items,function(e,n){var i=1;e[h.idField]===t.id&&(e.isExpand===!0?(e.isExpand=!1,h.items.splice(n+1,t.childs.length)):(e.isExpand=!0,angular.forEach(t.childs,function(e){h.items[n].hasOwnProperty.parentPadding?e.parentPadding=h.items[n].parentPadding+1:e.parentPadding=1,h.items.splice(n+i,0,e)})))})}),e.$on("editor:entity_success_deleted",function(e,t){c("CHANGE_RECORDS.DELETE").then(function(e){u.success(e)})}),e.$on("editor:field_error",function(e,t){h.errors.push(t)}),e.$on("editor:request_start",function(e,t){h.errors=[],h.notifys=[]}),r.on("click",function(e){angular.element(e.target).hasClass("context-toggle")||o(function(){h.contextId=void 0},0)}),e.$watch(function(){return i.isProcessing},function(e){h.loadingData=e}),n.hasOwnProperty("ui")&&n.ui.hasOwnProperty("language")&&(n.ui.language.search(".json")!==-1?c.use(n.ui.language):"ru"!==n.ui.language&&c.use("assets/json/language/"+n.ui.language+".json")),h.clickEnter=function(e){13===e.keyCode&&h.applyFilter()},h.$onInit=function(){i.setFilterParams({}),i.getItemsList({url:h.setting.component.settings.dataSource.url,id:e.$id})}}angular.module("universal.editor").controller("UeTableController",e),e.$inject=["$scope","$rootScope","configData","RestApiService","FilterFieldsStorage","$location","$document","$timeout","$httpParamSerializer","$state","toastr","$translate","ConfigDataProvider","$element","$compile"]}(),function(e){try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/components/ueTable/ueTable.html",'\n<div>\n    <div class="editor-header">\n        <!--button.btn.btn-lg.btn-default.filter-button(data-ng-click="vm.toggleFilterVisibility()", data-ng-class="{ disabled : vm.entityLoaded }")| {{ \'BUTTON.FILTER\' | translate}} {{ vm.visibleFilter ? "+" : "-" }}\n        -->\n        <component-wrapper ng-repeat="button in vm.listHeaderBar track by $index" data-setting="button" data-button-class="header" class="header-action-button">\n            <!--ue-button-create(data-ng-if="button.type == \'create\'", data-button-label="{{button.label}}")-->\n            <!--div.btn.btn-lg.btn-success(data-ng-if="button.type == \'request\'", data-ng-click="vm.contextAction(button)") {{button.label}}-->\n            <!--div(data-ng-if="button.type == \'targetBlank\'", data-editor-button-target-blank="", data-item-value="item", data-button-label="{{button.label}}", data-button-request="{{button.request}}", data-index="{{$index}}", data-button-class="header")-->\n            <!--div(data-ng-if="button.type == \'download\'", data-editor-button-download="", data-item-value="item", data-button-label="{{button.label}}", data-button-request="{{button.request}}", data-index="{{$index}}", data-button-class="header")-->\n        </component-wrapper>\n        <!--.header-action-button(ng-repeat="button in vm.mixedListHeaderBar track by $index")\n        ue-button-create(data-ng-if="button.type == \'create\'", data-button-label="{{button.label}}", data-type="vm.mixEntityType")\n        div.btn.btn-lg.btn-success(data-ng-if="button.type == \'request\'", data-ng-click="vm.contextAction(button)") {{button.label}}\n        div(data-ng-if="button.type == \'targetBlank\'", data-editor-button-target-blank="", data-item-value="item", data-button-label="{{button.label}}", data-button-request="{{button.request}}", data-index="{{$index}}", data-button-class="header")\n        div(data-ng-if="button.type == \'download\'", data-editor-button-download="", data-item-value="item", data-button-label="{{button.label}}", data-button-request="{{button.request}}", data-index="{{$index}}", data-button-class="header")\n        -->\n    </div>\n    <!--.editor-filter(data-ng-hide="vm.visibleFilter || (vm.entityLoaded || vm.loadingData)")\n    .editor-filter-wrapper(ng-keyup="vm.clickEnter($event)")\n        div(data-ng-repeat="filter in vm.filterFields", data-filter-wrapper="", data-filter-name="{{filter.name}}")\n        .buttons-wrapper\n            button.btn.btn-sm.btn-success(data-ng-click="vm.applyFilter()") {{\'BUTTON.APPLY\' | translate}}\n            button.btn.btn-sm.btn-default(data-ng-click="vm.clearFilter()") {{\'BUTTON.CLEAN\' | translate}}\n    -->\n    <div class="groups-action">\n        <button data-ng-if="vm.parentButton &amp;&amp; !vm.entityLoaded &amp;&amp; !vm.loadingData" data-ng-click="vm.getParent()" class="btn btn-sm btn-default">{{\'BUTTON.HIGHER_LEVEL\' | translate}}</button>\n    </div>\n    <div data-ng-show="vm.loadingData" class="processing-status-wrapper">\n        <div class="processing-status">{{\'PERFORMS_ACTIONS\' | translate}}</div>\n    </div>\n    <table data-ng-hide="vm.entityLoaded || vm.loadingData" class="table table-bordered items-list">\n        <thead>\n            <tr>\n                <td class="actions-header context-column"></td>\n                <td data-ng-repeat="fieldItem in vm.tableFields" data-ng-class="{ \'active\' : fieldItem.field == vm.sortField, \'asc\' : vm.sortingDirection, \'desc\' : !vm.sortingDirection}" data-ng-click="vm.changeSortField(fieldItem.field)">{{fieldItem.displayName}}</td>\n            </tr>\n        </thead>\n        <tbody data-ng-if="vm.listLoaded">\n            <tr data-ng-repeat="item in vm.items" data-ng-class="{\'zhs-item\' : (vm.entityType !== item[vm.subType]) &amp;&amp; item[vm.subType] !== undefined}">\n                <td class="context-column"><span data-ng-click="vm.toggleContextView(item[vm.idField])" data-ng-show="vm.contextLinks.length" class="context-toggle">Toggle buttons</span>\n                    <div data-ng-show="vm.contextId == item[vm.idField]" class="context-menu-wrapper">\n                        <div data-ng-repeat="link in vm.contextLinks track by $index" data-ng-if="(item[vm.subType] == vm.entityType || item[vm.subType] == undefined)" class="context-menu-item">\n                            <component-wrapper data-setting="link" data-entity-id="{{item[vm.idField]}}" data-button-class="context"></component-wrapper>\n                            <!--div(data-ng-if="link.type == \'request\'", data-ng-click="vm.contextAction(link,item[vm.idField])") {{link.label}}-->\n                            <!--ue-button-edit(data-ng-if="link.type == \'edit\'", data-entity-subtype="{{item[vm.subType]}}",data-entity-id="{{item[vm.idField]}}", data-button-label="{{link.label}}", data-button-request="{{link.request}}")-->\n                            <!--ue-button-delete(data-ng-if="link.type == \'delete\'",data-entity-id="{{item[vm.idField]}}", data-button-label="{{link.label}}", data-button-request="{{link.request}}", data-button-class="context")-->\n                            <!--ue-button-open(data-ng-if="link.type == \'open\'", data-entity-id="{{item[vm.idField]}}", data-button-label="{{link.label}}", data-button-request="{{link.request}}")-->\n                            <!--div(data-ng-if="link.type == \'download\'", data-editor-button-download="", data-item-value="item", data-button-label="{{link.label}}", data-button-request="{{link.request}}", data-index="{{$index}}", data-button-class="context")-->\n                            <!--div(data-ng-if="link.type == \'targetBlank\'", data-editor-button-target-blank="", data-item-value="item", data-button-label="{{link.label}}", data-button-request="{{link.request}}", data-index="{{$index}}", data-button-class="context")-->\n                        </div>\n                        <!--.context-menu-item(data-ng-repeat="link in vm.mixContextLinks track by $index", data-ng-if="vm.mixEntityType && item[vm.subType] === vm.mixEntityType")\n                        div(data-ng-if="link.type == \'request\'", data-ng-click="vm.contextAction(link,item[vm.idField])") {{link.label}}\n                        div(data-ng-if="link.type == \'edit\'", data-editor-button-edit="", data-entity-subtype="{{item[vm.subType]}}",data-entity-id="{{item[vm.idField]}}", data-button-label="{{link.label}}", data-button-request="{{link.request}}")\n                        ue-delete-button(data-ng-if="link.type == \'delete\'", data-entity-type="mix", data-entity-id="{{item[vm.idField]}}", data-button-label="{{link.label}}", data-button-request="{{link.request}}", data-button-class="context")\n                        div(data-ng-if="link.type == \'download\'", data-editor-button-download="", data-item-value="item", data-button-label="{{link.label}}", data-button-request="{{link.request}}", data-index="{{$index}}", data-button-class="context")\n                        div(data-ng-if="link.type == \'targetBlank\'", data-editor-button-target-blank="", data-item-value="item", data-button-label="{{link.label}}", data-button-request="{{link.request}}", data-index="{{$index}}", data-button-class="context")\n                        -->\n                    </div>\n                </td>\n                <td data-ng-repeat="fieldItem in vm.tableFields track by $index"><span data-ng-class="{\'glyphicon-folder-open icon-mix-mode\' : (vm.isMixMode &amp;&amp; !((vm.entityType !== item[vm.subType]) &amp;&amp; item[vm.subType] !== undefined))}" data-ng-if="vm.prependIcon === fieldItem.field" class="glyphicon"></span><span style="padding-left: {{ item.parentPadding ? item.parentPadding * 10 : 0 }}px;">{{item[fieldItem.field]}}</span></td>\n            </tr>\n            <tr data-ng-if="vm.items.length == 0">\n                <td colspan="{{vm.tableFields.length + 1}}">{{\'ELEMENT_NO\' | translate}}</td>\n            </tr>\n        </tbody>\n        <tfoot>\n            <tr data-ng-if="vm.metaKey">\n                <td colspan="{{vm.tableFields.length + 1}}">\n                    <div class="meta-info">{{\'ELEMENTS\' | translate}} {{vm.metaData.fromItem}} - {{vm.metaData.toItem}} {{\'FROM\' | translate}} {{vm.metaData.totalCount}}</div>\n                </td>\n            </tr>\n            <tr>\n                <td colspan="{{vm.tableFields.length + 1}}" data-ng-if="vm.pagination &amp;&amp; vm.metaKey">\n                    <ul class="pagination">\n                        <li data-ng-repeat="pageItem in vm.pageItemsArray" data-ng-class="pageItem.self ? \'active\' : \'\'"><a data-ng-if="!pageItem.self" href="{{pageItem.href}}" data-ng-click="vm.changePage($event,pageItem.href)">{{pageItem.label}}</a><span data-ng-if="pageItem.self">{{pageItem.label}}</span></li>\n                    </ul>\n                </td>\n            </tr>\n        </tfoot>\n    </table>\n</div>')}])}(),function(){"use strict";var e={bindings:{field:"=",parentField:"=",parentFieldIndex:"="},template:["$templateCache",function(e){return e.get("module/components/ueTextarea/ueTextarea.html")}],controller:"UeTextareaController",controllerAs:"vm"};angular.module("universal.editor").component("ueTextarea",e)}(),function(){"use strict";function e(e,t,n,i){function a(){r.fieldValue=r.field.hasOwnProperty("multiple")&&r.field.multiple===!0?[]:""}var l,r=this;l=r.parentField?r.parentFieldIndex?r.parentField+"_"+r.parentFieldIndex+"_"+r.fieldName:r.parentField+"_"+r.fieldName:r.field.name,r.rows=r.field.height,r.cols=r.field.width,r.classTextarea="col-lg-6 col-md-6 col-sm-7 col-xs-8",r.fieldName=r.field.name,r.fieldValue="",r.readonly=r.field.readonly||!1,r.parentFieldIndex=r.parentFieldIndex||!1,r.fieldDisplayName=r.setting.component.settings.label,r.hint=r.setting.hint||!1,r.required=r.setting.required||!1,r.error=[],r.cols&&(r.cols>6&&(r.cols=6),r.cols<1&&(r.cols=1),r.classTextarea="col-lg-"+r.cols+" col-md-"+r.cols+" col-sm-"+r.cols+" col-xs-"+r.cols),r.field.hasOwnProperty("multiple")&&r.field.multiple===!0?(r.multiple=!0,r.fieldValue=[],(r.field.multiname||angular.isString(r.field.multiname))&&(r.multiname=""+r.field.multiname||"value")):(r.multiple=!1,r.fieldValue=""),r.parentFieldIndex&&(r.multiple?(r.fieldValue=[],angular.forEach(i.getFieldValue(r.parentField,r.parentFieldIndex,r.field.name),function(e){r.multiname?r.fieldValue.push(e[r.multiname]):r.fieldValue.push(e)})):r.fieldValue=i.getFieldValue(r.parentField,r.parentFieldIndex,r.field.name)||""),n.addFieldController(this),this.getFieldValue=function(){var e,t={};return r.multiname?(e=[],angular.forEach(r.fieldValue,function(t){var n={};n[r.multiname]=t,e.push(n)})):r.multiple?(e=[],angular.forEach(r.fieldValue,function(t){e.push(t)})):e=r.fieldValue,r.parentField?r.parentFieldIndex?(t[r.parentField]=[],t[r.parentField][r.parentFieldIndex]={},t[r.parentField][r.parentFieldIndex][r.fieldName]=e):(t[r.parentField]={},t[r.parentField][r.fieldName]=e):t[r.fieldName]=e,t},this.getInitialValue=function(){var e={};return r.parentField?r.multiple?(e[r.parentField]={},e[r.parentField][r.fieldName]=[""]):(e[r.parentField]={},e[r.parentField][r.fieldName]=""):r.multiple?e[r.fieldName]=[""]:e[r.fieldName]="",e},r.addItem=function(){r.fieldValue.push("")},r.removeItem=function(e){angular.forEach(r.fieldValue,function(t,n){n==e&&r.fieldValue.splice(e,1)})},r.inputLeave=function(e){if(e){if(r.field.hasOwnProperty("maxLength")&&e.length>r.field.maxLength){var t="Для поля превышено максимальное допустимое значение в "+r.field.maxLength+" символов. Сейчас введено "+e.length+" символов.";r.error.indexOf(t)<0&&r.error.push(t)}if(r.field.hasOwnProperty("minLength")&&e.length<r.field.minLength){var n="Минимальное значение поля не может быть меньше "+r.field.minLength+" символов. Сейчас введено "+e.length+" символов.";r.error.indexOf(n)<0&&r.error.push(n)}}};var o,d=e.$on("editor:entity_loaded",function(t,i){return r.field.requiredField&&(o=e.$watch(function(){var e=n.getValueField(r.field.requiredField),t=!1,i=!1;return function a(e){for(var n=Object.keys(e),l=n.length;l--;){var r=e[n[l]];null!==r&&void 0!==r&&""!==r&&(angular.isObject(r)&&!i&&a(r),t=!0,i=!0)}}(e),t},function(e){e?r.readonly=r.field.readonly||!1:(a(),r.readonly=!0)},!0)),"new"===i.editorEntityType?void(r.field.defaultValue?r.fieldValue=r.multiple?[r.field.defaultValue]:r.field.defaultValue:r.fieldValue=r.multiple?[]:""):void(r.parentField?r.multiple?r.multiname?(r.fieldValue=[],angular.forEach(i[r.parentField][r.field.name],function(e){r.fieldValue.push(e[r.multiname])})):(r.fieldValue=[],angular.forEach(i[r.parentField][r.field.name],function(e){r.fieldValue.push(e)})):r.fieldValue=i[r.parentField][r.field.name]:r.multiple?r.multiname?(r.fieldValue=[],angular.forEach(i[r.field.name],function(e){r.fieldValue.push(e[r.multiname])})):(r.fieldValue=[],angular.forEach(i[r.field.name],function(e){r.fieldValue.push(e)})):r.fieldValue=i[r.field.name])}),s=e.$on("editor:api_error_field_"+l,function(e,t){angular.isArray(t)?angular.forEach(t,function(e){r.error.indexOf(e)<0&&r.error.push(e)}):r.error.indexOf(t)<0&&r.error.push(t)}),u=e.$watch(function(){return r.fieldValue},function(){r.error=[]},!0);this.$onDestroy=function(){angular.isFunction(o)&&o(),d(),s(),u(),n.deleteFieldController(r),r.parentFieldIndex&&i.fieldDestroy(r.parentField,r.parentFieldIndex,r.field.name,r.fieldValue)},this.$postLink=function(){t.on("$destroy",function(){e.$destroy()})}}angular.module("universal.editor").controller("UeTextareaController",e),e.$inject=["$scope","$element","EditEntityStorage","ArrayFieldStorage"]}(),function(e){try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/components/ueTextarea/ueTextarea.html",'\n<div class="field-wrapper row">\n    <div class="form-group">\n        <label class="field-name-label">\n            <div data-ng-if="vm.hint" class="field-hint">\n                <div class="hint-text">{{vm.hint}}</div>\n            </div><span data-ng-class="vm.required ? \'editor-required\' : \'\' ">{{vm.fieldDisplayName}}:</span>\n        </label>\n        <div class="field-element">\n            <div data-ng-if="vm.multiple" data-ng-class="vm.classTextarea">\n                <div data-ng-repeat="field_item in vm.fieldValue track by $index" class="item-textarea-wrapper">\n                    <div>\n                        <textarea name="{{vm.fieldName}}" rows="{{vm.rows}}" data-ng-disabled="vm.readonly" data-ng-model="vm.fieldValue[$index]" data-ng-blur="vm.inputLeave(vm.fieldValue[$index])" class="form-control editor-textarea"></textarea>\n                        <div data-ng-click="vm.removeItem($index)" data-ng-if="!vm.readonly" class="btn btn-default btn-sm">x</div>\n                    </div>\n                </div>\n                <div data-ng-click="vm.addItem()" data-ng-if="!vm.readonly" class="btn btn-primary btn-sm">{{\'BUTTON.ADD\' | translate}}</div>\n            </div>\n            <div data-ng-if="!vm.multiple" data-ng-class="vm.classTextarea">\n                <div>\n                    <textarea name="{{vm.fieldName}}" rows="{{vm.rows}}" data-ng-disabled="vm.readonly" data-ng-model="vm.fieldValue" data-ng-blur="vm.inputLeave(vm.fieldValue)" class="form-control editor-textarea"></textarea>\n                </div>\n            </div>\n        </div>\n    </div>\n    <div class="field-error-wrapper">\n        <div data-ng-repeat="err in vm.error track by $index" class="error-item alert alert-danger">{{err}}</div>\n    </div>\n</div>')}])}(),function(){"use strict";var e={bindings:{field:"=",parentField:"=",parentFieldIndex:"="},template:["$templateCache",function(e){return e.get("module/components/ueTime/ueTime.html")}],controller:"UeTimeController",controllerAs:"vm"};angular.module("universal.editor").component("ueTime",e)}(),function(){"use strict";function e(e,t,n,i,a){function l(){o.fieldValue=o.field.hasOwnProperty("multiple")&&o.field.multiple===!0?[]:""}var r,o=this;if(r=o.parentField?o.parentFieldIndex?o.parentField+"_"+o.parentFieldIndex+"_"+o.fieldName:o.parentField+"_"+o.fieldName:o.field.name,o.fieldName=o.field.name,o.fieldValue="",o.readonly=o.field.readonly||!1,o.sourceTime=i(),o.parentFieldIndex=o.parentFieldIndex||!1,o.fieldDisplayName=o.setting.component.settings.label,o.hint=o.setting.hint||!1,o.required=o.setting.required||!1,o.error=[],o.field.hasOwnProperty("multiple")&&o.field.multiple===!0?(o.multiple=!0,o.fieldValue=[],(o.field.multiname||angular.isString(o.field.multiname))&&(o.multiname=""+o.field.multiname||"value")):(o.multiple=!1,o.fieldValue=""),o.parentFieldIndex)if(o.multiple)o.fieldValue=[],angular.forEach(a.getFieldValue(o.parentField,o.parentFieldIndex,o.field.name),function(e){o.multiname?o.fieldValue.push(e[o.multiname]?i(e[o.multiname],"YYYY-MM-DD HH:mm:ss"):""):o.fieldValue.push(e?i(e,"YYYY-MM-DD HH:mm:ss"):"")});else{var d=a.getFieldValue(o.parentField,o.parentFieldIndex,o.field.name);o.fieldValue=d?i(d,"YYYY-MM-DD HH:mm:ss"):o.fieldValue}t.addFieldController(this),this.getFieldValue=function(){var e,t={};return o.multiname?(e=[],angular.forEach(o.fieldValue,function(t){if(t&&""!==t&&i.isMoment(t)){var n={};n[o.multiname]=i(t).format("YYYY-MM-DD HH:mm:ss"),e.push(n)}})):o.multiple?(e=[],angular.forEach(o.fieldValue,function(t){e.push(i(t).format("YYYY-MM-DD HH:mm:ss"))})):e=o.fieldValue&&""!==o.fieldValue&&i.isMoment(o.fieldValue)?i(o.fieldValue).format("YYYY-MM-DD HH:mm:ss"):"",o.parentField?o.parentFieldIndex?(t[o.parentField]=[],t[o.parentField][o.parentFieldIndex]={},t[o.parentField][o.parentFieldIndex][o.fieldName]=e):(t[o.parentField]={},t[o.parentField][o.fieldName]=e):t[o.fieldName]=e,t},this.getInitialValue=function(){var e={};return o.parentField?o.multiple?(e[o.parentField]={},e[o.parentField][o.fieldName]=[]):(e[o.parentField]={},e[o.parentField][o.fieldName]=i()):o.multiple?e[o.fieldName]=[]:e[o.fieldName]=i(),e},o.addItem=function(){o.fieldValue.push(i())},o.removeItem=function(e){angular.forEach(o.fieldValue,function(t,n){n==e&&o.fieldValue.splice(e,1)})};var s,u=e.$on("editor:entity_loaded",function(n,a){if(o.field.requiredField&&(s=e.$watch(function(){var e=t.getValueField(o.field.requiredField),n=!1,i=!1;return function a(e){for(var t=Object.keys(e),l=t.length;l--;){var r=e[t[l]];null!==r&&void 0!==r&&""!==r&&(angular.isObject(r)&&!i&&a(r),n=!0,i=!0)}}(e),n},function(e){e?o.readonly=o.field.readonly||!1:(l(),o.readonly=!0)},!0)),"new"===a.editorEntityType){var r=i();return o.field.defaultValue&&i(o.field.defaultValue,"HH:mm").isValid()&&(r=i(o.field.defaultValue,"HH:mm")),void(o.fieldValue=o.multiple?[r]:r)}o.parentField?o.multiple?o.multiname?(o.fieldValue=[],angular.forEach(a[o.parentField][o.field.name],function(e){o.fieldValue.push(i(e[o.multiname],"YYYY-MM-DD HH:mm:ss"))})):(o.fieldValue=[],angular.forEach(a[o.parentField][o.field.name],function(e){o.fieldValue.push(i(e,"YYYY-MM-DD HH:mm:ss"))})):o.fieldValue=a[o.parentField][o.field.name]?i(a[o.parentField][o.field.name],"YYYY-MM-DD HH:mm:ss"):"":o.multiple?o.multiname?(o.fieldValue=[],angular.forEach(a[o.field.name],function(e){o.fieldValue.push(i(e[o.multiname],"YYYY-MM-DD HH:mm:ss"))})):(o.fieldValue=[],angular.forEach(a[o.field.name],function(e){o.fieldValue.push(i(e,"YYYY-MM-DD HH:mm:ss"))})):o.fieldValue=a[o.field.name]?i(a[o.field.name],"YYYY-MM-DD HH:mm:ss"):""}),c=e.$watch(function(){return o.fieldValue},function(){o.error=[]},!0),m=e.$on("editor:api_error_field_"+r,function(e,t){angular.isArray(t)?angular.forEach(t,function(e){o.error.indexOf(e)<0&&o.error.push(e)}):o.error.indexOf(t)<0&&o.error.push(t)});this.$onDestroy=function(){angular.isFunction(s)&&s(),u(),c(),m(),t.deleteFieldController(o),o.parentFieldIndex&&a.fieldDestroy(o.parentField,o.parentFieldIndex,o.field.name,o.fieldValue)},this.$postLink=function(){n.on("$destroy",function(){e.$destroy()})}}angular.module("universal.editor").controller("UeTimeController",e),e.$inject=["$scope","EditEntityStorage","$element","moment","ArrayFieldStorage"]}(),function(e){try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/components/ueTime/ueTime.html",'\n<div class="field-wrapper row">\n    <div class="form-group">\n        <label class="field-name-label">\n            <div data-ng-if="vm.hint" class="field-hint">\n                <div class="hint-text">{{vm.hint}}</div>\n            </div><span data-ng-class="vm.required ? \'editor-required\' : \'\' ">{{vm.fieldDisplayName}}:</span>\n        </label>\n        <div class="field-element">\n            <div data-ng-if="vm.multiple" class="col-lg-2 col-md-2 col-sm-3 col-xs-3">\n                <div data-ng-repeat="field_item in vm.fieldValue track by $index" class="item-timepicker-wrapper input-group">\n                    <input name="{{vm.fieldName}}" data-ng-disabled="vm.readonly" data-ng-model="vm.fieldValue[$index]" data-date-time="" data-format="HH:mm" data-max-view="hours" data-min-view="minutes" data-view="hours" class="form-control input-sm timepicker"/><span class="input-group-btn">\n                        <button data-ng-click="vm.removeItem($index)" data-ng-if="!vm.readonly" class="btn btn-default btn-sm">x</button></span>\n                </div>\n                <div data-ng-click="vm.addItem()" data-ng-if="!vm.readonly" class="btn btn-primary btn-sm">{{\'BUTTON.ADD\' | translate}}</div>\n            </div>\n            <div data-ng-if="!vm.multiple" class="col-lg-2 col-md-2 col-sm-3 col-xs-3">\n                <input name="{{vm.fieldName}}" data-ng-disabled="vm.readonly" data-ng-model="vm.fieldValue" data-date-time="" data-format="HH:mm" data-max-view="hours" data-min-view="minutes" data-view="hours" class="form-control input-sm timepicker"/>\n            </div>\n        </div>\n    </div>\n    <div class="field-error-wrapper">\n        <div data-ng-repeat="err in vm.error track by $index" class="error-item alert alert-danger">{{err}}</div>\n    </div>\n</div>')}])}(),function(){"use strict";function e(e,t,n,i,a,l,r,o,d,s,u){var c=this;c.entity=i.getEntityType(),c.configData=n,c.menu=o,c.type=d;var m;s.current;i.setEntityType(d),u.setEntityType(d),t.$broadcast("editor:set_entity_type",r.settings);var f=a.find(".universal-editor"),p=e.$new();p.settings={},p.settings.component=r,p.settings.pk=m||null,f.append(l("<"+r.name+' data-setting="settings" data></'+r.name+">")(p))}angular.module("universal.editor").controller("UniversalEditorController",e),e.$inject=["$scope","$rootScope","configData","RestApiService","$element","$compile","component","menu","type","$state","EditEntityStorage"]}(),function(e){try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/components/universalEditor/universalEditor.html",'\n<ul data-ng-if="vm.menu.length &gt; 1" class="nav nav-tabs">\n    <li data-ng-repeat="item in vm.menu track by $index" data-ng-class="(item.name === vm.type) ? \'active\' : \'\'" class="item"><a data-ui-sref="{{item.sref}}" ui-sref-opts="{reload: true, inherit: false}">{{item.label}}</a></li>\n</ul>\n<div class="universal-editor"></div>')}])}(),function(e){try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/template/labelField/labelField.html",'\n<label class="field-name-label">\n    <div data-ng-if="vm.hint" class="field-hint">\n        <div class="hint-text">{{vm.hint}}</div>\n    </div><span data-ng-class="vm.required ? \'editor-required\' : \'\' ">{{vm.fieldDisplayName}}:</span>\n</label>')}])}(),function(e){try{e=angular.module("universal.editor.templates")}catch(t){e=angular.module("universal.editor.templates",[])}e.run(["$templateCache",function(e){e.put("module/template/errorField/errorField.html",'\n<div class="field-error-wrapper">\n    <div data-ng-repeat="err in vm.error track by $index" class="error-item alert alert-danger">{{err}}</div>\n</div>')}])}();